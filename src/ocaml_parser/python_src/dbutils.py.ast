Module([ImportFrom('time', [alias('sleep', '_sleep')], 0, lineno=27, col_offset=0), Import([alias('sys', None)], lineno=29, col_offset=0), Assign([Name('absolute_import', Store(), lineno=30, col_offset=0)], Compare(Subscript(Attribute(Name('sys', Load(), lineno=30, col_offset=19), 'version_info', Load(), lineno=30, col_offset=19), Index(Num(0, lineno=30, col_offset=36)), Load(), lineno=30, col_offset=19), [GtE()], [Num(3, lineno=30, col_offset=42)], lineno=30, col_offset=19), lineno=30, col_offset=0), If(Name('absolute_import', Load(), lineno=31, col_offset=3), [Exec(Str('from . import db', lineno=33, col_offset=9), None, None, lineno=33, col_offset=4)], [Import([alias('db', None)], lineno=35, col_offset=4)], lineno=31, col_offset=0), Assign([Name('_deadlock_MinSleepTime', Store(), lineno=38, col_offset=0)], BinOp(Num(1.0, lineno=38, col_offset=25), Div(), Num(128, lineno=38, col_offset=29), lineno=38, col_offset=25), lineno=38, col_offset=0), Assign([Name('_deadlock_MaxSleepTime', Store(), lineno=40, col_offset=0)], Num(3.14159, lineno=40, col_offset=25), lineno=40, col_offset=0), Assign([Name('_deadlock_VerboseFile', Store(), lineno=44, col_offset=0)], Name('None', Load(), lineno=44, col_offset=24), lineno=44, col_offset=0), FunctionDef('DeadlockWrap', arguments([Name('function', Param(), lineno=47, col_offset=17)], '_args', '_kwargs', []), [Expr(Str('DeadlockWrap(function, *_args, **_kwargs) - automatically retries\n    function in case of a database deadlock.\n\n    This is a function intended to be used to wrap database calls such\n    that they perform retrys with exponentially backing off sleeps in\n    between when a DBLockDeadlockError exception is raised.\n\n    A \'max_retries\' parameter may optionally be passed to prevent it\n    from retrying forever (in which case the exception will be reraised).\n\n        d = DB(...)\n        d.open(...)\n        DeadlockWrap(d.put, "foo", data="bar")  # set key "foo" to "bar"\n    ', lineno=61, col_offset=-1), lineno=61, col_offset=-1), Assign([Name('sleeptime', Store(), lineno=62, col_offset=4)], Name('_deadlock_MinSleepTime', Load(), lineno=62, col_offset=16), lineno=62, col_offset=4), Assign([Name('max_retries', Store(), lineno=63, col_offset=4)], Call(Attribute(Name('_kwargs', Load(), lineno=63, col_offset=18), 'get', Load(), lineno=63, col_offset=18), [Str('max_retries', lineno=63, col_offset=30), Num(-1, lineno=63, col_offset=46)], [], None, None, lineno=63, col_offset=18), lineno=63, col_offset=4), If(Compare(Str('max_retries', lineno=64, col_offset=7), [In()], [Name('_kwargs', Load(), lineno=64, col_offset=24)], lineno=64, col_offset=7), [Delete([Subscript(Name('_kwargs', Load(), lineno=65, col_offset=12), Index(Str('max_retries', lineno=65, col_offset=20)), Del(), lineno=65, col_offset=12)], lineno=65, col_offset=8)], [], lineno=64, col_offset=4), While(Name('True', Load(), lineno=66, col_offset=10), [TryExcept([Return(Call(Name('function', Load(), lineno=68, col_offset=19), [], [], Name('_args', Load(), lineno=68, col_offset=29), Name('_kwargs', Load(), lineno=68, col_offset=38), lineno=68, col_offset=19), lineno=68, col_offset=12)], [ExceptHandler(Attribute(Name('db', Load(), lineno=69, col_offset=15), 'DBLockDeadlockError', Load(), lineno=69, col_offset=15), None, [If(Name('_deadlock_VerboseFile', Load(), lineno=70, col_offset=15), [Expr(Call(Attribute(Name('_deadlock_VerboseFile', Load(), lineno=71, col_offset=16), 'write', Load(), lineno=71, col_offset=16), [BinOp(Str('dbutils.DeadlockWrap: sleeping %1.3f\n', lineno=72, col_offset=20), Mod(), Name('sleeptime', Load(), lineno=72, col_offset=63), lineno=72, col_offset=20)], [], None, None, lineno=71, col_offset=16), lineno=71, col_offset=16)], [], lineno=70, col_offset=12), Expr(Call(Name('_sleep', Load(), lineno=73, col_offset=12), [Name('sleeptime', Load(), lineno=73, col_offset=19)], [], None, None, lineno=73, col_offset=12), lineno=73, col_offset=12), AugAssign(Name('sleeptime', Store(), lineno=75, col_offset=12), Mult(), Num(2, lineno=75, col_offset=25), lineno=75, col_offset=12), If(Compare(Name('sleeptime', Load(), lineno=76, col_offset=15), [Gt()], [Name('_deadlock_MaxSleepTime', Load(), lineno=76, col_offset=27)], lineno=76, col_offset=15), [Assign([Name('sleeptime', Store(), lineno=77, col_offset=16)], Name('_deadlock_MaxSleepTime', Load(), lineno=77, col_offset=28), lineno=77, col_offset=16)], [], lineno=76, col_offset=12), AugAssign(Name('max_retries', Store(), lineno=78, col_offset=12), Sub(), Num(1, lineno=78, col_offset=27), lineno=78, col_offset=12), If(Compare(Name('max_retries', Load(), lineno=79, col_offset=15), [Eq()], [Num(-1, lineno=79, col_offset=31)], lineno=79, col_offset=15), [Raise(None, None, None, lineno=80, col_offset=16)], [], lineno=79, col_offset=12)], lineno=69, col_offset=8)], [], lineno=67, col_offset=8)], [], lineno=66, col_offset=4)], [], lineno=47, col_offset=0)])
