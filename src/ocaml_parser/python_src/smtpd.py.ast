Module([Expr(Str("An RFC 2821 smtp proxy.\n\nUsage: %(program)s [options] [localhost:localport [remotehost:remoteport]]\n\nOptions:\n\n    --nosetuid\n    -n\n        This program generally tries to setuid `nobody', unless this flag is\n        set.  The setuid call will fail if this program is not run as root (in\n        which case, use this flag).\n\n    --version\n    -V\n        Print the version number and exit.\n\n    --class classname\n    -c classname\n        Use `classname' as the concrete SMTP proxy class.  Uses `PureProxy' by\n        default.\n\n    --debug\n    -d\n        Turn on debugging prints.\n\n    --help\n    -h\n        Print this message and exit.\n\nVersion: %(__version__)s\n\nIf localhost is not given then `localhost' is used, and if localport is not\ngiven then 8025 is used.  If remotehost is not given then `localhost' is used,\nand if remoteport is not given, then 25 is used.\n", lineno=36, col_offset=-1), lineno=36, col_offset=-1), Import([alias('sys', None)], lineno=72, col_offset=0), Import([alias('os', None)], lineno=73, col_offset=0), Import([alias('errno', None)], lineno=74, col_offset=0), Import([alias('getopt', None)], lineno=75, col_offset=0), Import([alias('time', None)], lineno=76, col_offset=0), Import([alias('socket', None)], lineno=77, col_offset=0), Import([alias('asyncore', None)], lineno=78, col_offset=0), Import([alias('asynchat', None)], lineno=79, col_offset=0), Assign([Name('__all__', Store(), lineno=81, col_offset=0)], List([Str('SMTPServer', lineno=81, col_offset=11), Str('DebuggingServer', lineno=81, col_offset=24), Str('PureProxy', lineno=81, col_offset=42), Str('MailmanProxy', lineno=81, col_offset=54)], Load(), lineno=81, col_offset=10), lineno=81, col_offset=0), Assign([Name('program', Store(), lineno=83, col_offset=0)], Subscript(Attribute(Name('sys', Load(), lineno=83, col_offset=10), 'argv', Load(), lineno=83, col_offset=10), Index(Num(0, lineno=83, col_offset=19)), Load(), lineno=83, col_offset=10), lineno=83, col_offset=0), Assign([Name('__version__', Store(), lineno=84, col_offset=0)], Str('Python SMTP proxy version 0.2', lineno=84, col_offset=14), lineno=84, col_offset=0), ClassDef('Devnull', [], [FunctionDef('write', arguments([Name('self', Param(), lineno=88, col_offset=14), Name('msg', Param(), lineno=88, col_offset=20)], None, None, []), [Pass( lineno=88, col_offset=26)], [], lineno=88, col_offset=4), FunctionDef('flush', arguments([Name('self', Param(), lineno=89, col_offset=14)], None, None, []), [Pass( lineno=89, col_offset=21)], [], lineno=89, col_offset=4)], [], lineno=87, col_offset=0), Assign([Name('DEBUGSTREAM', Store(), lineno=92, col_offset=0)], Call(Name('Devnull', Load(), lineno=92, col_offset=14), [], [], None, None, lineno=92, col_offset=14), lineno=92, col_offset=0), Assign([Name('NEWLINE', Store(), lineno=93, col_offset=0)], Str('\n', lineno=93, col_offset=10), lineno=93, col_offset=0), Assign([Name('EMPTYSTRING', Store(), lineno=94, col_offset=0)], Str('', lineno=94, col_offset=14), lineno=94, col_offset=0), Assign([Name('COMMASPACE', Store(), lineno=95, col_offset=0)], Str(', ', lineno=95, col_offset=13), lineno=95, col_offset=0), FunctionDef('usage', arguments([Name('code', Param(), lineno=98, col_offset=10), Name('msg', Param(), lineno=98, col_offset=16)], None, None, [Str('', lineno=98, col_offset=20)]), [Print(Attribute(Name('sys', Load(), lineno=99, col_offset=13), 'stderr', Load(), lineno=99, col_offset=13), [BinOp(Name('__doc__', Load(), lineno=99, col_offset=25), Mod(), Call(Name('globals', Load(), lineno=99, col_offset=35), [], [], None, None, lineno=99, col_offset=35), lineno=99, col_offset=25)], True, lineno=99, col_offset=4), If(Name('msg', Load(), lineno=100, col_offset=7), [Print(Attribute(Name('sys', Load(), lineno=101, col_offset=17), 'stderr', Load(), lineno=101, col_offset=17), [Name('msg', Load(), lineno=101, col_offset=29)], True, lineno=101, col_offset=8)], [], lineno=100, col_offset=4), Expr(Call(Attribute(Name('sys', Load(), lineno=102, col_offset=4), 'exit', Load(), lineno=102, col_offset=4), [Name('code', Load(), lineno=102, col_offset=13)], [], None, None, lineno=102, col_offset=4), lineno=102, col_offset=4)], [], lineno=98, col_offset=0), ClassDef('SMTPChannel', [Attribute(Name('asynchat', Load(), lineno=105, col_offset=18), 'async_chat', Load(), lineno=105, col_offset=18)], [Assign([Name('COMMAND', Store(), lineno=106, col_offset=4)], Num(0, lineno=106, col_offset=14), lineno=106, col_offset=4), Assign([Name('DATA', Store(), lineno=107, col_offset=4)], Num(1, lineno=107, col_offset=11), lineno=107, col_offset=4), FunctionDef('__init__', arguments([Name('self', Param(), lineno=109, col_offset=17), Name('server', Param(), lineno=109, col_offset=23), Name('conn', Param(), lineno=109, col_offset=31), Name('addr', Param(), lineno=109, col_offset=37)], None, None, []), [Expr(Call(Attribute(Attribute(Name('asynchat', Load(), lineno=110, col_offset=8), 'async_chat', Load(), lineno=110, col_offset=8), '__init__', Load(), lineno=110, col_offset=8), [Name('self', Load(), lineno=110, col_offset=37), Name('conn', Load(), lineno=110, col_offset=43)], [], None, None, lineno=110, col_offset=8), lineno=110, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=111, col_offset=8), '__server', Store(), lineno=111, col_offset=8)], Name('server', Load(), lineno=111, col_offset=24), lineno=111, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=112, col_offset=8), '__conn', Store(), lineno=112, col_offset=8)], Name('conn', Load(), lineno=112, col_offset=22), lineno=112, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=113, col_offset=8), '__addr', Store(), lineno=113, col_offset=8)], Name('addr', Load(), lineno=113, col_offset=22), lineno=113, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=114, col_offset=8), '__line', Store(), lineno=114, col_offset=8)], List([], Load(), lineno=114, col_offset=22), lineno=114, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=115, col_offset=8), '__state', Store(), lineno=115, col_offset=8)], Attribute(Name('self', Load(), lineno=115, col_offset=23), 'COMMAND', Load(), lineno=115, col_offset=23), lineno=115, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=116, col_offset=8), '__greeting', Store(), lineno=116, col_offset=8)], Num(0, lineno=116, col_offset=26), lineno=116, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=117, col_offset=8), '__mailfrom', Store(), lineno=117, col_offset=8)], Name('None', Load(), lineno=117, col_offset=26), lineno=117, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=118, col_offset=8), '__rcpttos', Store(), lineno=118, col_offset=8)], List([], Load(), lineno=118, col_offset=25), lineno=118, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=119, col_offset=8), '__data', Store(), lineno=119, col_offset=8)], Str('', lineno=119, col_offset=22), lineno=119, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=120, col_offset=8), '__fqdn', Store(), lineno=120, col_offset=8)], Call(Attribute(Name('socket', Load(), lineno=120, col_offset=22), 'getfqdn', Load(), lineno=120, col_offset=22), [], [], None, None, lineno=120, col_offset=22), lineno=120, col_offset=8), TryExcept([Assign([Attribute(Name('self', Load(), lineno=122, col_offset=12), '__peer', Store(), lineno=122, col_offset=12)], Call(Attribute(Name('conn', Load(), lineno=122, col_offset=26), 'getpeername', Load(), lineno=122, col_offset=26), [], [], None, None, lineno=122, col_offset=26), lineno=122, col_offset=12)], [ExceptHandler(Attribute(Name('socket', Load(), lineno=123, col_offset=15), 'error', Load(), lineno=123, col_offset=15), Name('err', Store(), lineno=123, col_offset=29), [Expr(Call(Attribute(Name('self', Load(), lineno=126, col_offset=12), 'close', Load(), lineno=126, col_offset=12), [], [], None, None, lineno=126, col_offset=12), lineno=126, col_offset=12), If(Compare(Subscript(Name('err', Load(), lineno=127, col_offset=15), Index(Num(0, lineno=127, col_offset=19)), Load(), lineno=127, col_offset=15), [NotEq()], [Attribute(Name('errno', Load(), lineno=127, col_offset=25), 'ENOTCONN', Load(), lineno=127, col_offset=25)], lineno=127, col_offset=15), [Raise(None, None, None, lineno=128, col_offset=16)], [], lineno=127, col_offset=12), Return(None, lineno=129, col_offset=12)], lineno=123, col_offset=8)], [], lineno=121, col_offset=8), Print(Name('DEBUGSTREAM', Load(), lineno=130, col_offset=17), [Str('Peer:', lineno=130, col_offset=30), Call(Name('repr', Load(), lineno=130, col_offset=39), [Attribute(Name('self', Load(), lineno=130, col_offset=44), '__peer', Load(), lineno=130, col_offset=44)], [], None, None, lineno=130, col_offset=39)], True, lineno=130, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=131, col_offset=8), 'push', Load(), lineno=131, col_offset=8), [BinOp(Str('220 %s %s', lineno=131, col_offset=18), Mod(), Tuple([Attribute(Name('self', Load(), lineno=131, col_offset=33), '__fqdn', Load(), lineno=131, col_offset=33), Name('__version__', Load(), lineno=131, col_offset=46)], Load(), lineno=131, col_offset=33), lineno=131, col_offset=18)], [], None, None, lineno=131, col_offset=8), lineno=131, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=132, col_offset=8), 'set_terminator', Load(), lineno=132, col_offset=8), [Str('\r\n', lineno=132, col_offset=28)], [], None, None, lineno=132, col_offset=8), lineno=132, col_offset=8)], [], lineno=109, col_offset=4), FunctionDef('push', arguments([Name('self', Param(), lineno=135, col_offset=13), Name('msg', Param(), lineno=135, col_offset=19)], None, None, []), [Expr(Call(Attribute(Attribute(Name('asynchat', Load(), lineno=136, col_offset=8), 'async_chat', Load(), lineno=136, col_offset=8), 'push', Load(), lineno=136, col_offset=8), [Name('self', Load(), lineno=136, col_offset=33), BinOp(Name('msg', Load(), lineno=136, col_offset=39), Add(), Str('\r\n', lineno=136, col_offset=45), lineno=136, col_offset=39)], [], None, None, lineno=136, col_offset=8), lineno=136, col_offset=8)], [], lineno=135, col_offset=4), FunctionDef('collect_incoming_data', arguments([Name('self', Param(), lineno=139, col_offset=30), Name('data', Param(), lineno=139, col_offset=36)], None, None, []), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=140, col_offset=8), '__line', Load(), lineno=140, col_offset=8), 'append', Load(), lineno=140, col_offset=8), [Name('data', Load(), lineno=140, col_offset=27)], [], None, None, lineno=140, col_offset=8), lineno=140, col_offset=8)], [], lineno=139, col_offset=4), FunctionDef('found_terminator', arguments([Name('self', Param(), lineno=143, col_offset=25)], None, None, []), [Assign([Name('line', Store(), lineno=144, col_offset=8)], Call(Attribute(Name('EMPTYSTRING', Load(), lineno=144, col_offset=15), 'join', Load(), lineno=144, col_offset=15), [Attribute(Name('self', Load(), lineno=144, col_offset=32), '__line', Load(), lineno=144, col_offset=32)], [], None, None, lineno=144, col_offset=15), lineno=144, col_offset=8), Print(Name('DEBUGSTREAM', Load(), lineno=145, col_offset=17), [Str('Data:', lineno=145, col_offset=30), Call(Name('repr', Load(), lineno=145, col_offset=39), [Name('line', Load(), lineno=145, col_offset=44)], [], None, None, lineno=145, col_offset=39)], True, lineno=145, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=146, col_offset=8), '__line', Store(), lineno=146, col_offset=8)], List([], Load(), lineno=146, col_offset=22), lineno=146, col_offset=8), If(Compare(Attribute(Name('self', Load(), lineno=147, col_offset=11), '__state', Load(), lineno=147, col_offset=11), [Eq()], [Attribute(Name('self', Load(), lineno=147, col_offset=27), 'COMMAND', Load(), lineno=147, col_offset=27)], lineno=147, col_offset=11), [If(UnaryOp(Not(), Name('line', Load(), lineno=148, col_offset=19), lineno=148, col_offset=15), [Expr(Call(Attribute(Name('self', Load(), lineno=149, col_offset=16), 'push', Load(), lineno=149, col_offset=16), [Str('500 Error: bad syntax', lineno=149, col_offset=26)], [], None, None, lineno=149, col_offset=16), lineno=149, col_offset=16), Return(None, lineno=150, col_offset=16)], [], lineno=148, col_offset=12), Assign([Name('method', Store(), lineno=151, col_offset=12)], Name('None', Load(), lineno=151, col_offset=21), lineno=151, col_offset=12), Assign([Name('i', Store(), lineno=152, col_offset=12)], Call(Attribute(Name('line', Load(), lineno=152, col_offset=16), 'find', Load(), lineno=152, col_offset=16), [Str(' ', lineno=152, col_offset=26)], [], None, None, lineno=152, col_offset=16), lineno=152, col_offset=12), If(Compare(Name('i', Load(), lineno=153, col_offset=15), [Lt()], [Num(0, lineno=153, col_offset=19)], lineno=153, col_offset=15), [Assign([Name('command', Store(), lineno=154, col_offset=16)], Call(Attribute(Name('line', Load(), lineno=154, col_offset=26), 'upper', Load(), lineno=154, col_offset=26), [], [], None, None, lineno=154, col_offset=26), lineno=154, col_offset=16), Assign([Name('arg', Store(), lineno=155, col_offset=16)], Name('None', Load(), lineno=155, col_offset=22), lineno=155, col_offset=16)], [Assign([Name('command', Store(), lineno=157, col_offset=16)], Call(Attribute(Subscript(Name('line', Load(), lineno=157, col_offset=26), Slice(None, Name('i', Load(), lineno=157, col_offset=32), None), Load(), lineno=157, col_offset=26), 'upper', Load(), lineno=157, col_offset=26), [], [], None, None, lineno=157, col_offset=26), lineno=157, col_offset=16), Assign([Name('arg', Store(), lineno=158, col_offset=16)], Call(Attribute(Subscript(Name('line', Load(), lineno=158, col_offset=22), Slice(BinOp(Name('i', Load(), lineno=158, col_offset=27), Add(), Num(1, lineno=158, col_offset=29), lineno=158, col_offset=27), None, None), Load(), lineno=158, col_offset=22), 'strip', Load(), lineno=158, col_offset=22), [], [], None, None, lineno=158, col_offset=22), lineno=158, col_offset=16)], lineno=153, col_offset=12), Assign([Name('method', Store(), lineno=159, col_offset=12)], Call(Name('getattr', Load(), lineno=159, col_offset=21), [Name('self', Load(), lineno=159, col_offset=29), BinOp(Str('smtp_', lineno=159, col_offset=35), Add(), Name('command', Load(), lineno=159, col_offset=45), lineno=159, col_offset=35), Name('None', Load(), lineno=159, col_offset=54)], [], None, None, lineno=159, col_offset=21), lineno=159, col_offset=12), If(UnaryOp(Not(), Name('method', Load(), lineno=160, col_offset=19), lineno=160, col_offset=15), [Expr(Call(Attribute(Name('self', Load(), lineno=161, col_offset=16), 'push', Load(), lineno=161, col_offset=16), [BinOp(Str('502 Error: command "%s" not implemented', lineno=161, col_offset=26), Mod(), Name('command', Load(), lineno=161, col_offset=70), lineno=161, col_offset=26)], [], None, None, lineno=161, col_offset=16), lineno=161, col_offset=16), Return(None, lineno=162, col_offset=16)], [], lineno=160, col_offset=12), Expr(Call(Name('method', Load(), lineno=163, col_offset=12), [Name('arg', Load(), lineno=163, col_offset=19)], [], None, None, lineno=163, col_offset=12), lineno=163, col_offset=12), Return(None, lineno=164, col_offset=12)], [If(Compare(Attribute(Name('self', Load(), lineno=166, col_offset=15), '__state', Load(), lineno=166, col_offset=15), [NotEq()], [Attribute(Name('self', Load(), lineno=166, col_offset=31), 'DATA', Load(), lineno=166, col_offset=31)], lineno=166, col_offset=15), [Expr(Call(Attribute(Name('self', Load(), lineno=167, col_offset=16), 'push', Load(), lineno=167, col_offset=16), [Str('451 Internal confusion', lineno=167, col_offset=26)], [], None, None, lineno=167, col_offset=16), lineno=167, col_offset=16), Return(None, lineno=168, col_offset=16)], [], lineno=166, col_offset=12), Assign([Name('data', Store(), lineno=171, col_offset=12)], List([], Load(), lineno=171, col_offset=19), lineno=171, col_offset=12), For(Name('text', Store(), lineno=172, col_offset=16), Call(Attribute(Name('line', Load(), lineno=172, col_offset=24), 'split', Load(), lineno=172, col_offset=24), [Str('\r\n', lineno=172, col_offset=35)], [], None, None, lineno=172, col_offset=24), [If(BoolOp(And(), [Name('text', Load(), lineno=173, col_offset=19), Compare(Subscript(Name('text', Load(), lineno=173, col_offset=28), Index(Num(0, lineno=173, col_offset=33)), Load(), lineno=173, col_offset=28), [Eq()], [Str('.', lineno=173, col_offset=39)], lineno=173, col_offset=28)], lineno=173, col_offset=19), [Expr(Call(Attribute(Name('data', Load(), lineno=174, col_offset=20), 'append', Load(), lineno=174, col_offset=20), [Subscript(Name('text', Load(), lineno=174, col_offset=32), Slice(Num(1, lineno=174, col_offset=37), None, None), Load(), lineno=174, col_offset=32)], [], None, None, lineno=174, col_offset=20), lineno=174, col_offset=20)], [Expr(Call(Attribute(Name('data', Load(), lineno=176, col_offset=20), 'append', Load(), lineno=176, col_offset=20), [Name('text', Load(), lineno=176, col_offset=32)], [], None, None, lineno=176, col_offset=20), lineno=176, col_offset=20)], lineno=173, col_offset=16)], [], lineno=172, col_offset=12), Assign([Attribute(Name('self', Load(), lineno=177, col_offset=12), '__data', Store(), lineno=177, col_offset=12)], Call(Attribute(Name('NEWLINE', Load(), lineno=177, col_offset=26), 'join', Load(), lineno=177, col_offset=26), [Name('data', Load(), lineno=177, col_offset=39)], [], None, None, lineno=177, col_offset=26), lineno=177, col_offset=12), Assign([Name('status', Store(), lineno=178, col_offset=12)], Call(Attribute(Attribute(Name('self', Load(), lineno=178, col_offset=21), '__server', Load(), lineno=178, col_offset=21), 'process_message', Load(), lineno=178, col_offset=21), [Attribute(Name('self', Load(), lineno=178, col_offset=51), '__peer', Load(), lineno=178, col_offset=51), Attribute(Name('self', Load(), lineno=179, col_offset=51), '__mailfrom', Load(), lineno=179, col_offset=51), Attribute(Name('self', Load(), lineno=180, col_offset=51), '__rcpttos', Load(), lineno=180, col_offset=51), Attribute(Name('self', Load(), lineno=181, col_offset=51), '__data', Load(), lineno=181, col_offset=51)], [], None, None, lineno=178, col_offset=21), lineno=178, col_offset=12), Assign([Attribute(Name('self', Load(), lineno=182, col_offset=12), '__rcpttos', Store(), lineno=182, col_offset=12)], List([], Load(), lineno=182, col_offset=29), lineno=182, col_offset=12), Assign([Attribute(Name('self', Load(), lineno=183, col_offset=12), '__mailfrom', Store(), lineno=183, col_offset=12)], Name('None', Load(), lineno=183, col_offset=30), lineno=183, col_offset=12), Assign([Attribute(Name('self', Load(), lineno=184, col_offset=12), '__state', Store(), lineno=184, col_offset=12)], Attribute(Name('self', Load(), lineno=184, col_offset=27), 'COMMAND', Load(), lineno=184, col_offset=27), lineno=184, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=185, col_offset=12), 'set_terminator', Load(), lineno=185, col_offset=12), [Str('\r\n', lineno=185, col_offset=32)], [], None, None, lineno=185, col_offset=12), lineno=185, col_offset=12), If(UnaryOp(Not(), Name('status', Load(), lineno=186, col_offset=19), lineno=186, col_offset=15), [Expr(Call(Attribute(Name('self', Load(), lineno=187, col_offset=16), 'push', Load(), lineno=187, col_offset=16), [Str('250 Ok', lineno=187, col_offset=26)], [], None, None, lineno=187, col_offset=16), lineno=187, col_offset=16)], [Expr(Call(Attribute(Name('self', Load(), lineno=189, col_offset=16), 'push', Load(), lineno=189, col_offset=16), [Name('status', Load(), lineno=189, col_offset=26)], [], None, None, lineno=189, col_offset=16), lineno=189, col_offset=16)], lineno=186, col_offset=12)], lineno=147, col_offset=8)], [], lineno=143, col_offset=4), FunctionDef('smtp_HELO', arguments([Name('self', Param(), lineno=192, col_offset=18), Name('arg', Param(), lineno=192, col_offset=24)], None, None, []), [If(UnaryOp(Not(), Name('arg', Load(), lineno=193, col_offset=15), lineno=193, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=194, col_offset=12), 'push', Load(), lineno=194, col_offset=12), [Str('501 Syntax: HELO hostname', lineno=194, col_offset=22)], [], None, None, lineno=194, col_offset=12), lineno=194, col_offset=12), Return(None, lineno=195, col_offset=12)], [], lineno=193, col_offset=8), If(Attribute(Name('self', Load(), lineno=196, col_offset=11), '__greeting', Load(), lineno=196, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=197, col_offset=12), 'push', Load(), lineno=197, col_offset=12), [Str('503 Duplicate HELO/EHLO', lineno=197, col_offset=22)], [], None, None, lineno=197, col_offset=12), lineno=197, col_offset=12)], [Assign([Attribute(Name('self', Load(), lineno=199, col_offset=12), '__greeting', Store(), lineno=199, col_offset=12)], Name('arg', Load(), lineno=199, col_offset=30), lineno=199, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=200, col_offset=12), 'push', Load(), lineno=200, col_offset=12), [BinOp(Str('250 %s', lineno=200, col_offset=22), Mod(), Attribute(Name('self', Load(), lineno=200, col_offset=33), '__fqdn', Load(), lineno=200, col_offset=33), lineno=200, col_offset=22)], [], None, None, lineno=200, col_offset=12), lineno=200, col_offset=12)], lineno=196, col_offset=8)], [], lineno=192, col_offset=4), FunctionDef('smtp_NOOP', arguments([Name('self', Param(), lineno=202, col_offset=18), Name('arg', Param(), lineno=202, col_offset=24)], None, None, []), [If(Name('arg', Load(), lineno=203, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=204, col_offset=12), 'push', Load(), lineno=204, col_offset=12), [Str('501 Syntax: NOOP', lineno=204, col_offset=22)], [], None, None, lineno=204, col_offset=12), lineno=204, col_offset=12)], [Expr(Call(Attribute(Name('self', Load(), lineno=206, col_offset=12), 'push', Load(), lineno=206, col_offset=12), [Str('250 Ok', lineno=206, col_offset=22)], [], None, None, lineno=206, col_offset=12), lineno=206, col_offset=12)], lineno=203, col_offset=8)], [], lineno=202, col_offset=4), FunctionDef('smtp_QUIT', arguments([Name('self', Param(), lineno=208, col_offset=18), Name('arg', Param(), lineno=208, col_offset=24)], None, None, []), [Expr(Call(Attribute(Name('self', Load(), lineno=210, col_offset=8), 'push', Load(), lineno=210, col_offset=8), [Str('221 Bye', lineno=210, col_offset=18)], [], None, None, lineno=210, col_offset=8), lineno=210, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=211, col_offset=8), 'close_when_done', Load(), lineno=211, col_offset=8), [], [], None, None, lineno=211, col_offset=8), lineno=211, col_offset=8)], [], lineno=208, col_offset=4), FunctionDef('__getaddr', arguments([Name('self', Param(), lineno=214, col_offset=18), Name('keyword', Param(), lineno=214, col_offset=24), Name('arg', Param(), lineno=214, col_offset=33)], None, None, []), [Assign([Name('address', Store(), lineno=215, col_offset=8)], Name('None', Load(), lineno=215, col_offset=18), lineno=215, col_offset=8), Assign([Name('keylen', Store(), lineno=216, col_offset=8)], Call(Name('len', Load(), lineno=216, col_offset=17), [Name('keyword', Load(), lineno=216, col_offset=21)], [], None, None, lineno=216, col_offset=17), lineno=216, col_offset=8), If(Compare(Call(Attribute(Subscript(Name('arg', Load(), lineno=217, col_offset=11), Slice(None, Name('keylen', Load(), lineno=217, col_offset=16), None), Load(), lineno=217, col_offset=11), 'upper', Load(), lineno=217, col_offset=11), [], [], None, None, lineno=217, col_offset=11), [Eq()], [Name('keyword', Load(), lineno=217, col_offset=35)], lineno=217, col_offset=11), [Assign([Name('address', Store(), lineno=218, col_offset=12)], Call(Attribute(Subscript(Name('arg', Load(), lineno=218, col_offset=22), Slice(Name('keylen', Load(), lineno=218, col_offset=26), None, None), Load(), lineno=218, col_offset=22), 'strip', Load(), lineno=218, col_offset=22), [], [], None, None, lineno=218, col_offset=22), lineno=218, col_offset=12), If(UnaryOp(Not(), Name('address', Load(), lineno=219, col_offset=19), lineno=219, col_offset=15), [Pass( lineno=220, col_offset=16)], [If(BoolOp(And(), [Compare(Subscript(Name('address', Load(), lineno=221, col_offset=17), Index(Num(0, lineno=221, col_offset=25)), Load(), lineno=221, col_offset=17), [Eq()], [Str('<', lineno=221, col_offset=31)], lineno=221, col_offset=17), Compare(Subscript(Name('address', Load(), lineno=221, col_offset=39), Index(Num(-1, lineno=221, col_offset=48)), Load(), lineno=221, col_offset=39), [Eq()], [Str('>', lineno=221, col_offset=54)], lineno=221, col_offset=39), Compare(Name('address', Load(), lineno=221, col_offset=62), [NotEq()], [Str('<>', lineno=221, col_offset=73)], lineno=221, col_offset=62)], lineno=221, col_offset=17), [Assign([Name('address', Store(), lineno=224, col_offset=16)], Subscript(Name('address', Load(), lineno=224, col_offset=26), Slice(Num(1, lineno=224, col_offset=34), Num(-1, lineno=224, col_offset=37), None), Load(), lineno=224, col_offset=26), lineno=224, col_offset=16)], [], lineno=221, col_offset=17)], lineno=219, col_offset=12)], [], lineno=217, col_offset=8), Return(Name('address', Load(), lineno=225, col_offset=15), lineno=225, col_offset=8)], [], lineno=214, col_offset=4), FunctionDef('smtp_MAIL', arguments([Name('self', Param(), lineno=227, col_offset=18), Name('arg', Param(), lineno=227, col_offset=24)], None, None, []), [Print(Name('DEBUGSTREAM', Load(), lineno=228, col_offset=17), [Str('===> MAIL', lineno=228, col_offset=30), Name('arg', Load(), lineno=228, col_offset=43)], True, lineno=228, col_offset=8), Assign([Name('address', Store(), lineno=229, col_offset=8)], IfExp(Name('arg', Load(), lineno=229, col_offset=50), Call(Attribute(Name('self', Load(), lineno=229, col_offset=18), '__getaddr', Load(), lineno=229, col_offset=18), [Str('FROM:', lineno=229, col_offset=33), Name('arg', Load(), lineno=229, col_offset=42)], [], None, None, lineno=229, col_offset=18), Name('None', Load(), lineno=229, col_offset=59), lineno=229, col_offset=18), lineno=229, col_offset=8), If(UnaryOp(Not(), Name('address', Load(), lineno=230, col_offset=15), lineno=230, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=231, col_offset=12), 'push', Load(), lineno=231, col_offset=12), [Str('501 Syntax: MAIL FROM:<address>', lineno=231, col_offset=22)], [], None, None, lineno=231, col_offset=12), lineno=231, col_offset=12), Return(None, lineno=232, col_offset=12)], [], lineno=230, col_offset=8), If(Attribute(Name('self', Load(), lineno=233, col_offset=11), '__mailfrom', Load(), lineno=233, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=234, col_offset=12), 'push', Load(), lineno=234, col_offset=12), [Str('503 Error: nested MAIL command', lineno=234, col_offset=22)], [], None, None, lineno=234, col_offset=12), lineno=234, col_offset=12), Return(None, lineno=235, col_offset=12)], [], lineno=233, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=236, col_offset=8), '__mailfrom', Store(), lineno=236, col_offset=8)], Name('address', Load(), lineno=236, col_offset=26), lineno=236, col_offset=8), Print(Name('DEBUGSTREAM', Load(), lineno=237, col_offset=17), [Str('sender:', lineno=237, col_offset=30), Attribute(Name('self', Load(), lineno=237, col_offset=41), '__mailfrom', Load(), lineno=237, col_offset=41)], True, lineno=237, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=238, col_offset=8), 'push', Load(), lineno=238, col_offset=8), [Str('250 Ok', lineno=238, col_offset=18)], [], None, None, lineno=238, col_offset=8), lineno=238, col_offset=8)], [], lineno=227, col_offset=4), FunctionDef('smtp_RCPT', arguments([Name('self', Param(), lineno=240, col_offset=18), Name('arg', Param(), lineno=240, col_offset=24)], None, None, []), [Print(Name('DEBUGSTREAM', Load(), lineno=241, col_offset=17), [Str('===> RCPT', lineno=241, col_offset=30), Name('arg', Load(), lineno=241, col_offset=43)], True, lineno=241, col_offset=8), If(UnaryOp(Not(), Attribute(Name('self', Load(), lineno=242, col_offset=15), '__mailfrom', Load(), lineno=242, col_offset=15), lineno=242, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=243, col_offset=12), 'push', Load(), lineno=243, col_offset=12), [Str('503 Error: need MAIL command', lineno=243, col_offset=22)], [], None, None, lineno=243, col_offset=12), lineno=243, col_offset=12), Return(None, lineno=244, col_offset=12)], [], lineno=242, col_offset=8), Assign([Name('address', Store(), lineno=245, col_offset=8)], IfExp(Name('arg', Load(), lineno=245, col_offset=48), Call(Attribute(Name('self', Load(), lineno=245, col_offset=18), '__getaddr', Load(), lineno=245, col_offset=18), [Str('TO:', lineno=245, col_offset=33), Name('arg', Load(), lineno=245, col_offset=40)], [], None, None, lineno=245, col_offset=18), Name('None', Load(), lineno=245, col_offset=57), lineno=245, col_offset=18), lineno=245, col_offset=8), If(UnaryOp(Not(), Name('address', Load(), lineno=246, col_offset=15), lineno=246, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=247, col_offset=12), 'push', Load(), lineno=247, col_offset=12), [Str('501 Syntax: RCPT TO: <address>', lineno=247, col_offset=22)], [], None, None, lineno=247, col_offset=12), lineno=247, col_offset=12), Return(None, lineno=248, col_offset=12)], [], lineno=246, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=249, col_offset=8), '__rcpttos', Load(), lineno=249, col_offset=8), 'append', Load(), lineno=249, col_offset=8), [Name('address', Load(), lineno=249, col_offset=30)], [], None, None, lineno=249, col_offset=8), lineno=249, col_offset=8), Print(Name('DEBUGSTREAM', Load(), lineno=250, col_offset=17), [Str('recips:', lineno=250, col_offset=30), Attribute(Name('self', Load(), lineno=250, col_offset=41), '__rcpttos', Load(), lineno=250, col_offset=41)], True, lineno=250, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=251, col_offset=8), 'push', Load(), lineno=251, col_offset=8), [Str('250 Ok', lineno=251, col_offset=18)], [], None, None, lineno=251, col_offset=8), lineno=251, col_offset=8)], [], lineno=240, col_offset=4), FunctionDef('smtp_RSET', arguments([Name('self', Param(), lineno=253, col_offset=18), Name('arg', Param(), lineno=253, col_offset=24)], None, None, []), [If(Name('arg', Load(), lineno=254, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=255, col_offset=12), 'push', Load(), lineno=255, col_offset=12), [Str('501 Syntax: RSET', lineno=255, col_offset=22)], [], None, None, lineno=255, col_offset=12), lineno=255, col_offset=12), Return(None, lineno=256, col_offset=12)], [], lineno=254, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=258, col_offset=8), '__mailfrom', Store(), lineno=258, col_offset=8)], Name('None', Load(), lineno=258, col_offset=26), lineno=258, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=259, col_offset=8), '__rcpttos', Store(), lineno=259, col_offset=8)], List([], Load(), lineno=259, col_offset=25), lineno=259, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=260, col_offset=8), '__data', Store(), lineno=260, col_offset=8)], Str('', lineno=260, col_offset=22), lineno=260, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=261, col_offset=8), '__state', Store(), lineno=261, col_offset=8)], Attribute(Name('self', Load(), lineno=261, col_offset=23), 'COMMAND', Load(), lineno=261, col_offset=23), lineno=261, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=262, col_offset=8), 'push', Load(), lineno=262, col_offset=8), [Str('250 Ok', lineno=262, col_offset=18)], [], None, None, lineno=262, col_offset=8), lineno=262, col_offset=8)], [], lineno=253, col_offset=4), FunctionDef('smtp_DATA', arguments([Name('self', Param(), lineno=264, col_offset=18), Name('arg', Param(), lineno=264, col_offset=24)], None, None, []), [If(UnaryOp(Not(), Attribute(Name('self', Load(), lineno=265, col_offset=15), '__rcpttos', Load(), lineno=265, col_offset=15), lineno=265, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=266, col_offset=12), 'push', Load(), lineno=266, col_offset=12), [Str('503 Error: need RCPT command', lineno=266, col_offset=22)], [], None, None, lineno=266, col_offset=12), lineno=266, col_offset=12), Return(None, lineno=267, col_offset=12)], [], lineno=265, col_offset=8), If(Name('arg', Load(), lineno=268, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=269, col_offset=12), 'push', Load(), lineno=269, col_offset=12), [Str('501 Syntax: DATA', lineno=269, col_offset=22)], [], None, None, lineno=269, col_offset=12), lineno=269, col_offset=12), Return(None, lineno=270, col_offset=12)], [], lineno=268, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=271, col_offset=8), '__state', Store(), lineno=271, col_offset=8)], Attribute(Name('self', Load(), lineno=271, col_offset=23), 'DATA', Load(), lineno=271, col_offset=23), lineno=271, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=272, col_offset=8), 'set_terminator', Load(), lineno=272, col_offset=8), [Str('\r\n.\r\n', lineno=272, col_offset=28)], [], None, None, lineno=272, col_offset=8), lineno=272, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=273, col_offset=8), 'push', Load(), lineno=273, col_offset=8), [Str('354 End data with <CR><LF>.<CR><LF>', lineno=273, col_offset=18)], [], None, None, lineno=273, col_offset=8), lineno=273, col_offset=8)], [], lineno=264, col_offset=4)], [], lineno=105, col_offset=0), ClassDef('SMTPServer', [Attribute(Name('asyncore', Load(), lineno=276, col_offset=17), 'dispatcher', Load(), lineno=276, col_offset=17)], [FunctionDef('__init__', arguments([Name('self', Param(), lineno=277, col_offset=17), Name('localaddr', Param(), lineno=277, col_offset=23), Name('remoteaddr', Param(), lineno=277, col_offset=34)], None, None, []), [Assign([Attribute(Name('self', Load(), lineno=278, col_offset=8), '_localaddr', Store(), lineno=278, col_offset=8)], Name('localaddr', Load(), lineno=278, col_offset=26), lineno=278, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=279, col_offset=8), '_remoteaddr', Store(), lineno=279, col_offset=8)], Name('remoteaddr', Load(), lineno=279, col_offset=27), lineno=279, col_offset=8), Expr(Call(Attribute(Attribute(Name('asyncore', Load(), lineno=280, col_offset=8), 'dispatcher', Load(), lineno=280, col_offset=8), '__init__', Load(), lineno=280, col_offset=8), [Name('self', Load(), lineno=280, col_offset=37)], [], None, None, lineno=280, col_offset=8), lineno=280, col_offset=8), TryExcept([Expr(Call(Attribute(Name('self', Load(), lineno=282, col_offset=12), 'create_socket', Load(), lineno=282, col_offset=12), [Attribute(Name('socket', Load(), lineno=282, col_offset=31), 'AF_INET', Load(), lineno=282, col_offset=31), Attribute(Name('socket', Load(), lineno=282, col_offset=47), 'SOCK_STREAM', Load(), lineno=282, col_offset=47)], [], None, None, lineno=282, col_offset=12), lineno=282, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=284, col_offset=12), 'set_reuse_addr', Load(), lineno=284, col_offset=12), [], [], None, None, lineno=284, col_offset=12), lineno=284, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=285, col_offset=12), 'bind', Load(), lineno=285, col_offset=12), [Name('localaddr', Load(), lineno=285, col_offset=22)], [], None, None, lineno=285, col_offset=12), lineno=285, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=286, col_offset=12), 'listen', Load(), lineno=286, col_offset=12), [Num(5, lineno=286, col_offset=24)], [], None, None, lineno=286, col_offset=12), lineno=286, col_offset=12)], [ExceptHandler(None, None, [Expr(Call(Attribute(Name('self', Load(), lineno=289, col_offset=12), 'close', Load(), lineno=289, col_offset=12), [], [], None, None, lineno=289, col_offset=12), lineno=289, col_offset=12), Raise(None, None, None, lineno=290, col_offset=12)], lineno=287, col_offset=8)], [Print(Name('DEBUGSTREAM', Load(), lineno=292, col_offset=21), [BinOp(Str('%s started at %s\n\tLocal addr: %s\n\tRemote addr:%s', lineno=293, col_offset=18), Mod(), Tuple([Attribute(Attribute(Name('self', Load(), lineno=294, col_offset=16), '__class__', Load(), lineno=294, col_offset=16), '__name__', Load(), lineno=294, col_offset=16), Call(Attribute(Name('time', Load(), lineno=294, col_offset=41), 'ctime', Load(), lineno=294, col_offset=41), [Call(Attribute(Name('time', Load(), lineno=294, col_offset=52), 'time', Load(), lineno=294, col_offset=52), [], [], None, None, lineno=294, col_offset=52)], [], None, None, lineno=294, col_offset=41), Name('localaddr', Load(), lineno=295, col_offset=16), Name('remoteaddr', Load(), lineno=295, col_offset=27)], Load(), lineno=294, col_offset=16), lineno=293, col_offset=18)], True, lineno=292, col_offset=12)], lineno=281, col_offset=8)], [], lineno=277, col_offset=4), FunctionDef('handle_accept', arguments([Name('self', Param(), lineno=297, col_offset=22)], None, None, []), [Assign([Name('pair', Store(), lineno=298, col_offset=8)], Call(Attribute(Name('self', Load(), lineno=298, col_offset=15), 'accept', Load(), lineno=298, col_offset=15), [], [], None, None, lineno=298, col_offset=15), lineno=298, col_offset=8), If(Compare(Name('pair', Load(), lineno=299, col_offset=11), [IsNot()], [Name('None', Load(), lineno=299, col_offset=23)], lineno=299, col_offset=11), [Assign([Tuple([Name('conn', Store(), lineno=300, col_offset=12), Name('addr', Store(), lineno=300, col_offset=18)], Store(), lineno=300, col_offset=12)], Name('pair', Load(), lineno=300, col_offset=25), lineno=300, col_offset=12), Print(Name('DEBUGSTREAM', Load(), lineno=301, col_offset=21), [BinOp(Str('Incoming connection from %s', lineno=301, col_offset=34), Mod(), Call(Name('repr', Load(), lineno=301, col_offset=66), [Name('addr', Load(), lineno=301, col_offset=71)], [], None, None, lineno=301, col_offset=66), lineno=301, col_offset=34)], True, lineno=301, col_offset=12), Assign([Name('channel', Store(), lineno=302, col_offset=12)], Call(Name('SMTPChannel', Load(), lineno=302, col_offset=22), [Name('self', Load(), lineno=302, col_offset=34), Name('conn', Load(), lineno=302, col_offset=40), Name('addr', Load(), lineno=302, col_offset=46)], [], None, None, lineno=302, col_offset=22), lineno=302, col_offset=12)], [], lineno=299, col_offset=8)], [], lineno=297, col_offset=4), FunctionDef('process_message', arguments([Name('self', Param(), lineno=305, col_offset=24), Name('peer', Param(), lineno=305, col_offset=30), Name('mailfrom', Param(), lineno=305, col_offset=36), Name('rcpttos', Param(), lineno=305, col_offset=46), Name('data', Param(), lineno=305, col_offset=55)], None, None, []), [Expr(Str("Override this abstract method to handle messages from the client.\n\n        peer is a tuple containing (ipaddr, port) of the client that made the\n        socket connection to our smtp port.\n\n        mailfrom is the raw address the client claims the message is coming\n        from.\n\n        rcpttos is a list of raw addresses the client wishes to deliver the\n        message to.\n\n        data is a string containing the entire full text of the message,\n        headers (if supplied) and all.  It has been `de-transparencied'\n        according to RFC 821, Section 4.5.2.  In other words, a line\n        containing a `.' followed by other text has had the leading dot\n        removed.\n\n        This function should return None, for a normal `250 Ok' response;\n        otherwise it returns the desired response string in RFC 821 format.\n\n        ", lineno=326, col_offset=-1), lineno=326, col_offset=-1), Raise(Name('NotImplementedError', Load(), lineno=327, col_offset=14), None, None, lineno=327, col_offset=8)], [], lineno=305, col_offset=4)], [], lineno=276, col_offset=0), ClassDef('DebuggingServer', [Name('SMTPServer', Load(), lineno=330, col_offset=22)], [FunctionDef('process_message', arguments([Name('self', Param(), lineno=332, col_offset=24), Name('peer', Param(), lineno=332, col_offset=30), Name('mailfrom', Param(), lineno=332, col_offset=36), Name('rcpttos', Param(), lineno=332, col_offset=46), Name('data', Param(), lineno=332, col_offset=55)], None, None, []), [Assign([Name('inheaders', Store(), lineno=333, col_offset=8)], Num(1, lineno=333, col_offset=20), lineno=333, col_offset=8), Assign([Name('lines', Store(), lineno=334, col_offset=8)], Call(Attribute(Name('data', Load(), lineno=334, col_offset=16), 'split', Load(), lineno=334, col_offset=16), [Str('\n', lineno=334, col_offset=27)], [], None, None, lineno=334, col_offset=16), lineno=334, col_offset=8), Print(None, [Str('---------- MESSAGE FOLLOWS ----------', lineno=335, col_offset=14)], True, lineno=335, col_offset=8), For(Name('line', Store(), lineno=336, col_offset=12), Name('lines', Load(), lineno=336, col_offset=20), [If(BoolOp(And(), [Name('inheaders', Load(), lineno=338, col_offset=15), UnaryOp(Not(), Name('line', Load(), lineno=338, col_offset=33), lineno=338, col_offset=29)], lineno=338, col_offset=15), [Print(None, [Str('X-Peer:', lineno=339, col_offset=22), Subscript(Name('peer', Load(), lineno=339, col_offset=33), Index(Num(0, lineno=339, col_offset=38)), Load(), lineno=339, col_offset=33)], True, lineno=339, col_offset=16), Assign([Name('inheaders', Store(), lineno=340, col_offset=16)], Num(0, lineno=340, col_offset=28), lineno=340, col_offset=16)], [], lineno=338, col_offset=12), Print(None, [Name('line', Load(), lineno=341, col_offset=18)], True, lineno=341, col_offset=12)], [], lineno=336, col_offset=8), Print(None, [Str('------------ END MESSAGE ------------', lineno=342, col_offset=14)], True, lineno=342, col_offset=8)], [], lineno=332, col_offset=4)], [], lineno=330, col_offset=0), ClassDef('PureProxy', [Name('SMTPServer', Load(), lineno=345, col_offset=16)], [FunctionDef('process_message', arguments([Name('self', Param(), lineno=346, col_offset=24), Name('peer', Param(), lineno=346, col_offset=30), Name('mailfrom', Param(), lineno=346, col_offset=36), Name('rcpttos', Param(), lineno=346, col_offset=46), Name('data', Param(), lineno=346, col_offset=55)], None, None, []), [Assign([Name('lines', Store(), lineno=347, col_offset=8)], Call(Attribute(Name('data', Load(), lineno=347, col_offset=16), 'split', Load(), lineno=347, col_offset=16), [Str('\n', lineno=347, col_offset=27)], [], None, None, lineno=347, col_offset=16), lineno=347, col_offset=8), Assign([Name('i', Store(), lineno=349, col_offset=8)], Num(0, lineno=349, col_offset=12), lineno=349, col_offset=8), For(Name('line', Store(), lineno=350, col_offset=12), Name('lines', Load(), lineno=350, col_offset=20), [If(UnaryOp(Not(), Name('line', Load(), lineno=351, col_offset=19), lineno=351, col_offset=15), [Break( lineno=352, col_offset=16)], [], lineno=351, col_offset=12), AugAssign(Name('i', Store(), lineno=353, col_offset=12), Add(), Num(1, lineno=353, col_offset=17), lineno=353, col_offset=12)], [], lineno=350, col_offset=8), Expr(Call(Attribute(Name('lines', Load(), lineno=354, col_offset=8), 'insert', Load(), lineno=354, col_offset=8), [Name('i', Load(), lineno=354, col_offset=21), BinOp(Str('X-Peer: %s', lineno=354, col_offset=24), Mod(), Subscript(Name('peer', Load(), lineno=354, col_offset=39), Index(Num(0, lineno=354, col_offset=44)), Load(), lineno=354, col_offset=39), lineno=354, col_offset=24)], [], None, None, lineno=354, col_offset=8), lineno=354, col_offset=8), Assign([Name('data', Store(), lineno=355, col_offset=8)], Call(Attribute(Name('NEWLINE', Load(), lineno=355, col_offset=15), 'join', Load(), lineno=355, col_offset=15), [Name('lines', Load(), lineno=355, col_offset=28)], [], None, None, lineno=355, col_offset=15), lineno=355, col_offset=8), Assign([Name('refused', Store(), lineno=356, col_offset=8)], Call(Attribute(Name('self', Load(), lineno=356, col_offset=18), '_deliver', Load(), lineno=356, col_offset=18), [Name('mailfrom', Load(), lineno=356, col_offset=32), Name('rcpttos', Load(), lineno=356, col_offset=42), Name('data', Load(), lineno=356, col_offset=51)], [], None, None, lineno=356, col_offset=18), lineno=356, col_offset=8), Print(Name('DEBUGSTREAM', Load(), lineno=358, col_offset=17), [Str('we got some refusals:', lineno=358, col_offset=30), Name('refused', Load(), lineno=358, col_offset=55)], True, lineno=358, col_offset=8)], [], lineno=346, col_offset=4), FunctionDef('_deliver', arguments([Name('self', Param(), lineno=360, col_offset=17), Name('mailfrom', Param(), lineno=360, col_offset=23), Name('rcpttos', Param(), lineno=360, col_offset=33), Name('data', Param(), lineno=360, col_offset=42)], None, None, []), [Import([alias('smtplib', None)], lineno=361, col_offset=8), Assign([Name('refused', Store(), lineno=362, col_offset=8)], Dict([], [], lineno=362, col_offset=18), lineno=362, col_offset=8), TryExcept([Assign([Name('s', Store(), lineno=364, col_offset=12)], Call(Attribute(Name('smtplib', Load(), lineno=364, col_offset=16), 'SMTP', Load(), lineno=364, col_offset=16), [], [], None, None, lineno=364, col_offset=16), lineno=364, col_offset=12), Expr(Call(Attribute(Name('s', Load(), lineno=365, col_offset=12), 'connect', Load(), lineno=365, col_offset=12), [Subscript(Attribute(Name('self', Load(), lineno=365, col_offset=22), '_remoteaddr', Load(), lineno=365, col_offset=22), Index(Num(0, lineno=365, col_offset=39)), Load(), lineno=365, col_offset=22), Subscript(Attribute(Name('self', Load(), lineno=365, col_offset=43), '_remoteaddr', Load(), lineno=365, col_offset=43), Index(Num(1, lineno=365, col_offset=60)), Load(), lineno=365, col_offset=43)], [], None, None, lineno=365, col_offset=12), lineno=365, col_offset=12), TryFinally([Assign([Name('refused', Store(), lineno=367, col_offset=16)], Call(Attribute(Name('s', Load(), lineno=367, col_offset=26), 'sendmail', Load(), lineno=367, col_offset=26), [Name('mailfrom', Load(), lineno=367, col_offset=37), Name('rcpttos', Load(), lineno=367, col_offset=47), Name('data', Load(), lineno=367, col_offset=56)], [], None, None, lineno=367, col_offset=26), lineno=367, col_offset=16)], [Expr(Call(Attribute(Name('s', Load(), lineno=369, col_offset=16), 'quit', Load(), lineno=369, col_offset=16), [], [], None, None, lineno=369, col_offset=16), lineno=369, col_offset=16)], lineno=366, col_offset=12)], [ExceptHandler(Attribute(Name('smtplib', Load(), lineno=370, col_offset=15), 'SMTPRecipientsRefused', Load(), lineno=370, col_offset=15), Name('e', Store(), lineno=370, col_offset=46), [Print(Name('DEBUGSTREAM', Load(), lineno=371, col_offset=21), [Str('got SMTPRecipientsRefused', lineno=371, col_offset=34)], True, lineno=371, col_offset=12), Assign([Name('refused', Store(), lineno=372, col_offset=12)], Attribute(Name('e', Load(), lineno=372, col_offset=22), 'recipients', Load(), lineno=372, col_offset=22), lineno=372, col_offset=12)], lineno=370, col_offset=8), ExceptHandler(Tuple([Attribute(Name('socket', Load(), lineno=373, col_offset=16), 'error', Load(), lineno=373, col_offset=16), Attribute(Name('smtplib', Load(), lineno=373, col_offset=30), 'SMTPException', Load(), lineno=373, col_offset=30)], Load(), lineno=373, col_offset=16), Name('e', Store(), lineno=373, col_offset=54), [Print(Name('DEBUGSTREAM', Load(), lineno=374, col_offset=21), [Str('got', lineno=374, col_offset=34), Attribute(Name('e', Load(), lineno=374, col_offset=41), '__class__', Load(), lineno=374, col_offset=41)], True, lineno=374, col_offset=12), Assign([Name('errcode', Store(), lineno=378, col_offset=12)], Call(Name('getattr', Load(), lineno=378, col_offset=22), [Name('e', Load(), lineno=378, col_offset=30), Str('smtp_code', lineno=378, col_offset=33), Num(-1, lineno=378, col_offset=47)], [], None, None, lineno=378, col_offset=22), lineno=378, col_offset=12), Assign([Name('errmsg', Store(), lineno=379, col_offset=12)], Call(Name('getattr', Load(), lineno=379, col_offset=21), [Name('e', Load(), lineno=379, col_offset=29), Str('smtp_error', lineno=379, col_offset=32), Str('ignore', lineno=379, col_offset=46)], [], None, None, lineno=379, col_offset=21), lineno=379, col_offset=12), For(Name('r', Store(), lineno=380, col_offset=16), Name('rcpttos', Load(), lineno=380, col_offset=21), [Assign([Subscript(Name('refused', Load(), lineno=381, col_offset=16), Index(Name('r', Load(), lineno=381, col_offset=24)), Store(), lineno=381, col_offset=16)], Tuple([Name('errcode', Load(), lineno=381, col_offset=30), Name('errmsg', Load(), lineno=381, col_offset=39)], Load(), lineno=381, col_offset=30), lineno=381, col_offset=16)], [], lineno=380, col_offset=12)], lineno=373, col_offset=8)], [], lineno=363, col_offset=8), Return(Name('refused', Load(), lineno=382, col_offset=15), lineno=382, col_offset=8)], [], lineno=360, col_offset=4)], [], lineno=345, col_offset=0), ClassDef('MailmanProxy', [Name('PureProxy', Load(), lineno=385, col_offset=19)], [FunctionDef('process_message', arguments([Name('self', Param(), lineno=386, col_offset=24), Name('peer', Param(), lineno=386, col_offset=30), Name('mailfrom', Param(), lineno=386, col_offset=36), Name('rcpttos', Param(), lineno=386, col_offset=46), Name('data', Param(), lineno=386, col_offset=55)], None, None, []), [ImportFrom('cStringIO', [alias('StringIO', None)], 0, lineno=387, col_offset=8), ImportFrom('Mailman', [alias('Utils', None)], 0, lineno=388, col_offset=8), ImportFrom('Mailman', [alias('Message', None)], 0, lineno=389, col_offset=8), ImportFrom('Mailman', [alias('MailList', None)], 0, lineno=390, col_offset=8), Assign([Name('listnames', Store(), lineno=394, col_offset=8)], List([], Load(), lineno=394, col_offset=20), lineno=394, col_offset=8), For(Name('rcpt', Store(), lineno=395, col_offset=12), Name('rcpttos', Load(), lineno=395, col_offset=20), [Assign([Name('local', Store(), lineno=396, col_offset=12)], Subscript(Call(Attribute(Call(Attribute(Name('rcpt', Load(), lineno=396, col_offset=20), 'lower', Load(), lineno=396, col_offset=20), [], [], None, None, lineno=396, col_offset=20), 'split', Load(), lineno=396, col_offset=20), [Str('@', lineno=396, col_offset=39)], [], None, None, lineno=396, col_offset=20), Index(Num(0, lineno=396, col_offset=44)), Load(), lineno=396, col_offset=20), lineno=396, col_offset=12), Assign([Name('parts', Store(), lineno=404, col_offset=12)], Call(Attribute(Name('local', Load(), lineno=404, col_offset=20), 'split', Load(), lineno=404, col_offset=20), [Str('-', lineno=404, col_offset=32)], [], None, None, lineno=404, col_offset=20), lineno=404, col_offset=12), If(Compare(Call(Name('len', Load(), lineno=405, col_offset=15), [Name('parts', Load(), lineno=405, col_offset=19)], [], None, None, lineno=405, col_offset=15), [Gt()], [Num(2, lineno=405, col_offset=28)], lineno=405, col_offset=15), [Continue( lineno=406, col_offset=16)], [], lineno=405, col_offset=12), Assign([Name('listname', Store(), lineno=407, col_offset=12)], Subscript(Name('parts', Load(), lineno=407, col_offset=23), Index(Num(0, lineno=407, col_offset=29)), Load(), lineno=407, col_offset=23), lineno=407, col_offset=12), If(Compare(Call(Name('len', Load(), lineno=408, col_offset=15), [Name('parts', Load(), lineno=408, col_offset=19)], [], None, None, lineno=408, col_offset=15), [Eq()], [Num(2, lineno=408, col_offset=29)], lineno=408, col_offset=15), [Assign([Name('command', Store(), lineno=409, col_offset=16)], Subscript(Name('parts', Load(), lineno=409, col_offset=26), Index(Num(1, lineno=409, col_offset=32)), Load(), lineno=409, col_offset=26), lineno=409, col_offset=16)], [Assign([Name('command', Store(), lineno=411, col_offset=16)], Str('', lineno=411, col_offset=26), lineno=411, col_offset=16)], lineno=408, col_offset=12), If(BoolOp(Or(), [UnaryOp(Not(), Call(Attribute(Name('Utils', Load(), lineno=412, col_offset=19), 'list_exists', Load(), lineno=412, col_offset=19), [Name('listname', Load(), lineno=412, col_offset=37)], [], None, None, lineno=412, col_offset=19), lineno=412, col_offset=15), Compare(Name('command', Load(), lineno=412, col_offset=50), [NotIn()], [Tuple([Str('', lineno=413, col_offset=20), Str('admin', lineno=413, col_offset=24), Str('owner', lineno=413, col_offset=33), Str('request', lineno=413, col_offset=42), Str('join', lineno=413, col_offset=53), Str('leave', lineno=413, col_offset=61)], Load(), lineno=413, col_offset=20)], lineno=412, col_offset=50)], lineno=412, col_offset=15), [Continue( lineno=414, col_offset=16)], [], lineno=412, col_offset=12), Expr(Call(Attribute(Name('listnames', Load(), lineno=415, col_offset=12), 'append', Load(), lineno=415, col_offset=12), [Tuple([Name('rcpt', Load(), lineno=415, col_offset=30), Name('listname', Load(), lineno=415, col_offset=36), Name('command', Load(), lineno=415, col_offset=46)], Load(), lineno=415, col_offset=30)], [], None, None, lineno=415, col_offset=12), lineno=415, col_offset=12)], [], lineno=395, col_offset=8), For(Tuple([Name('rcpt', Store(), lineno=419, col_offset=12), Name('listname', Store(), lineno=419, col_offset=18), Name('command', Store(), lineno=419, col_offset=28)], Store(), lineno=419, col_offset=12), Name('listnames', Load(), lineno=419, col_offset=39), [Expr(Call(Attribute(Name('rcpttos', Load(), lineno=420, col_offset=12), 'remove', Load(), lineno=420, col_offset=12), [Name('rcpt', Load(), lineno=420, col_offset=27)], [], None, None, lineno=420, col_offset=12), lineno=420, col_offset=12)], [], lineno=419, col_offset=8), Print(Name('DEBUGSTREAM', Load(), lineno=422, col_offset=17), [Str('forwarding recips:', lineno=422, col_offset=30), Call(Attribute(Str(' ', lineno=422, col_offset=52), 'join', Load(), lineno=422, col_offset=52), [Name('rcpttos', Load(), lineno=422, col_offset=61)], [], None, None, lineno=422, col_offset=52)], True, lineno=422, col_offset=8), If(Name('rcpttos', Load(), lineno=423, col_offset=11), [Assign([Name('refused', Store(), lineno=424, col_offset=12)], Call(Attribute(Name('self', Load(), lineno=424, col_offset=22), '_deliver', Load(), lineno=424, col_offset=22), [Name('mailfrom', Load(), lineno=424, col_offset=36), Name('rcpttos', Load(), lineno=424, col_offset=46), Name('data', Load(), lineno=424, col_offset=55)], [], None, None, lineno=424, col_offset=22), lineno=424, col_offset=12), Print(Name('DEBUGSTREAM', Load(), lineno=426, col_offset=21), [Str('we got refusals:', lineno=426, col_offset=34), Name('refused', Load(), lineno=426, col_offset=54)], True, lineno=426, col_offset=12)], [], lineno=423, col_offset=8), Assign([Name('mlists', Store(), lineno=428, col_offset=8)], Dict([], [], lineno=428, col_offset=17), lineno=428, col_offset=8), Assign([Name('s', Store(), lineno=429, col_offset=8)], Call(Name('StringIO', Load(), lineno=429, col_offset=12), [Name('data', Load(), lineno=429, col_offset=21)], [], None, None, lineno=429, col_offset=12), lineno=429, col_offset=8), Assign([Name('msg', Store(), lineno=430, col_offset=8)], Call(Attribute(Name('Message', Load(), lineno=430, col_offset=14), 'Message', Load(), lineno=430, col_offset=14), [Name('s', Load(), lineno=430, col_offset=30)], [], None, None, lineno=430, col_offset=14), lineno=430, col_offset=8), If(UnaryOp(Not(), Call(Attribute(Name('msg', Load(), lineno=434, col_offset=15), 'getheader', Load(), lineno=434, col_offset=15), [Str('from', lineno=434, col_offset=29)], [], None, None, lineno=434, col_offset=15), lineno=434, col_offset=11), [Assign([Subscript(Name('msg', Load(), lineno=435, col_offset=12), Index(Str('From', lineno=435, col_offset=16)), Store(), lineno=435, col_offset=12)], Name('mailfrom', Load(), lineno=435, col_offset=26), lineno=435, col_offset=12)], [], lineno=434, col_offset=8), If(UnaryOp(Not(), Call(Attribute(Name('msg', Load(), lineno=436, col_offset=15), 'getheader', Load(), lineno=436, col_offset=15), [Str('date', lineno=436, col_offset=29)], [], None, None, lineno=436, col_offset=15), lineno=436, col_offset=11), [Assign([Subscript(Name('msg', Load(), lineno=437, col_offset=12), Index(Str('Date', lineno=437, col_offset=16)), Store(), lineno=437, col_offset=12)], Call(Attribute(Name('time', Load(), lineno=437, col_offset=26), 'ctime', Load(), lineno=437, col_offset=26), [Call(Attribute(Name('time', Load(), lineno=437, col_offset=37), 'time', Load(), lineno=437, col_offset=37), [], [], None, None, lineno=437, col_offset=37)], [], None, None, lineno=437, col_offset=26), lineno=437, col_offset=12)], [], lineno=436, col_offset=8), For(Tuple([Name('rcpt', Store(), lineno=438, col_offset=12), Name('listname', Store(), lineno=438, col_offset=18), Name('command', Store(), lineno=438, col_offset=28)], Store(), lineno=438, col_offset=12), Name('listnames', Load(), lineno=438, col_offset=39), [Print(Name('DEBUGSTREAM', Load(), lineno=439, col_offset=21), [Str('sending message to', lineno=439, col_offset=34), Name('rcpt', Load(), lineno=439, col_offset=56)], True, lineno=439, col_offset=12), Assign([Name('mlist', Store(), lineno=440, col_offset=12)], Call(Attribute(Name('mlists', Load(), lineno=440, col_offset=20), 'get', Load(), lineno=440, col_offset=20), [Name('listname', Load(), lineno=440, col_offset=31)], [], None, None, lineno=440, col_offset=20), lineno=440, col_offset=12), If(UnaryOp(Not(), Name('mlist', Load(), lineno=441, col_offset=19), lineno=441, col_offset=15), [Assign([Name('mlist', Store(), lineno=442, col_offset=16)], Call(Attribute(Name('MailList', Load(), lineno=442, col_offset=24), 'MailList', Load(), lineno=442, col_offset=24), [Name('listname', Load(), lineno=442, col_offset=42)], [keyword('lock', Num(0, lineno=442, col_offset=57))], None, None, lineno=442, col_offset=24), lineno=442, col_offset=16), Assign([Subscript(Name('mlists', Load(), lineno=443, col_offset=16), Index(Name('listname', Load(), lineno=443, col_offset=23)), Store(), lineno=443, col_offset=16)], Name('mlist', Load(), lineno=443, col_offset=35), lineno=443, col_offset=16)], [], lineno=441, col_offset=12), If(Compare(Name('command', Load(), lineno=445, col_offset=15), [Eq()], [Str('', lineno=445, col_offset=26)], lineno=445, col_offset=15), [Expr(Call(Attribute(Name('msg', Load(), lineno=447, col_offset=16), 'Enqueue', Load(), lineno=447, col_offset=16), [Name('mlist', Load(), lineno=447, col_offset=28)], [keyword('tolist', Num(1, lineno=447, col_offset=42))], None, None, lineno=447, col_offset=16), lineno=447, col_offset=16)], [If(Compare(Name('command', Load(), lineno=448, col_offset=17), [Eq()], [Str('admin', lineno=448, col_offset=28)], lineno=448, col_offset=17), [Expr(Call(Attribute(Name('msg', Load(), lineno=449, col_offset=16), 'Enqueue', Load(), lineno=449, col_offset=16), [Name('mlist', Load(), lineno=449, col_offset=28)], [keyword('toadmin', Num(1, lineno=449, col_offset=43))], None, None, lineno=449, col_offset=16), lineno=449, col_offset=16)], [If(Compare(Name('command', Load(), lineno=450, col_offset=17), [Eq()], [Str('owner', lineno=450, col_offset=28)], lineno=450, col_offset=17), [Expr(Call(Attribute(Name('msg', Load(), lineno=451, col_offset=16), 'Enqueue', Load(), lineno=451, col_offset=16), [Name('mlist', Load(), lineno=451, col_offset=28)], [keyword('toowner', Num(1, lineno=451, col_offset=43))], None, None, lineno=451, col_offset=16), lineno=451, col_offset=16)], [If(Compare(Name('command', Load(), lineno=452, col_offset=17), [Eq()], [Str('request', lineno=452, col_offset=28)], lineno=452, col_offset=17), [Expr(Call(Attribute(Name('msg', Load(), lineno=453, col_offset=16), 'Enqueue', Load(), lineno=453, col_offset=16), [Name('mlist', Load(), lineno=453, col_offset=28)], [keyword('torequest', Num(1, lineno=453, col_offset=45))], None, None, lineno=453, col_offset=16), lineno=453, col_offset=16)], [If(Compare(Name('command', Load(), lineno=454, col_offset=17), [In()], [Tuple([Str('join', lineno=454, col_offset=29), Str('leave', lineno=454, col_offset=37)], Load(), lineno=454, col_offset=29)], lineno=454, col_offset=17), [If(Compare(Name('command', Load(), lineno=456, col_offset=19), [Eq()], [Str('join', lineno=456, col_offset=30)], lineno=456, col_offset=19), [Assign([Subscript(Name('msg', Load(), lineno=457, col_offset=20), Index(Str('Subject', lineno=457, col_offset=24)), Store(), lineno=457, col_offset=20)], Str('subscribe', lineno=457, col_offset=37), lineno=457, col_offset=20)], [Assign([Subscript(Name('msg', Load(), lineno=459, col_offset=20), Index(Str('Subject', lineno=459, col_offset=24)), Store(), lineno=459, col_offset=20)], Str('unsubscribe', lineno=459, col_offset=37), lineno=459, col_offset=20)], lineno=456, col_offset=16), Expr(Call(Attribute(Name('msg', Load(), lineno=460, col_offset=16), 'Enqueue', Load(), lineno=460, col_offset=16), [Name('mlist', Load(), lineno=460, col_offset=28)], [keyword('torequest', Num(1, lineno=460, col_offset=45))], None, None, lineno=460, col_offset=16), lineno=460, col_offset=16)], [], lineno=454, col_offset=17)], lineno=452, col_offset=17)], lineno=450, col_offset=17)], lineno=448, col_offset=17)], lineno=445, col_offset=12)], [], lineno=438, col_offset=8)], [], lineno=386, col_offset=4)], [], lineno=385, col_offset=0), ClassDef('Options', [], [Assign([Name('setuid', Store(), lineno=464, col_offset=4)], Num(1, lineno=464, col_offset=13), lineno=464, col_offset=4), Assign([Name('classname', Store(), lineno=465, col_offset=4)], Str('PureProxy', lineno=465, col_offset=16), lineno=465, col_offset=4)], [], lineno=463, col_offset=0), FunctionDef('parseargs', arguments([], None, None, []), [Global(['DEBUGSTREAM'], lineno=469, col_offset=4), TryExcept([Assign([Tuple([Name('opts', Store(), lineno=471, col_offset=8), Name('args', Store(), lineno=471, col_offset=14)], Store(), lineno=471, col_offset=8)], Call(Attribute(Name('getopt', Load(), lineno=471, col_offset=21), 'getopt', Load(), lineno=471, col_offset=21), [Subscript(Attribute(Name('sys', Load(), lineno=472, col_offset=12), 'argv', Load(), lineno=472, col_offset=12), Slice(Num(1, lineno=472, col_offset=21), None, None), Load(), lineno=472, col_offset=12), Str('nVhc:d', lineno=472, col_offset=26), List([Str('class=', lineno=473, col_offset=13), Str('nosetuid', lineno=473, col_offset=23), Str('version', lineno=473, col_offset=35), Str('help', lineno=473, col_offset=46), Str('debug', lineno=473, col_offset=54)], Load(), lineno=473, col_offset=12)], [], None, None, lineno=471, col_offset=21), lineno=471, col_offset=8)], [ExceptHandler(Attribute(Name('getopt', Load(), lineno=474, col_offset=11), 'error', Load(), lineno=474, col_offset=11), Name('e', Store(), lineno=474, col_offset=25), [Expr(Call(Name('usage', Load(), lineno=475, col_offset=8), [Num(1, lineno=475, col_offset=14), Name('e', Load(), lineno=475, col_offset=17)], [], None, None, lineno=475, col_offset=8), lineno=475, col_offset=8)], lineno=474, col_offset=4)], [], lineno=470, col_offset=4), Assign([Name('options', Store(), lineno=477, col_offset=4)], Call(Name('Options', Load(), lineno=477, col_offset=14), [], [], None, None, lineno=477, col_offset=14), lineno=477, col_offset=4), For(Tuple([Name('opt', Store(), lineno=478, col_offset=8), Name('arg', Store(), lineno=478, col_offset=13)], Store(), lineno=478, col_offset=8), Name('opts', Load(), lineno=478, col_offset=20), [If(Compare(Name('opt', Load(), lineno=479, col_offset=11), [In()], [Tuple([Str('-h', lineno=479, col_offset=19), Str('--help', lineno=479, col_offset=25)], Load(), lineno=479, col_offset=19)], lineno=479, col_offset=11), [Expr(Call(Name('usage', Load(), lineno=480, col_offset=12), [Num(0, lineno=480, col_offset=18)], [], None, None, lineno=480, col_offset=12), lineno=480, col_offset=12)], [If(Compare(Name('opt', Load(), lineno=481, col_offset=13), [In()], [Tuple([Str('-V', lineno=481, col_offset=21), Str('--version', lineno=481, col_offset=27)], Load(), lineno=481, col_offset=21)], lineno=481, col_offset=13), [Print(Attribute(Name('sys', Load(), lineno=482, col_offset=21), 'stderr', Load(), lineno=482, col_offset=21), [Name('__version__', Load(), lineno=482, col_offset=33)], True, lineno=482, col_offset=12), Expr(Call(Attribute(Name('sys', Load(), lineno=483, col_offset=12), 'exit', Load(), lineno=483, col_offset=12), [Num(0, lineno=483, col_offset=21)], [], None, None, lineno=483, col_offset=12), lineno=483, col_offset=12)], [If(Compare(Name('opt', Load(), lineno=484, col_offset=13), [In()], [Tuple([Str('-n', lineno=484, col_offset=21), Str('--nosetuid', lineno=484, col_offset=27)], Load(), lineno=484, col_offset=21)], lineno=484, col_offset=13), [Assign([Attribute(Name('options', Load(), lineno=485, col_offset=12), 'setuid', Store(), lineno=485, col_offset=12)], Num(0, lineno=485, col_offset=29), lineno=485, col_offset=12)], [If(Compare(Name('opt', Load(), lineno=486, col_offset=13), [In()], [Tuple([Str('-c', lineno=486, col_offset=21), Str('--class', lineno=486, col_offset=27)], Load(), lineno=486, col_offset=21)], lineno=486, col_offset=13), [Assign([Attribute(Name('options', Load(), lineno=487, col_offset=12), 'classname', Store(), lineno=487, col_offset=12)], Name('arg', Load(), lineno=487, col_offset=32), lineno=487, col_offset=12)], [If(Compare(Name('opt', Load(), lineno=488, col_offset=13), [In()], [Tuple([Str('-d', lineno=488, col_offset=21), Str('--debug', lineno=488, col_offset=27)], Load(), lineno=488, col_offset=21)], lineno=488, col_offset=13), [Assign([Name('DEBUGSTREAM', Store(), lineno=489, col_offset=12)], Attribute(Name('sys', Load(), lineno=489, col_offset=26), 'stderr', Load(), lineno=489, col_offset=26), lineno=489, col_offset=12)], [], lineno=488, col_offset=13)], lineno=486, col_offset=13)], lineno=484, col_offset=13)], lineno=481, col_offset=13)], lineno=479, col_offset=8)], [], lineno=478, col_offset=4), If(Compare(Call(Name('len', Load(), lineno=492, col_offset=7), [Name('args', Load(), lineno=492, col_offset=11)], [], None, None, lineno=492, col_offset=7), [Lt()], [Num(1, lineno=492, col_offset=19)], lineno=492, col_offset=7), [Assign([Name('localspec', Store(), lineno=493, col_offset=8)], Str('localhost:8025', lineno=493, col_offset=20), lineno=493, col_offset=8), Assign([Name('remotespec', Store(), lineno=494, col_offset=8)], Str('localhost:25', lineno=494, col_offset=21), lineno=494, col_offset=8)], [If(Compare(Call(Name('len', Load(), lineno=495, col_offset=9), [Name('args', Load(), lineno=495, col_offset=13)], [], None, None, lineno=495, col_offset=9), [Lt()], [Num(2, lineno=495, col_offset=21)], lineno=495, col_offset=9), [Assign([Name('localspec', Store(), lineno=496, col_offset=8)], Subscript(Name('args', Load(), lineno=496, col_offset=20), Index(Num(0, lineno=496, col_offset=25)), Load(), lineno=496, col_offset=20), lineno=496, col_offset=8), Assign([Name('remotespec', Store(), lineno=497, col_offset=8)], Str('localhost:25', lineno=497, col_offset=21), lineno=497, col_offset=8)], [If(Compare(Call(Name('len', Load(), lineno=498, col_offset=9), [Name('args', Load(), lineno=498, col_offset=13)], [], None, None, lineno=498, col_offset=9), [Lt()], [Num(3, lineno=498, col_offset=21)], lineno=498, col_offset=9), [Assign([Name('localspec', Store(), lineno=499, col_offset=8)], Subscript(Name('args', Load(), lineno=499, col_offset=20), Index(Num(0, lineno=499, col_offset=25)), Load(), lineno=499, col_offset=20), lineno=499, col_offset=8), Assign([Name('remotespec', Store(), lineno=500, col_offset=8)], Subscript(Name('args', Load(), lineno=500, col_offset=21), Index(Num(1, lineno=500, col_offset=26)), Load(), lineno=500, col_offset=21), lineno=500, col_offset=8)], [Expr(Call(Name('usage', Load(), lineno=502, col_offset=8), [Num(1, lineno=502, col_offset=14), BinOp(Str('Invalid arguments: %s', lineno=502, col_offset=17), Mod(), Call(Attribute(Name('COMMASPACE', Load(), lineno=502, col_offset=43), 'join', Load(), lineno=502, col_offset=43), [Name('args', Load(), lineno=502, col_offset=59)], [], None, None, lineno=502, col_offset=43), lineno=502, col_offset=17)], [], None, None, lineno=502, col_offset=8), lineno=502, col_offset=8)], lineno=498, col_offset=9)], lineno=495, col_offset=9)], lineno=492, col_offset=4), Assign([Name('i', Store(), lineno=505, col_offset=4)], Call(Attribute(Name('localspec', Load(), lineno=505, col_offset=8), 'find', Load(), lineno=505, col_offset=8), [Str(':', lineno=505, col_offset=23)], [], None, None, lineno=505, col_offset=8), lineno=505, col_offset=4), If(Compare(Name('i', Load(), lineno=506, col_offset=7), [Lt()], [Num(0, lineno=506, col_offset=11)], lineno=506, col_offset=7), [Expr(Call(Name('usage', Load(), lineno=507, col_offset=8), [Num(1, lineno=507, col_offset=14), BinOp(Str('Bad local spec: %s', lineno=507, col_offset=17), Mod(), Name('localspec', Load(), lineno=507, col_offset=40), lineno=507, col_offset=17)], [], None, None, lineno=507, col_offset=8), lineno=507, col_offset=8)], [], lineno=506, col_offset=4), Assign([Attribute(Name('options', Load(), lineno=508, col_offset=4), 'localhost', Store(), lineno=508, col_offset=4)], Subscript(Name('localspec', Load(), lineno=508, col_offset=24), Slice(None, Name('i', Load(), lineno=508, col_offset=35), None), Load(), lineno=508, col_offset=24), lineno=508, col_offset=4), TryExcept([Assign([Attribute(Name('options', Load(), lineno=510, col_offset=8), 'localport', Store(), lineno=510, col_offset=8)], Call(Name('int', Load(), lineno=510, col_offset=28), [Subscript(Name('localspec', Load(), lineno=510, col_offset=32), Slice(BinOp(Name('i', Load(), lineno=510, col_offset=42), Add(), Num(1, lineno=510, col_offset=44), lineno=510, col_offset=42), None, None), Load(), lineno=510, col_offset=32)], [], None, None, lineno=510, col_offset=28), lineno=510, col_offset=8)], [ExceptHandler(Name('ValueError', Load(), lineno=511, col_offset=11), None, [Expr(Call(Name('usage', Load(), lineno=512, col_offset=8), [Num(1, lineno=512, col_offset=14), BinOp(Str('Bad local port: %s', lineno=512, col_offset=17), Mod(), Name('localspec', Load(), lineno=512, col_offset=40), lineno=512, col_offset=17)], [], None, None, lineno=512, col_offset=8), lineno=512, col_offset=8)], lineno=511, col_offset=4)], [], lineno=509, col_offset=4), Assign([Name('i', Store(), lineno=513, col_offset=4)], Call(Attribute(Name('remotespec', Load(), lineno=513, col_offset=8), 'find', Load(), lineno=513, col_offset=8), [Str(':', lineno=513, col_offset=24)], [], None, None, lineno=513, col_offset=8), lineno=513, col_offset=4), If(Compare(Name('i', Load(), lineno=514, col_offset=7), [Lt()], [Num(0, lineno=514, col_offset=11)], lineno=514, col_offset=7), [Expr(Call(Name('usage', Load(), lineno=515, col_offset=8), [Num(1, lineno=515, col_offset=14), BinOp(Str('Bad remote spec: %s', lineno=515, col_offset=17), Mod(), Name('remotespec', Load(), lineno=515, col_offset=41), lineno=515, col_offset=17)], [], None, None, lineno=515, col_offset=8), lineno=515, col_offset=8)], [], lineno=514, col_offset=4), Assign([Attribute(Name('options', Load(), lineno=516, col_offset=4), 'remotehost', Store(), lineno=516, col_offset=4)], Subscript(Name('remotespec', Load(), lineno=516, col_offset=25), Slice(None, Name('i', Load(), lineno=516, col_offset=37), None), Load(), lineno=516, col_offset=25), lineno=516, col_offset=4), TryExcept([Assign([Attribute(Name('options', Load(), lineno=518, col_offset=8), 'remoteport', Store(), lineno=518, col_offset=8)], Call(Name('int', Load(), lineno=518, col_offset=29), [Subscript(Name('remotespec', Load(), lineno=518, col_offset=33), Slice(BinOp(Name('i', Load(), lineno=518, col_offset=44), Add(), Num(1, lineno=518, col_offset=46), lineno=518, col_offset=44), None, None), Load(), lineno=518, col_offset=33)], [], None, None, lineno=518, col_offset=29), lineno=518, col_offset=8)], [ExceptHandler(Name('ValueError', Load(), lineno=519, col_offset=11), None, [Expr(Call(Name('usage', Load(), lineno=520, col_offset=8), [Num(1, lineno=520, col_offset=14), BinOp(Str('Bad remote port: %s', lineno=520, col_offset=17), Mod(), Name('remotespec', Load(), lineno=520, col_offset=41), lineno=520, col_offset=17)], [], None, None, lineno=520, col_offset=8), lineno=520, col_offset=8)], lineno=519, col_offset=4)], [], lineno=517, col_offset=4), Return(Name('options', Load(), lineno=521, col_offset=11), lineno=521, col_offset=4)], [], lineno=468, col_offset=0), If(Compare(Name('__name__', Load(), lineno=524, col_offset=3), [Eq()], [Str('__main__', lineno=524, col_offset=15)], lineno=524, col_offset=3), [Assign([Name('options', Store(), lineno=525, col_offset=4)], Call(Name('parseargs', Load(), lineno=525, col_offset=14), [], [], None, None, lineno=525, col_offset=14), lineno=525, col_offset=4), If(Attribute(Name('options', Load(), lineno=527, col_offset=7), 'setuid', Load(), lineno=527, col_offset=7), [TryExcept([Import([alias('pwd', None)], lineno=529, col_offset=12)], [ExceptHandler(Name('ImportError', Load(), lineno=530, col_offset=15), None, [Print(Attribute(Name('sys', Load(), lineno=531, col_offset=21), 'stderr', Load(), lineno=531, col_offset=21), [Str('Cannot import module "pwd"; try running with -n option.', lineno=532, col_offset=18)], True, lineno=531, col_offset=12), Expr(Call(Attribute(Name('sys', Load(), lineno=533, col_offset=12), 'exit', Load(), lineno=533, col_offset=12), [Num(1, lineno=533, col_offset=21)], [], None, None, lineno=533, col_offset=12), lineno=533, col_offset=12)], lineno=530, col_offset=8)], [], lineno=528, col_offset=8), Assign([Name('nobody', Store(), lineno=534, col_offset=8)], Subscript(Call(Attribute(Name('pwd', Load(), lineno=534, col_offset=17), 'getpwnam', Load(), lineno=534, col_offset=17), [Str('nobody', lineno=534, col_offset=30)], [], None, None, lineno=534, col_offset=17), Index(Num(2, lineno=534, col_offset=40)), Load(), lineno=534, col_offset=17), lineno=534, col_offset=8), TryExcept([Expr(Call(Attribute(Name('os', Load(), lineno=536, col_offset=12), 'setuid', Load(), lineno=536, col_offset=12), [Name('nobody', Load(), lineno=536, col_offset=22)], [], None, None, lineno=536, col_offset=12), lineno=536, col_offset=12)], [ExceptHandler(Name('OSError', Load(), lineno=537, col_offset=15), Name('e', Store(), lineno=537, col_offset=24), [If(Compare(Attribute(Name('e', Load(), lineno=538, col_offset=15), 'errno', Load(), lineno=538, col_offset=15), [NotEq()], [Attribute(Name('errno', Load(), lineno=538, col_offset=26), 'EPERM', Load(), lineno=538, col_offset=26)], lineno=538, col_offset=15), [Raise(None, None, None, lineno=538, col_offset=39)], [], lineno=538, col_offset=12), Print(Attribute(Name('sys', Load(), lineno=539, col_offset=21), 'stderr', Load(), lineno=539, col_offset=21), [Str('Cannot setuid "nobody"; try running with -n option.', lineno=540, col_offset=18)], True, lineno=539, col_offset=12), Expr(Call(Attribute(Name('sys', Load(), lineno=541, col_offset=12), 'exit', Load(), lineno=541, col_offset=12), [Num(1, lineno=541, col_offset=21)], [], None, None, lineno=541, col_offset=12), lineno=541, col_offset=12)], lineno=537, col_offset=8)], [], lineno=535, col_offset=8)], [], lineno=527, col_offset=4), Assign([Name('classname', Store(), lineno=542, col_offset=4)], Attribute(Name('options', Load(), lineno=542, col_offset=16), 'classname', Load(), lineno=542, col_offset=16), lineno=542, col_offset=4), If(Compare(Str('.', lineno=543, col_offset=7), [In()], [Name('classname', Load(), lineno=543, col_offset=14)], lineno=543, col_offset=7), [Assign([Name('lastdot', Store(), lineno=544, col_offset=8)], Call(Attribute(Name('classname', Load(), lineno=544, col_offset=18), 'rfind', Load(), lineno=544, col_offset=18), [Str('.', lineno=544, col_offset=34)], [], None, None, lineno=544, col_offset=18), lineno=544, col_offset=8), Assign([Name('mod', Store(), lineno=545, col_offset=8)], Call(Name('__import__', Load(), lineno=545, col_offset=14), [Subscript(Name('classname', Load(), lineno=545, col_offset=25), Slice(None, Name('lastdot', Load(), lineno=545, col_offset=36), None), Load(), lineno=545, col_offset=25), Call(Name('globals', Load(), lineno=545, col_offset=46), [], [], None, None, lineno=545, col_offset=46), Call(Name('locals', Load(), lineno=545, col_offset=57), [], [], None, None, lineno=545, col_offset=57), List([Str('', lineno=545, col_offset=68)], Load(), lineno=545, col_offset=67)], [], None, None, lineno=545, col_offset=14), lineno=545, col_offset=8), Assign([Name('classname', Store(), lineno=546, col_offset=8)], Subscript(Name('classname', Load(), lineno=546, col_offset=20), Slice(BinOp(Name('lastdot', Load(), lineno=546, col_offset=30), Add(), Num(1, lineno=546, col_offset=38), lineno=546, col_offset=30), None, None), Load(), lineno=546, col_offset=20), lineno=546, col_offset=8)], [Import([alias('__main__', 'mod')], lineno=548, col_offset=8)], lineno=543, col_offset=4), Assign([Name('class_', Store(), lineno=549, col_offset=4)], Call(Name('getattr', Load(), lineno=549, col_offset=13), [Name('mod', Load(), lineno=549, col_offset=21), Name('classname', Load(), lineno=549, col_offset=26)], [], None, None, lineno=549, col_offset=13), lineno=549, col_offset=4), Assign([Name('proxy', Store(), lineno=550, col_offset=4)], Call(Name('class_', Load(), lineno=550, col_offset=12), [Tuple([Attribute(Name('options', Load(), lineno=550, col_offset=20), 'localhost', Load(), lineno=550, col_offset=20), Attribute(Name('options', Load(), lineno=550, col_offset=39), 'localport', Load(), lineno=550, col_offset=39)], Load(), lineno=550, col_offset=20), Tuple([Attribute(Name('options', Load(), lineno=551, col_offset=20), 'remotehost', Load(), lineno=551, col_offset=20), Attribute(Name('options', Load(), lineno=551, col_offset=40), 'remoteport', Load(), lineno=551, col_offset=40)], Load(), lineno=551, col_offset=20)], [], None, None, lineno=550, col_offset=12), lineno=550, col_offset=4), TryExcept([Expr(Call(Attribute(Name('asyncore', Load(), lineno=553, col_offset=8), 'loop', Load(), lineno=553, col_offset=8), [], [], None, None, lineno=553, col_offset=8), lineno=553, col_offset=8)], [ExceptHandler(Name('KeyboardInterrupt', Load(), lineno=554, col_offset=11), None, [Pass( lineno=555, col_offset=8)], lineno=554, col_offset=4)], [], lineno=552, col_offset=4)], [], lineno=524, col_offset=0)])
