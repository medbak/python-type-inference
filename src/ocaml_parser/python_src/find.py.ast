Module([Import([alias('sys', None)], lineno=18, col_offset=0), Import([alias('getopt', None)], lineno=19, col_offset=0), Import([alias('string', None)], lineno=20, col_offset=0), Import([alias('time', None)], lineno=21, col_offset=0), Import([alias('os', None)], lineno=22, col_offset=0), ImportFrom('stat', [alias('*', None)], 0, lineno=23, col_offset=0), Import([alias('thread', None)], lineno=24, col_offset=0), ClassDef('WorkQ', [], [FunctionDef('__init__', arguments([Name('self', Param(), lineno=44, col_offset=17)], None, None, []), [Assign([Attribute(Name('self', Load(), lineno=45, col_offset=8), 'mutex', Store(), lineno=45, col_offset=8)], Call(Attribute(Name('thread', Load(), lineno=45, col_offset=21), 'allocate', Load(), lineno=45, col_offset=21), [], [], None, None, lineno=45, col_offset=21), lineno=45, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=46, col_offset=8), 'todo', Store(), lineno=46, col_offset=8)], Call(Attribute(Name('thread', Load(), lineno=46, col_offset=20), 'allocate', Load(), lineno=46, col_offset=20), [], [], None, None, lineno=46, col_offset=20), lineno=46, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=47, col_offset=8), 'todo', Load(), lineno=47, col_offset=8), 'acquire', Load(), lineno=47, col_offset=8), [], [], None, None, lineno=47, col_offset=8), lineno=47, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=48, col_offset=8), 'work', Store(), lineno=48, col_offset=8)], List([], Load(), lineno=48, col_offset=20), lineno=48, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=49, col_offset=8), 'busy', Store(), lineno=49, col_offset=8)], Num(0, lineno=49, col_offset=20), lineno=49, col_offset=8)], [], lineno=44, col_offset=4), FunctionDef('addwork', arguments([Name('self', Param(), lineno=51, col_offset=16), Name('func', Param(), lineno=51, col_offset=22), Name('args', Param(), lineno=51, col_offset=28)], None, None, []), [Assign([Name('job', Store(), lineno=52, col_offset=8)], Tuple([Name('func', Load(), lineno=52, col_offset=15), Name('args', Load(), lineno=52, col_offset=21)], Load(), lineno=52, col_offset=15), lineno=52, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=53, col_offset=8), 'mutex', Load(), lineno=53, col_offset=8), 'acquire', Load(), lineno=53, col_offset=8), [], [], None, None, lineno=53, col_offset=8), lineno=53, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=54, col_offset=8), 'work', Load(), lineno=54, col_offset=8), 'append', Load(), lineno=54, col_offset=8), [Name('job', Load(), lineno=54, col_offset=25)], [], None, None, lineno=54, col_offset=8), lineno=54, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=55, col_offset=8), 'mutex', Load(), lineno=55, col_offset=8), 'release', Load(), lineno=55, col_offset=8), [], [], None, None, lineno=55, col_offset=8), lineno=55, col_offset=8), If(Compare(Call(Name('len', Load(), lineno=56, col_offset=11), [Attribute(Name('self', Load(), lineno=56, col_offset=15), 'work', Load(), lineno=56, col_offset=15)], [], None, None, lineno=56, col_offset=11), [Eq()], [Num(1, lineno=56, col_offset=29)], lineno=56, col_offset=11), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=57, col_offset=12), 'todo', Load(), lineno=57, col_offset=12), 'release', Load(), lineno=57, col_offset=12), [], [], None, None, lineno=57, col_offset=12), lineno=57, col_offset=12)], [], lineno=56, col_offset=8)], [], lineno=51, col_offset=4), FunctionDef('_getwork', arguments([Name('self', Param(), lineno=59, col_offset=17)], None, None, []), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=60, col_offset=8), 'todo', Load(), lineno=60, col_offset=8), 'acquire', Load(), lineno=60, col_offset=8), [], [], None, None, lineno=60, col_offset=8), lineno=60, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=61, col_offset=8), 'mutex', Load(), lineno=61, col_offset=8), 'acquire', Load(), lineno=61, col_offset=8), [], [], None, None, lineno=61, col_offset=8), lineno=61, col_offset=8), If(BoolOp(And(), [Compare(Attribute(Name('self', Load(), lineno=62, col_offset=11), 'busy', Load(), lineno=62, col_offset=11), [Eq()], [Num(0, lineno=62, col_offset=24)], lineno=62, col_offset=11), Compare(Call(Name('len', Load(), lineno=62, col_offset=30), [Attribute(Name('self', Load(), lineno=62, col_offset=34), 'work', Load(), lineno=62, col_offset=34)], [], None, None, lineno=62, col_offset=30), [Eq()], [Num(0, lineno=62, col_offset=48)], lineno=62, col_offset=30)], lineno=62, col_offset=11), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=63, col_offset=12), 'mutex', Load(), lineno=63, col_offset=12), 'release', Load(), lineno=63, col_offset=12), [], [], None, None, lineno=63, col_offset=12), lineno=63, col_offset=12), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=64, col_offset=12), 'todo', Load(), lineno=64, col_offset=12), 'release', Load(), lineno=64, col_offset=12), [], [], None, None, lineno=64, col_offset=12), lineno=64, col_offset=12), Return(Name('None', Load(), lineno=65, col_offset=19), lineno=65, col_offset=12)], [], lineno=62, col_offset=8), Assign([Name('job', Store(), lineno=66, col_offset=8)], Subscript(Attribute(Name('self', Load(), lineno=66, col_offset=14), 'work', Load(), lineno=66, col_offset=14), Index(Num(0, lineno=66, col_offset=24)), Load(), lineno=66, col_offset=14), lineno=66, col_offset=8), Delete([Subscript(Attribute(Name('self', Load(), lineno=67, col_offset=12), 'work', Load(), lineno=67, col_offset=12), Index(Num(0, lineno=67, col_offset=22)), Del(), lineno=67, col_offset=12)], lineno=67, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=68, col_offset=8), 'busy', Store(), lineno=68, col_offset=8)], BinOp(Attribute(Name('self', Load(), lineno=68, col_offset=20), 'busy', Load(), lineno=68, col_offset=20), Add(), Num(1, lineno=68, col_offset=32), lineno=68, col_offset=20), lineno=68, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=69, col_offset=8), 'mutex', Load(), lineno=69, col_offset=8), 'release', Load(), lineno=69, col_offset=8), [], [], None, None, lineno=69, col_offset=8), lineno=69, col_offset=8), If(Compare(Call(Name('len', Load(), lineno=70, col_offset=11), [Attribute(Name('self', Load(), lineno=70, col_offset=15), 'work', Load(), lineno=70, col_offset=15)], [], None, None, lineno=70, col_offset=11), [Gt()], [Num(0, lineno=70, col_offset=28)], lineno=70, col_offset=11), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=71, col_offset=12), 'todo', Load(), lineno=71, col_offset=12), 'release', Load(), lineno=71, col_offset=12), [], [], None, None, lineno=71, col_offset=12), lineno=71, col_offset=12)], [], lineno=70, col_offset=8), Return(Name('job', Load(), lineno=72, col_offset=15), lineno=72, col_offset=8)], [], lineno=59, col_offset=4), FunctionDef('_donework', arguments([Name('self', Param(), lineno=74, col_offset=18)], None, None, []), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=75, col_offset=8), 'mutex', Load(), lineno=75, col_offset=8), 'acquire', Load(), lineno=75, col_offset=8), [], [], None, None, lineno=75, col_offset=8), lineno=75, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=76, col_offset=8), 'busy', Store(), lineno=76, col_offset=8)], BinOp(Attribute(Name('self', Load(), lineno=76, col_offset=20), 'busy', Load(), lineno=76, col_offset=20), Sub(), Num(1, lineno=76, col_offset=32), lineno=76, col_offset=20), lineno=76, col_offset=8), If(BoolOp(And(), [Compare(Attribute(Name('self', Load(), lineno=77, col_offset=11), 'busy', Load(), lineno=77, col_offset=11), [Eq()], [Num(0, lineno=77, col_offset=24)], lineno=77, col_offset=11), Compare(Call(Name('len', Load(), lineno=77, col_offset=30), [Attribute(Name('self', Load(), lineno=77, col_offset=34), 'work', Load(), lineno=77, col_offset=34)], [], None, None, lineno=77, col_offset=30), [Eq()], [Num(0, lineno=77, col_offset=48)], lineno=77, col_offset=30)], lineno=77, col_offset=11), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=78, col_offset=12), 'todo', Load(), lineno=78, col_offset=12), 'release', Load(), lineno=78, col_offset=12), [], [], None, None, lineno=78, col_offset=12), lineno=78, col_offset=12)], [], lineno=77, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=79, col_offset=8), 'mutex', Load(), lineno=79, col_offset=8), 'release', Load(), lineno=79, col_offset=8), [], [], None, None, lineno=79, col_offset=8), lineno=79, col_offset=8)], [], lineno=74, col_offset=4), FunctionDef('_worker', arguments([Name('self', Param(), lineno=81, col_offset=16)], None, None, []), [Expr(Call(Attribute(Name('time', Load(), lineno=82, col_offset=8), 'sleep', Load(), lineno=82, col_offset=8), [Num(1e-05, lineno=82, col_offset=19)], [], None, None, lineno=82, col_offset=8), lineno=82, col_offset=8), While(Num(1, lineno=83, col_offset=14), [Assign([Name('job', Store(), lineno=84, col_offset=12)], Call(Attribute(Name('self', Load(), lineno=84, col_offset=18), '_getwork', Load(), lineno=84, col_offset=18), [], [], None, None, lineno=84, col_offset=18), lineno=84, col_offset=12), If(UnaryOp(Not(), Name('job', Load(), lineno=85, col_offset=19), lineno=85, col_offset=15), [Break( lineno=86, col_offset=16)], [], lineno=85, col_offset=12), Assign([Tuple([Name('func', Store(), lineno=87, col_offset=12), Name('args', Store(), lineno=87, col_offset=18)], Store(), lineno=87, col_offset=12)], Name('job', Load(), lineno=87, col_offset=25), lineno=87, col_offset=12), Expr(Call(Name('apply', Load(), lineno=88, col_offset=12), [Name('func', Load(), lineno=88, col_offset=18), Name('args', Load(), lineno=88, col_offset=24)], [], None, None, lineno=88, col_offset=12), lineno=88, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=89, col_offset=12), '_donework', Load(), lineno=89, col_offset=12), [], [], None, None, lineno=89, col_offset=12), lineno=89, col_offset=12)], [], lineno=83, col_offset=8)], [], lineno=81, col_offset=4), FunctionDef('run', arguments([Name('self', Param(), lineno=91, col_offset=12), Name('nworkers', Param(), lineno=91, col_offset=18)], None, None, []), [If(UnaryOp(Not(), Attribute(Name('self', Load(), lineno=92, col_offset=15), 'work', Load(), lineno=92, col_offset=15), lineno=92, col_offset=11), [Return(None, lineno=93, col_offset=12)], [], lineno=92, col_offset=8), For(Name('i', Store(), lineno=94, col_offset=12), Call(Name('range', Load(), lineno=94, col_offset=17), [BinOp(Name('nworkers', Load(), lineno=94, col_offset=23), Sub(), Num(1, lineno=94, col_offset=32), lineno=94, col_offset=23)], [], None, None, lineno=94, col_offset=17), [Expr(Call(Attribute(Name('thread', Load(), lineno=95, col_offset=12), 'start_new', Load(), lineno=95, col_offset=12), [Attribute(Name('self', Load(), lineno=95, col_offset=29), '_worker', Load(), lineno=95, col_offset=29), Tuple([], Load(), lineno=95, col_offset=43)], [], None, None, lineno=95, col_offset=12), lineno=95, col_offset=12)], [], lineno=94, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=96, col_offset=8), '_worker', Load(), lineno=96, col_offset=8), [], [], None, None, lineno=96, col_offset=8), lineno=96, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=97, col_offset=8), 'todo', Load(), lineno=97, col_offset=8), 'acquire', Load(), lineno=97, col_offset=8), [], [], None, None, lineno=97, col_offset=8), lineno=97, col_offset=8)], [], lineno=91, col_offset=4)], [], lineno=35, col_offset=0), FunctionDef('main', arguments([], None, None, []), [Assign([Name('nworkers', Store(), lineno=103, col_offset=4)], Num(4, lineno=103, col_offset=15), lineno=103, col_offset=4), Assign([Tuple([Name('opts', Store(), lineno=104, col_offset=4), Name('args', Store(), lineno=104, col_offset=10)], Store(), lineno=104, col_offset=4)], Call(Attribute(Name('getopt', Load(), lineno=104, col_offset=17), 'getopt', Load(), lineno=104, col_offset=17), [Subscript(Attribute(Name('sys', Load(), lineno=104, col_offset=31), 'argv', Load(), lineno=104, col_offset=31), Slice(Num(1, lineno=104, col_offset=40), None, None), Load(), lineno=104, col_offset=31), Str('-w:', lineno=104, col_offset=45)], [], None, None, lineno=104, col_offset=17), lineno=104, col_offset=4), For(Tuple([Name('opt', Store(), lineno=105, col_offset=8), Name('arg', Store(), lineno=105, col_offset=13)], Store(), lineno=105, col_offset=8), Name('opts', Load(), lineno=105, col_offset=20), [If(Compare(Name('opt', Load(), lineno=106, col_offset=11), [Eq()], [Str('-w', lineno=106, col_offset=18)], lineno=106, col_offset=11), [Assign([Name('nworkers', Store(), lineno=107, col_offset=12)], Call(Attribute(Name('string', Load(), lineno=107, col_offset=23), 'atoi', Load(), lineno=107, col_offset=23), [Name('arg', Load(), lineno=107, col_offset=35)], [], None, None, lineno=107, col_offset=23), lineno=107, col_offset=12)], [], lineno=106, col_offset=8)], [], lineno=105, col_offset=4), If(UnaryOp(Not(), Name('args', Load(), lineno=108, col_offset=11), lineno=108, col_offset=7), [Assign([Name('args', Store(), lineno=109, col_offset=8)], List([Attribute(Name('os', Load(), lineno=109, col_offset=16), 'curdir', Load(), lineno=109, col_offset=16)], Load(), lineno=109, col_offset=15), lineno=109, col_offset=8)], [], lineno=108, col_offset=4), Assign([Name('wq', Store(), lineno=111, col_offset=4)], Call(Name('WorkQ', Load(), lineno=111, col_offset=9), [], [], None, None, lineno=111, col_offset=9), lineno=111, col_offset=4), For(Name('dir', Store(), lineno=112, col_offset=8), Name('args', Load(), lineno=112, col_offset=15), [Expr(Call(Attribute(Name('wq', Load(), lineno=113, col_offset=8), 'addwork', Load(), lineno=113, col_offset=8), [Name('find', Load(), lineno=113, col_offset=19), Tuple([Name('dir', Load(), lineno=113, col_offset=26), Name('selector', Load(), lineno=113, col_offset=31), Name('wq', Load(), lineno=113, col_offset=41)], Load(), lineno=113, col_offset=26)], [], None, None, lineno=113, col_offset=8), lineno=113, col_offset=8)], [], lineno=112, col_offset=4), Assign([Name('t1', Store(), lineno=115, col_offset=4)], Call(Attribute(Name('time', Load(), lineno=115, col_offset=9), 'time', Load(), lineno=115, col_offset=9), [], [], None, None, lineno=115, col_offset=9), lineno=115, col_offset=4), Expr(Call(Attribute(Name('wq', Load(), lineno=116, col_offset=4), 'run', Load(), lineno=116, col_offset=4), [Name('nworkers', Load(), lineno=116, col_offset=11)], [], None, None, lineno=116, col_offset=4), lineno=116, col_offset=4), Assign([Name('t2', Store(), lineno=117, col_offset=4)], Call(Attribute(Name('time', Load(), lineno=117, col_offset=9), 'time', Load(), lineno=117, col_offset=9), [], [], None, None, lineno=117, col_offset=9), lineno=117, col_offset=4), Expr(Call(Attribute(Attribute(Name('sys', Load(), lineno=119, col_offset=4), 'stderr', Load(), lineno=119, col_offset=4), 'write', Load(), lineno=119, col_offset=4), [BinOp(Str('Total time %r sec.\n', lineno=119, col_offset=21), Mod(), BinOp(Name('t2', Load(), lineno=119, col_offset=47), Sub(), Name('t1', Load(), lineno=119, col_offset=50), lineno=119, col_offset=47), lineno=119, col_offset=21)], [], None, None, lineno=119, col_offset=4), lineno=119, col_offset=4)], [], lineno=102, col_offset=0), FunctionDef('selector', arguments([Name('dir', Param(), lineno=125, col_offset=13), Name('name', Param(), lineno=125, col_offset=18), Name('fullname', Param(), lineno=125, col_offset=24), Name('stat', Param(), lineno=125, col_offset=34)], None, None, []), [Return(BoolOp(And(), [Compare(BinOp(Subscript(Name('stat', Load(), lineno=127, col_offset=12), Index(Name('ST_MODE', Load(), lineno=127, col_offset=17)), Load(), lineno=127, col_offset=12), BitAnd(), Num(2, lineno=127, col_offset=28), lineno=127, col_offset=12), [NotEq()], [Num(0, lineno=127, col_offset=37)], lineno=127, col_offset=11), UnaryOp(Not(), Call(Name('S_ISLNK', Load(), lineno=127, col_offset=47), [Subscript(Name('stat', Load(), lineno=127, col_offset=55), Index(Name('ST_MODE', Load(), lineno=127, col_offset=60)), Load(), lineno=127, col_offset=55)], [], None, None, lineno=127, col_offset=47), lineno=127, col_offset=43)], lineno=127, col_offset=11), lineno=127, col_offset=4)], [], lineno=125, col_offset=0), FunctionDef('find', arguments([Name('dir', Param(), lineno=132, col_offset=9), Name('pred', Param(), lineno=132, col_offset=14), Name('wq', Param(), lineno=132, col_offset=20)], None, None, []), [TryExcept([Assign([Name('names', Store(), lineno=134, col_offset=8)], Call(Attribute(Name('os', Load(), lineno=134, col_offset=16), 'listdir', Load(), lineno=134, col_offset=16), [Name('dir', Load(), lineno=134, col_offset=27)], [], None, None, lineno=134, col_offset=16), lineno=134, col_offset=8)], [ExceptHandler(Attribute(Name('os', Load(), lineno=135, col_offset=11), 'error', Load(), lineno=135, col_offset=11), Name('msg', Store(), lineno=135, col_offset=21), [Print(None, [Call(Name('repr', Load(), lineno=136, col_offset=14), [Name('dir', Load(), lineno=136, col_offset=19)], [], None, None, lineno=136, col_offset=14), Str(':', lineno=136, col_offset=25), Name('msg', Load(), lineno=136, col_offset=30)], True, lineno=136, col_offset=8), Return(None, lineno=137, col_offset=8)], lineno=135, col_offset=4)], [], lineno=133, col_offset=4), For(Name('name', Store(), lineno=138, col_offset=8), Name('names', Load(), lineno=138, col_offset=16), [If(Compare(Name('name', Load(), lineno=139, col_offset=11), [NotIn()], [Tuple([Attribute(Name('os', Load(), lineno=139, col_offset=24), 'curdir', Load(), lineno=139, col_offset=24), Attribute(Name('os', Load(), lineno=139, col_offset=35), 'pardir', Load(), lineno=139, col_offset=35)], Load(), lineno=139, col_offset=24)], lineno=139, col_offset=11), [Assign([Name('fullname', Store(), lineno=140, col_offset=12)], Call(Attribute(Attribute(Name('os', Load(), lineno=140, col_offset=23), 'path', Load(), lineno=140, col_offset=23), 'join', Load(), lineno=140, col_offset=23), [Name('dir', Load(), lineno=140, col_offset=36), Name('name', Load(), lineno=140, col_offset=41)], [], None, None, lineno=140, col_offset=23), lineno=140, col_offset=12), TryExcept([Assign([Name('stat', Store(), lineno=142, col_offset=16)], Call(Attribute(Name('os', Load(), lineno=142, col_offset=23), 'lstat', Load(), lineno=142, col_offset=23), [Name('fullname', Load(), lineno=142, col_offset=32)], [], None, None, lineno=142, col_offset=23), lineno=142, col_offset=16)], [ExceptHandler(Attribute(Name('os', Load(), lineno=143, col_offset=19), 'error', Load(), lineno=143, col_offset=19), Name('msg', Store(), lineno=143, col_offset=29), [Print(None, [Call(Name('repr', Load(), lineno=144, col_offset=22), [Name('fullname', Load(), lineno=144, col_offset=27)], [], None, None, lineno=144, col_offset=22), Str(':', lineno=144, col_offset=38), Name('msg', Load(), lineno=144, col_offset=43)], True, lineno=144, col_offset=16), Continue( lineno=145, col_offset=16)], lineno=143, col_offset=12)], [], lineno=141, col_offset=12), If(Call(Name('pred', Load(), lineno=146, col_offset=15), [Name('dir', Load(), lineno=146, col_offset=20), Name('name', Load(), lineno=146, col_offset=25), Name('fullname', Load(), lineno=146, col_offset=31), Name('stat', Load(), lineno=146, col_offset=41)], [], None, None, lineno=146, col_offset=15), [Print(None, [Name('fullname', Load(), lineno=147, col_offset=22)], True, lineno=147, col_offset=16)], [], lineno=146, col_offset=12), If(Call(Name('S_ISDIR', Load(), lineno=148, col_offset=15), [Subscript(Name('stat', Load(), lineno=148, col_offset=23), Index(Name('ST_MODE', Load(), lineno=148, col_offset=28)), Load(), lineno=148, col_offset=23)], [], None, None, lineno=148, col_offset=15), [If(UnaryOp(Not(), Call(Attribute(Attribute(Name('os', Load(), lineno=149, col_offset=23), 'path', Load(), lineno=149, col_offset=23), 'ismount', Load(), lineno=149, col_offset=23), [Name('fullname', Load(), lineno=149, col_offset=39)], [], None, None, lineno=149, col_offset=23), lineno=149, col_offset=19), [Expr(Call(Attribute(Name('wq', Load(), lineno=150, col_offset=20), 'addwork', Load(), lineno=150, col_offset=20), [Name('find', Load(), lineno=150, col_offset=31), Tuple([Name('fullname', Load(), lineno=150, col_offset=38), Name('pred', Load(), lineno=150, col_offset=48), Name('wq', Load(), lineno=150, col_offset=54)], Load(), lineno=150, col_offset=38)], [], None, None, lineno=150, col_offset=20), lineno=150, col_offset=20)], [], lineno=149, col_offset=16)], [], lineno=148, col_offset=12)], [], lineno=139, col_offset=8)], [], lineno=138, col_offset=4)], [], lineno=132, col_offset=0), Expr(Call(Name('main', Load(), lineno=155, col_offset=0), [], [], None, None, lineno=155, col_offset=0), lineno=155, col_offset=0)])
