Module([Expr(Str("distutils.command.build_scripts\n\nImplements the Distutils 'build_scripts' command.", lineno=3, col_offset=-1), lineno=3, col_offset=-1), Assign([Name('__revision__', Store(), lineno=5, col_offset=0)], Str('$Id: build_scripts.py 77704 2010-01-23 09:23:15Z tarek.ziade $', lineno=5, col_offset=15), lineno=5, col_offset=0), Import([alias('os', None), alias('re', None)], lineno=7, col_offset=0), ImportFrom('stat', [alias('ST_MODE', None)], 0, lineno=8, col_offset=0), ImportFrom('distutils.core', [alias('Command', None)], 0, lineno=9, col_offset=0), ImportFrom('distutils.dep_util', [alias('newer', None)], 0, lineno=10, col_offset=0), ImportFrom('distutils.util', [alias('convert_path', None)], 0, lineno=11, col_offset=0), ImportFrom('distutils', [alias('log', None)], 0, lineno=12, col_offset=0), Assign([Name('first_line_re', Store(), lineno=15, col_offset=0)], Call(Attribute(Name('re', Load(), lineno=15, col_offset=16), 'compile', Load(), lineno=15, col_offset=16), [Str('^#!.*python[0-9.]*([ \t].*)?$', lineno=15, col_offset=27)], [], None, None, lineno=15, col_offset=16), lineno=15, col_offset=0), ClassDef('build_scripts', [Name('Command', Load(), lineno=17, col_offset=21)], [Assign([Name('description', Store(), lineno=19, col_offset=4)], Str('"build" scripts (copy and fixup #! line)', lineno=19, col_offset=18), lineno=19, col_offset=4), Assign([Name('user_options', Store(), lineno=21, col_offset=4)], List([Tuple([Str('build-dir=', lineno=22, col_offset=9), Str('d', lineno=22, col_offset=23), Str('directory to "build" (copy) to', lineno=22, col_offset=28)], Load(), lineno=22, col_offset=9), Tuple([Str('force', lineno=23, col_offset=9), Str('f', lineno=23, col_offset=18), Str('forcibly build everything (ignore file timestamps', lineno=23, col_offset=23)], Load(), lineno=23, col_offset=9), Tuple([Str('executable=', lineno=24, col_offset=9), Str('e', lineno=24, col_offset=24), Str('specify final destination interpreter path', lineno=24, col_offset=29)], Load(), lineno=24, col_offset=9)], Load(), lineno=21, col_offset=19), lineno=21, col_offset=4), Assign([Name('boolean_options', Store(), lineno=27, col_offset=4)], List([Str('force', lineno=27, col_offset=23)], Load(), lineno=27, col_offset=22), lineno=27, col_offset=4), FunctionDef('initialize_options', arguments([Name('self', Param(), lineno=30, col_offset=28)], None, None, []), [Assign([Attribute(Name('self', Load(), lineno=31, col_offset=8), 'build_dir', Store(), lineno=31, col_offset=8)], Name('None', Load(), lineno=31, col_offset=25), lineno=31, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=32, col_offset=8), 'scripts', Store(), lineno=32, col_offset=8)], Name('None', Load(), lineno=32, col_offset=23), lineno=32, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=33, col_offset=8), 'force', Store(), lineno=33, col_offset=8)], Name('None', Load(), lineno=33, col_offset=21), lineno=33, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=34, col_offset=8), 'executable', Store(), lineno=34, col_offset=8)], Name('None', Load(), lineno=34, col_offset=26), lineno=34, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=35, col_offset=8), 'outfiles', Store(), lineno=35, col_offset=8)], Name('None', Load(), lineno=35, col_offset=24), lineno=35, col_offset=8)], [], lineno=30, col_offset=4), FunctionDef('finalize_options', arguments([Name('self', Param(), lineno=37, col_offset=26)], None, None, []), [Expr(Call(Attribute(Name('self', Load(), lineno=38, col_offset=8), 'set_undefined_options', Load(), lineno=38, col_offset=8), [Str('build', lineno=38, col_offset=35), Tuple([Str('build_scripts', lineno=39, col_offset=36), Str('build_dir', lineno=39, col_offset=53)], Load(), lineno=39, col_offset=36), Tuple([Str('force', lineno=40, col_offset=36), Str('force', lineno=40, col_offset=45)], Load(), lineno=40, col_offset=36), Tuple([Str('executable', lineno=41, col_offset=36), Str('executable', lineno=41, col_offset=50)], Load(), lineno=41, col_offset=36)], [], None, None, lineno=38, col_offset=8), lineno=38, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=42, col_offset=8), 'scripts', Store(), lineno=42, col_offset=8)], Attribute(Attribute(Name('self', Load(), lineno=42, col_offset=23), 'distribution', Load(), lineno=42, col_offset=23), 'scripts', Load(), lineno=42, col_offset=23), lineno=42, col_offset=8)], [], lineno=37, col_offset=4), FunctionDef('get_source_files', arguments([Name('self', Param(), lineno=44, col_offset=25)], None, None, []), [Return(Attribute(Name('self', Load(), lineno=45, col_offset=15), 'scripts', Load(), lineno=45, col_offset=15), lineno=45, col_offset=8)], [], lineno=44, col_offset=4), FunctionDef('run', arguments([Name('self', Param(), lineno=47, col_offset=13)], None, None, []), [If(UnaryOp(Not(), Attribute(Name('self', Load(), lineno=48, col_offset=15), 'scripts', Load(), lineno=48, col_offset=15), lineno=48, col_offset=11), [Return(None, lineno=49, col_offset=12)], [], lineno=48, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=50, col_offset=8), 'copy_scripts', Load(), lineno=50, col_offset=8), [], [], None, None, lineno=50, col_offset=8), lineno=50, col_offset=8)], [], lineno=47, col_offset=4), FunctionDef('copy_scripts', arguments([Name('self', Param(), lineno=53, col_offset=22)], None, None, []), [Expr(Str('Copy each script listed in \'self.scripts\'; if it\'s marked as a\n        Python script in the Unix way (first line matches \'first_line_re\',\n        ie. starts with "\\#!" and contains "python"), then adjust the first\n        line to refer to the current Python interpreter as we copy.\n        ', lineno=58, col_offset=-1), lineno=58, col_offset=-1), Assign([Name('_sysconfig', Store(), lineno=59, col_offset=8)], Call(Name('__import__', Load(), lineno=59, col_offset=21), [Str('sysconfig', lineno=59, col_offset=32)], [], None, None, lineno=59, col_offset=21), lineno=59, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=60, col_offset=8), 'mkpath', Load(), lineno=60, col_offset=8), [Attribute(Name('self', Load(), lineno=60, col_offset=20), 'build_dir', Load(), lineno=60, col_offset=20)], [], None, None, lineno=60, col_offset=8), lineno=60, col_offset=8), Assign([Name('outfiles', Store(), lineno=61, col_offset=8)], List([], Load(), lineno=61, col_offset=19), lineno=61, col_offset=8), For(Name('script', Store(), lineno=62, col_offset=12), Attribute(Name('self', Load(), lineno=62, col_offset=22), 'scripts', Load(), lineno=62, col_offset=22), [Assign([Name('adjust', Store(), lineno=63, col_offset=12)], Num(0, lineno=63, col_offset=21), lineno=63, col_offset=12), Assign([Name('script', Store(), lineno=64, col_offset=12)], Call(Name('convert_path', Load(), lineno=64, col_offset=21), [Name('script', Load(), lineno=64, col_offset=34)], [], None, None, lineno=64, col_offset=21), lineno=64, col_offset=12), Assign([Name('outfile', Store(), lineno=65, col_offset=12)], Call(Attribute(Attribute(Name('os', Load(), lineno=65, col_offset=22), 'path', Load(), lineno=65, col_offset=22), 'join', Load(), lineno=65, col_offset=22), [Attribute(Name('self', Load(), lineno=65, col_offset=35), 'build_dir', Load(), lineno=65, col_offset=35), Call(Attribute(Attribute(Name('os', Load(), lineno=65, col_offset=51), 'path', Load(), lineno=65, col_offset=51), 'basename', Load(), lineno=65, col_offset=51), [Name('script', Load(), lineno=65, col_offset=68)], [], None, None, lineno=65, col_offset=51)], [], None, None, lineno=65, col_offset=22), lineno=65, col_offset=12), Expr(Call(Attribute(Name('outfiles', Load(), lineno=66, col_offset=12), 'append', Load(), lineno=66, col_offset=12), [Name('outfile', Load(), lineno=66, col_offset=28)], [], None, None, lineno=66, col_offset=12), lineno=66, col_offset=12), If(BoolOp(And(), [UnaryOp(Not(), Attribute(Name('self', Load(), lineno=68, col_offset=19), 'force', Load(), lineno=68, col_offset=19), lineno=68, col_offset=15), UnaryOp(Not(), Call(Name('newer', Load(), lineno=68, col_offset=38), [Name('script', Load(), lineno=68, col_offset=44), Name('outfile', Load(), lineno=68, col_offset=52)], [], None, None, lineno=68, col_offset=38), lineno=68, col_offset=34)], lineno=68, col_offset=15), [Expr(Call(Attribute(Name('log', Load(), lineno=69, col_offset=16), 'debug', Load(), lineno=69, col_offset=16), [Str('not copying %s (up-to-date)', lineno=69, col_offset=26), Name('script', Load(), lineno=69, col_offset=57)], [], None, None, lineno=69, col_offset=16), lineno=69, col_offset=16), Continue( lineno=70, col_offset=16)], [], lineno=68, col_offset=12), TryExcept([Assign([Name('f', Store(), lineno=76, col_offset=16)], Call(Name('open', Load(), lineno=76, col_offset=20), [Name('script', Load(), lineno=76, col_offset=25), Str('r', lineno=76, col_offset=33)], [], None, None, lineno=76, col_offset=20), lineno=76, col_offset=16)], [ExceptHandler(Name('IOError', Load(), lineno=77, col_offset=19), None, [If(UnaryOp(Not(), Attribute(Name('self', Load(), lineno=78, col_offset=23), 'dry_run', Load(), lineno=78, col_offset=23), lineno=78, col_offset=19), [Raise(None, None, None, lineno=79, col_offset=20)], [], lineno=78, col_offset=16), Assign([Name('f', Store(), lineno=80, col_offset=16)], Name('None', Load(), lineno=80, col_offset=20), lineno=80, col_offset=16)], lineno=77, col_offset=12)], [Assign([Name('first_line', Store(), lineno=82, col_offset=16)], Call(Attribute(Name('f', Load(), lineno=82, col_offset=29), 'readline', Load(), lineno=82, col_offset=29), [], [], None, None, lineno=82, col_offset=29), lineno=82, col_offset=16), If(UnaryOp(Not(), Name('first_line', Load(), lineno=83, col_offset=23), lineno=83, col_offset=19), [Expr(Call(Attribute(Name('self', Load(), lineno=84, col_offset=20), 'warn', Load(), lineno=84, col_offset=20), [BinOp(Str('%s is an empty file (skipping)', lineno=84, col_offset=30), Mod(), Name('script', Load(), lineno=84, col_offset=65), lineno=84, col_offset=30)], [], None, None, lineno=84, col_offset=20), lineno=84, col_offset=20), Continue( lineno=85, col_offset=20)], [], lineno=83, col_offset=16), Assign([Name('match', Store(), lineno=87, col_offset=16)], Call(Attribute(Name('first_line_re', Load(), lineno=87, col_offset=24), 'match', Load(), lineno=87, col_offset=24), [Name('first_line', Load(), lineno=87, col_offset=44)], [], None, None, lineno=87, col_offset=24), lineno=87, col_offset=16), If(Name('match', Load(), lineno=88, col_offset=19), [Assign([Name('adjust', Store(), lineno=89, col_offset=20)], Num(1, lineno=89, col_offset=29), lineno=89, col_offset=20), Assign([Name('post_interp', Store(), lineno=90, col_offset=20)], BoolOp(Or(), [Call(Attribute(Name('match', Load(), lineno=90, col_offset=34), 'group', Load(), lineno=90, col_offset=34), [Num(1, lineno=90, col_offset=46)], [], None, None, lineno=90, col_offset=34), Str('', lineno=90, col_offset=52)], lineno=90, col_offset=34), lineno=90, col_offset=20)], [], lineno=88, col_offset=16)], lineno=75, col_offset=12), If(Name('adjust', Load(), lineno=92, col_offset=15), [Expr(Call(Attribute(Name('log', Load(), lineno=93, col_offset=16), 'info', Load(), lineno=93, col_offset=16), [Str('copying and adjusting %s -> %s', lineno=93, col_offset=25), Name('script', Load(), lineno=93, col_offset=59), Attribute(Name('self', Load(), lineno=94, col_offset=25), 'build_dir', Load(), lineno=94, col_offset=25)], [], None, None, lineno=93, col_offset=16), lineno=93, col_offset=16), If(UnaryOp(Not(), Attribute(Name('self', Load(), lineno=95, col_offset=23), 'dry_run', Load(), lineno=95, col_offset=23), lineno=95, col_offset=19), [Assign([Name('outf', Store(), lineno=96, col_offset=20)], Call(Name('open', Load(), lineno=96, col_offset=27), [Name('outfile', Load(), lineno=96, col_offset=32), Str('w', lineno=96, col_offset=41)], [], None, None, lineno=96, col_offset=27), lineno=96, col_offset=20), If(UnaryOp(Not(), Call(Attribute(Name('_sysconfig', Load(), lineno=97, col_offset=27), 'is_python_build', Load(), lineno=97, col_offset=27), [], [], None, None, lineno=97, col_offset=27), lineno=97, col_offset=23), [Expr(Call(Attribute(Name('outf', Load(), lineno=98, col_offset=24), 'write', Load(), lineno=98, col_offset=24), [BinOp(Str('#!%s%s\n', lineno=98, col_offset=35), Mod(), Tuple([Attribute(Name('self', Load(), lineno=99, col_offset=36), 'executable', Load(), lineno=99, col_offset=36), Name('post_interp', Load(), lineno=100, col_offset=36)], Load(), lineno=99, col_offset=36), lineno=98, col_offset=35)], [], None, None, lineno=98, col_offset=24), lineno=98, col_offset=24)], [Expr(Call(Attribute(Name('outf', Load(), lineno=102, col_offset=24), 'write', Load(), lineno=102, col_offset=24), [BinOp(Str('#!%s%s\n', lineno=102, col_offset=35), Mod(), Tuple([Call(Attribute(Attribute(Name('os', Load(), lineno=103, col_offset=36), 'path', Load(), lineno=103, col_offset=36), 'join', Load(), lineno=103, col_offset=36), [Call(Attribute(Name('_sysconfig', Load(), lineno=104, col_offset=28), 'get_config_var', Load(), lineno=104, col_offset=28), [Str('BINDIR', lineno=104, col_offset=54)], [], None, None, lineno=104, col_offset=28), BinOp(Str('python%s%s', lineno=105, col_offset=27), Mod(), Tuple([Call(Attribute(Name('_sysconfig', Load(), lineno=105, col_offset=43), 'get_config_var', Load(), lineno=105, col_offset=43), [Str('VERSION', lineno=105, col_offset=69)], [], None, None, lineno=105, col_offset=43), Call(Attribute(Name('_sysconfig', Load(), lineno=106, col_offset=43), 'get_config_var', Load(), lineno=106, col_offset=43), [Str('EXE', lineno=106, col_offset=69)], [], None, None, lineno=106, col_offset=43)], Load(), lineno=105, col_offset=43), lineno=105, col_offset=27)], [], None, None, lineno=103, col_offset=36), Name('post_interp', Load(), lineno=107, col_offset=36)], Load(), lineno=103, col_offset=36), lineno=102, col_offset=35)], [], None, None, lineno=102, col_offset=24), lineno=102, col_offset=24)], lineno=97, col_offset=20), Expr(Call(Attribute(Name('outf', Load(), lineno=108, col_offset=20), 'writelines', Load(), lineno=108, col_offset=20), [Call(Attribute(Name('f', Load(), lineno=108, col_offset=36), 'readlines', Load(), lineno=108, col_offset=36), [], [], None, None, lineno=108, col_offset=36)], [], None, None, lineno=108, col_offset=20), lineno=108, col_offset=20), Expr(Call(Attribute(Name('outf', Load(), lineno=109, col_offset=20), 'close', Load(), lineno=109, col_offset=20), [], [], None, None, lineno=109, col_offset=20), lineno=109, col_offset=20)], [], lineno=95, col_offset=16), If(Name('f', Load(), lineno=110, col_offset=19), [Expr(Call(Attribute(Name('f', Load(), lineno=111, col_offset=20), 'close', Load(), lineno=111, col_offset=20), [], [], None, None, lineno=111, col_offset=20), lineno=111, col_offset=20)], [], lineno=110, col_offset=16)], [If(Name('f', Load(), lineno=113, col_offset=19), [Expr(Call(Attribute(Name('f', Load(), lineno=114, col_offset=20), 'close', Load(), lineno=114, col_offset=20), [], [], None, None, lineno=114, col_offset=20), lineno=114, col_offset=20)], [], lineno=113, col_offset=16), Expr(Call(Attribute(Name('self', Load(), lineno=115, col_offset=16), 'copy_file', Load(), lineno=115, col_offset=16), [Name('script', Load(), lineno=115, col_offset=31), Name('outfile', Load(), lineno=115, col_offset=39)], [], None, None, lineno=115, col_offset=16), lineno=115, col_offset=16)], lineno=92, col_offset=12)], [], lineno=62, col_offset=8), If(Compare(Attribute(Name('os', Load(), lineno=117, col_offset=11), 'name', Load(), lineno=117, col_offset=11), [Eq()], [Str('posix', lineno=117, col_offset=22)], lineno=117, col_offset=11), [For(Name('file', Store(), lineno=118, col_offset=16), Name('outfiles', Load(), lineno=118, col_offset=24), [If(Attribute(Name('self', Load(), lineno=119, col_offset=19), 'dry_run', Load(), lineno=119, col_offset=19), [Expr(Call(Attribute(Name('log', Load(), lineno=120, col_offset=20), 'info', Load(), lineno=120, col_offset=20), [Str('changing mode of %s', lineno=120, col_offset=29), Name('file', Load(), lineno=120, col_offset=52)], [], None, None, lineno=120, col_offset=20), lineno=120, col_offset=20)], [Assign([Name('oldmode', Store(), lineno=122, col_offset=20)], BinOp(Subscript(Call(Attribute(Name('os', Load(), lineno=122, col_offset=30), 'stat', Load(), lineno=122, col_offset=30), [Name('file', Load(), lineno=122, col_offset=38)], [], None, None, lineno=122, col_offset=30), Index(Name('ST_MODE', Load(), lineno=122, col_offset=44)), Load(), lineno=122, col_offset=30), BitAnd(), Num(4095, lineno=122, col_offset=55), lineno=122, col_offset=30), lineno=122, col_offset=20), Assign([Name('newmode', Store(), lineno=123, col_offset=20)], BinOp(BinOp(Name('oldmode', Load(), lineno=123, col_offset=31), BitOr(), Num(365, lineno=123, col_offset=41), lineno=123, col_offset=31), BitAnd(), Num(4095, lineno=123, col_offset=49), lineno=123, col_offset=30), lineno=123, col_offset=20), If(Compare(Name('newmode', Load(), lineno=124, col_offset=23), [NotEq()], [Name('oldmode', Load(), lineno=124, col_offset=34)], lineno=124, col_offset=23), [Expr(Call(Attribute(Name('log', Load(), lineno=125, col_offset=24), 'info', Load(), lineno=125, col_offset=24), [Str('changing mode of %s from %o to %o', lineno=125, col_offset=33), Name('file', Load(), lineno=126, col_offset=33), Name('oldmode', Load(), lineno=126, col_offset=39), Name('newmode', Load(), lineno=126, col_offset=48)], [], None, None, lineno=125, col_offset=24), lineno=125, col_offset=24), Expr(Call(Attribute(Name('os', Load(), lineno=127, col_offset=24), 'chmod', Load(), lineno=127, col_offset=24), [Name('file', Load(), lineno=127, col_offset=33), Name('newmode', Load(), lineno=127, col_offset=39)], [], None, None, lineno=127, col_offset=24), lineno=127, col_offset=24)], [], lineno=124, col_offset=20)], lineno=119, col_offset=16)], [], lineno=118, col_offset=12)], [], lineno=117, col_offset=8)], [], lineno=53, col_offset=4)], [], lineno=17, col_offset=0)])
