Module([Expr(Str('Adjust some old Python 2 idioms to their modern counterparts.\n\n* Change some type comparisons to isinstance() calls:\n    type(x) == T -> isinstance(x, T)\n    type(x) is T -> isinstance(x, T)\n    type(x) != T -> not isinstance(x, T)\n    type(x) is not T -> not isinstance(x, T)\n\n* Change "while 1:" into "while True:".\n\n* Change both\n\n    v = list(EXPR)\n    v.sort()\n    foo(v)\n\nand the more general\n\n    v = EXPR\n    v.sort()\n    foo(v)\n\ninto\n\n    v = sorted(EXPR)\n    foo(v)\n', lineno=27, col_offset=-1), lineno=27, col_offset=-1), ImportFrom(None, [alias('fixer_base', None)], 2, lineno=31, col_offset=0), ImportFrom('fixer_util', [alias('Call', None), alias('Comma', None), alias('Name', None), alias('Node', None), alias('BlankLine', None), alias('syms', None)], 2, lineno=32, col_offset=0), Assign([Name('CMP', Store(), lineno=34, col_offset=0)], Str("(n='!=' | '==' | 'is' | n=comp_op< 'is' 'not' >)", lineno=34, col_offset=6), lineno=34, col_offset=0), Assign([Name('TYPE', Store(), lineno=35, col_offset=0)], Str("power< 'type' trailer< '(' x=any ')' > >", lineno=35, col_offset=7), lineno=35, col_offset=0), ClassDef('FixIdioms', [Attribute(Name('fixer_base', Load(), lineno=37, col_offset=16), 'BaseFix', Load(), lineno=37, col_offset=16)], [Assign([Name('explicit', Store(), lineno=38, col_offset=4)], Name('True', Load(), lineno=38, col_offset=15), lineno=38, col_offset=4), Assign([Name('PATTERN', Store(), lineno=40, col_offset=4)], BinOp(Str("\n        isinstance=comparison< %s %s T=any >\n        |\n        isinstance=comparison< T=any %s %s >\n        |\n        while_stmt< 'while' while='1' ':' any+ >\n        |\n        sorted=any<\n            any*\n            simple_stmt<\n              expr_stmt< id1=any '='\n                         power< list='list' trailer< '(' (not arglist<any+>) any ')' > >\n              >\n              '\\n'\n            >\n            sort=\n            simple_stmt<\n              power< id2=any\n                     trailer< '.' 'sort' > trailer< '(' ')' >\n              >\n              '\\n'\n            >\n            next=any*\n        >\n        |\n        sorted=any<\n            any*\n            simple_stmt< expr_stmt< id1=any '=' expr=any > '\\n' >\n            sort=\n            simple_stmt<\n              power< id2=any\n                     trailer< '.' 'sort' > trailer< '(' ')' >\n              >\n              '\\n'\n            >\n            next=any*\n        >\n    ", lineno=77, col_offset=-1), Mod(), Tuple([Name('TYPE', Load(), lineno=77, col_offset=11), Name('CMP', Load(), lineno=77, col_offset=17), Name('CMP', Load(), lineno=77, col_offset=22), Name('TYPE', Load(), lineno=77, col_offset=27)], Load(), lineno=77, col_offset=11), lineno=77, col_offset=-1), lineno=40, col_offset=4), FunctionDef('match', arguments([Name('self', Param(), lineno=79, col_offset=14), Name('node', Param(), lineno=79, col_offset=20)], None, None, []), [Assign([Name('r', Store(), lineno=80, col_offset=8)], Call(Attribute(Call(Name('super', Load(), lineno=80, col_offset=12), [Name('FixIdioms', Load(), lineno=80, col_offset=18), Name('self', Load(), lineno=80, col_offset=29)], [], None, None, lineno=80, col_offset=12), 'match', Load(), lineno=80, col_offset=12), [Name('node', Load(), lineno=80, col_offset=41)], [], None, None, lineno=80, col_offset=12), lineno=80, col_offset=8), If(BoolOp(And(), [Name('r', Load(), lineno=84, col_offset=11), Compare(Str('sorted', lineno=84, col_offset=17), [In()], [Name('r', Load(), lineno=84, col_offset=29)], lineno=84, col_offset=17)], lineno=84, col_offset=11), [If(Compare(Subscript(Name('r', Load(), lineno=85, col_offset=15), Index(Str('id1', lineno=85, col_offset=17)), Load(), lineno=85, col_offset=15), [Eq()], [Subscript(Name('r', Load(), lineno=85, col_offset=27), Index(Str('id2', lineno=85, col_offset=29)), Load(), lineno=85, col_offset=27)], lineno=85, col_offset=15), [Return(Name('r', Load(), lineno=86, col_offset=23), lineno=86, col_offset=16)], [], lineno=85, col_offset=12), Return(Name('None', Load(), lineno=87, col_offset=19), lineno=87, col_offset=12)], [], lineno=84, col_offset=8), Return(Name('r', Load(), lineno=88, col_offset=15), lineno=88, col_offset=8)], [], lineno=79, col_offset=4), FunctionDef('transform', arguments([Name('self', Param(), lineno=90, col_offset=18), Name('node', Param(), lineno=90, col_offset=24), Name('results', Param(), lineno=90, col_offset=30)], None, None, []), [If(Compare(Str('isinstance', lineno=91, col_offset=11), [In()], [Name('results', Load(), lineno=91, col_offset=27)], lineno=91, col_offset=11), [Return(Call(Attribute(Name('self', Load(), lineno=92, col_offset=19), 'transform_isinstance', Load(), lineno=92, col_offset=19), [Name('node', Load(), lineno=92, col_offset=45), Name('results', Load(), lineno=92, col_offset=51)], [], None, None, lineno=92, col_offset=19), lineno=92, col_offset=12)], [If(Compare(Str('while', lineno=93, col_offset=13), [In()], [Name('results', Load(), lineno=93, col_offset=24)], lineno=93, col_offset=13), [Return(Call(Attribute(Name('self', Load(), lineno=94, col_offset=19), 'transform_while', Load(), lineno=94, col_offset=19), [Name('node', Load(), lineno=94, col_offset=40), Name('results', Load(), lineno=94, col_offset=46)], [], None, None, lineno=94, col_offset=19), lineno=94, col_offset=12)], [If(Compare(Str('sorted', lineno=95, col_offset=13), [In()], [Name('results', Load(), lineno=95, col_offset=25)], lineno=95, col_offset=13), [Return(Call(Attribute(Name('self', Load(), lineno=96, col_offset=19), 'transform_sort', Load(), lineno=96, col_offset=19), [Name('node', Load(), lineno=96, col_offset=39), Name('results', Load(), lineno=96, col_offset=45)], [], None, None, lineno=96, col_offset=19), lineno=96, col_offset=12)], [Raise(Call(Name('RuntimeError', Load(), lineno=98, col_offset=18), [Str('Invalid match', lineno=98, col_offset=31)], [], None, None, lineno=98, col_offset=18), None, None, lineno=98, col_offset=12)], lineno=95, col_offset=13)], lineno=93, col_offset=13)], lineno=91, col_offset=8)], [], lineno=90, col_offset=4), FunctionDef('transform_isinstance', arguments([Name('self', Param(), lineno=100, col_offset=29), Name('node', Param(), lineno=100, col_offset=35), Name('results', Param(), lineno=100, col_offset=41)], None, None, []), [Assign([Name('x', Store(), lineno=101, col_offset=8)], Call(Attribute(Subscript(Name('results', Load(), lineno=101, col_offset=12), Index(Str('x', lineno=101, col_offset=20)), Load(), lineno=101, col_offset=12), 'clone', Load(), lineno=101, col_offset=12), [], [], None, None, lineno=101, col_offset=12), lineno=101, col_offset=8), Assign([Name('T', Store(), lineno=102, col_offset=8)], Call(Attribute(Subscript(Name('results', Load(), lineno=102, col_offset=12), Index(Str('T', lineno=102, col_offset=20)), Load(), lineno=102, col_offset=12), 'clone', Load(), lineno=102, col_offset=12), [], [], None, None, lineno=102, col_offset=12), lineno=102, col_offset=8), Assign([Attribute(Name('x', Load(), lineno=103, col_offset=8), 'prefix', Store(), lineno=103, col_offset=8)], Str(u'', lineno=103, col_offset=19), lineno=103, col_offset=8), Assign([Attribute(Name('T', Load(), lineno=104, col_offset=8), 'prefix', Store(), lineno=104, col_offset=8)], Str(u' ', lineno=104, col_offset=19), lineno=104, col_offset=8), Assign([Name('test', Store(), lineno=105, col_offset=8)], Call(Name('Call', Load(), lineno=105, col_offset=15), [Call(Name('Name', Load(), lineno=105, col_offset=20), [Str(u'isinstance', lineno=105, col_offset=25)], [], None, None, lineno=105, col_offset=20), List([Name('x', Load(), lineno=105, col_offset=42), Call(Name('Comma', Load(), lineno=105, col_offset=45), [], [], None, None, lineno=105, col_offset=45), Name('T', Load(), lineno=105, col_offset=54)], Load(), lineno=105, col_offset=41)], [], None, None, lineno=105, col_offset=15), lineno=105, col_offset=8), If(Compare(Str('n', lineno=106, col_offset=11), [In()], [Name('results', Load(), lineno=106, col_offset=18)], lineno=106, col_offset=11), [Assign([Attribute(Name('test', Load(), lineno=107, col_offset=12), 'prefix', Store(), lineno=107, col_offset=12)], Str(u' ', lineno=107, col_offset=26), lineno=107, col_offset=12), Assign([Name('test', Store(), lineno=108, col_offset=12)], Call(Name('Node', Load(), lineno=108, col_offset=19), [Attribute(Name('syms', Load(), lineno=108, col_offset=24), 'not_test', Load(), lineno=108, col_offset=24), List([Call(Name('Name', Load(), lineno=108, col_offset=40), [Str(u'not', lineno=108, col_offset=45)], [], None, None, lineno=108, col_offset=40), Name('test', Load(), lineno=108, col_offset=54)], Load(), lineno=108, col_offset=39)], [], None, None, lineno=108, col_offset=19), lineno=108, col_offset=12)], [], lineno=106, col_offset=8), Assign([Attribute(Name('test', Load(), lineno=109, col_offset=8), 'prefix', Store(), lineno=109, col_offset=8)], Attribute(Name('node', Load(), lineno=109, col_offset=22), 'prefix', Load(), lineno=109, col_offset=22), lineno=109, col_offset=8), Return(Name('test', Load(), lineno=110, col_offset=15), lineno=110, col_offset=8)], [], lineno=100, col_offset=4), FunctionDef('transform_while', arguments([Name('self', Param(), lineno=112, col_offset=24), Name('node', Param(), lineno=112, col_offset=30), Name('results', Param(), lineno=112, col_offset=36)], None, None, []), [Assign([Name('one', Store(), lineno=113, col_offset=8)], Subscript(Name('results', Load(), lineno=113, col_offset=14), Index(Str('while', lineno=113, col_offset=22)), Load(), lineno=113, col_offset=14), lineno=113, col_offset=8), Expr(Call(Attribute(Name('one', Load(), lineno=114, col_offset=8), 'replace', Load(), lineno=114, col_offset=8), [Call(Name('Name', Load(), lineno=114, col_offset=20), [Str(u'True', lineno=114, col_offset=25)], [keyword('prefix', Attribute(Name('one', Load(), lineno=114, col_offset=41), 'prefix', Load(), lineno=114, col_offset=41))], None, None, lineno=114, col_offset=20)], [], None, None, lineno=114, col_offset=8), lineno=114, col_offset=8)], [], lineno=112, col_offset=4), FunctionDef('transform_sort', arguments([Name('self', Param(), lineno=116, col_offset=23), Name('node', Param(), lineno=116, col_offset=29), Name('results', Param(), lineno=116, col_offset=35)], None, None, []), [Assign([Name('sort_stmt', Store(), lineno=117, col_offset=8)], Subscript(Name('results', Load(), lineno=117, col_offset=20), Index(Str('sort', lineno=117, col_offset=28)), Load(), lineno=117, col_offset=20), lineno=117, col_offset=8), Assign([Name('next_stmt', Store(), lineno=118, col_offset=8)], Subscript(Name('results', Load(), lineno=118, col_offset=20), Index(Str('next', lineno=118, col_offset=28)), Load(), lineno=118, col_offset=20), lineno=118, col_offset=8), Assign([Name('list_call', Store(), lineno=119, col_offset=8)], Call(Attribute(Name('results', Load(), lineno=119, col_offset=20), 'get', Load(), lineno=119, col_offset=20), [Str('list', lineno=119, col_offset=32)], [], None, None, lineno=119, col_offset=20), lineno=119, col_offset=8), Assign([Name('simple_expr', Store(), lineno=120, col_offset=8)], Call(Attribute(Name('results', Load(), lineno=120, col_offset=22), 'get', Load(), lineno=120, col_offset=22), [Str('expr', lineno=120, col_offset=34)], [], None, None, lineno=120, col_offset=22), lineno=120, col_offset=8), If(Name('list_call', Load(), lineno=122, col_offset=11), [Expr(Call(Attribute(Name('list_call', Load(), lineno=123, col_offset=12), 'replace', Load(), lineno=123, col_offset=12), [Call(Name('Name', Load(), lineno=123, col_offset=30), [Str(u'sorted', lineno=123, col_offset=35)], [keyword('prefix', Attribute(Name('list_call', Load(), lineno=123, col_offset=53), 'prefix', Load(), lineno=123, col_offset=53))], None, None, lineno=123, col_offset=30)], [], None, None, lineno=123, col_offset=12), lineno=123, col_offset=12)], [If(Name('simple_expr', Load(), lineno=124, col_offset=13), [Assign([Name('new', Store(), lineno=125, col_offset=12)], Call(Attribute(Name('simple_expr', Load(), lineno=125, col_offset=18), 'clone', Load(), lineno=125, col_offset=18), [], [], None, None, lineno=125, col_offset=18), lineno=125, col_offset=12), Assign([Attribute(Name('new', Load(), lineno=126, col_offset=12), 'prefix', Store(), lineno=126, col_offset=12)], Str(u'', lineno=126, col_offset=25), lineno=126, col_offset=12), Expr(Call(Attribute(Name('simple_expr', Load(), lineno=127, col_offset=12), 'replace', Load(), lineno=127, col_offset=12), [Call(Name('Call', Load(), lineno=127, col_offset=32), [Call(Name('Name', Load(), lineno=127, col_offset=37), [Str(u'sorted', lineno=127, col_offset=42)], [], None, None, lineno=127, col_offset=37), List([Name('new', Load(), lineno=127, col_offset=55)], Load(), lineno=127, col_offset=54)], [keyword('prefix', Attribute(Name('simple_expr', Load(), lineno=128, col_offset=44), 'prefix', Load(), lineno=128, col_offset=44))], None, None, lineno=127, col_offset=32)], [], None, None, lineno=127, col_offset=12), lineno=127, col_offset=12)], [Raise(Call(Name('RuntimeError', Load(), lineno=130, col_offset=18), [Str('should not have reached here', lineno=130, col_offset=31)], [], None, None, lineno=130, col_offset=18), None, None, lineno=130, col_offset=12)], lineno=124, col_offset=13)], lineno=122, col_offset=8), Expr(Call(Attribute(Name('sort_stmt', Load(), lineno=131, col_offset=8), 'remove', Load(), lineno=131, col_offset=8), [], [], None, None, lineno=131, col_offset=8), lineno=131, col_offset=8), Assign([Name('btwn', Store(), lineno=133, col_offset=8)], Attribute(Name('sort_stmt', Load(), lineno=133, col_offset=15), 'prefix', Load(), lineno=133, col_offset=15), lineno=133, col_offset=8), If(Compare(Str(u'\n', lineno=136, col_offset=11), [In()], [Name('btwn', Load(), lineno=136, col_offset=20)], lineno=136, col_offset=11), [If(Name('next_stmt', Load(), lineno=137, col_offset=15), [Assign([Name('prefix_lines', Store(), lineno=141, col_offset=16)], Tuple([Subscript(Call(Attribute(Name('btwn', Load(), lineno=141, col_offset=32), 'rpartition', Load(), lineno=141, col_offset=32), [Str(u'\n', lineno=141, col_offset=48)], [], None, None, lineno=141, col_offset=32), Index(Num(0, lineno=141, col_offset=55)), Load(), lineno=141, col_offset=32), Attribute(Subscript(Name('next_stmt', Load(), lineno=141, col_offset=59), Index(Num(0, lineno=141, col_offset=69)), Load(), lineno=141, col_offset=59), 'prefix', Load(), lineno=141, col_offset=59)], Load(), lineno=141, col_offset=32), lineno=141, col_offset=16), Assign([Attribute(Subscript(Name('next_stmt', Load(), lineno=142, col_offset=16), Index(Num(0, lineno=142, col_offset=26)), Load(), lineno=142, col_offset=16), 'prefix', Store(), lineno=142, col_offset=16)], Call(Attribute(Str(u'\n', lineno=142, col_offset=38), 'join', Load(), lineno=142, col_offset=38), [Name('prefix_lines', Load(), lineno=142, col_offset=49)], [], None, None, lineno=142, col_offset=38), lineno=142, col_offset=16)], [Assert(Attribute(Name('list_call', Load(), lineno=144, col_offset=23), 'parent', Load(), lineno=144, col_offset=23), None, lineno=144, col_offset=16), Assert(Compare(Attribute(Name('list_call', Load(), lineno=145, col_offset=23), 'next_sibling', Load(), lineno=145, col_offset=23), [Is()], [Name('None', Load(), lineno=145, col_offset=49)], lineno=145, col_offset=23), None, lineno=145, col_offset=16), Assign([Name('end_line', Store(), lineno=147, col_offset=16)], Call(Name('BlankLine', Load(), lineno=147, col_offset=27), [], [], None, None, lineno=147, col_offset=27), lineno=147, col_offset=16), Expr(Call(Attribute(Attribute(Name('list_call', Load(), lineno=148, col_offset=16), 'parent', Load(), lineno=148, col_offset=16), 'append_child', Load(), lineno=148, col_offset=16), [Name('end_line', Load(), lineno=148, col_offset=46)], [], None, None, lineno=148, col_offset=16), lineno=148, col_offset=16), Assert(Compare(Attribute(Name('list_call', Load(), lineno=149, col_offset=23), 'next_sibling', Load(), lineno=149, col_offset=23), [Is()], [Name('end_line', Load(), lineno=149, col_offset=49)], lineno=149, col_offset=23), None, lineno=149, col_offset=16), Assign([Attribute(Name('end_line', Load(), lineno=152, col_offset=16), 'prefix', Store(), lineno=152, col_offset=16)], Subscript(Call(Attribute(Name('btwn', Load(), lineno=152, col_offset=34), 'rpartition', Load(), lineno=152, col_offset=34), [Str(u'\n', lineno=152, col_offset=50)], [], None, None, lineno=152, col_offset=34), Index(Num(0, lineno=152, col_offset=57)), Load(), lineno=152, col_offset=34), lineno=152, col_offset=16)], lineno=137, col_offset=12)], [], lineno=136, col_offset=8)], [], lineno=116, col_offset=4)], [], lineno=37, col_offset=0)])
