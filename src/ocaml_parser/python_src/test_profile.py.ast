Module([Expr(Str('Test suite for the profile module.', lineno=1, col_offset=0), lineno=1, col_offset=0), Import([alias('sys', None)], lineno=3, col_offset=0), Import([alias('pstats', None)], lineno=4, col_offset=0), Import([alias('unittest', None)], lineno=5, col_offset=0), ImportFrom('StringIO', [alias('StringIO', None)], 0, lineno=6, col_offset=0), ImportFrom('test.test_support', [alias('run_unittest', None)], 0, lineno=7, col_offset=0), Import([alias('profile', None)], lineno=9, col_offset=0), ImportFrom('test.profilee', [alias('testfunc', None), alias('timer', None)], 0, lineno=10, col_offset=0), ClassDef('ProfileTest', [Attribute(Name('unittest', Load(), lineno=13, col_offset=18), 'TestCase', Load(), lineno=13, col_offset=18)], [Assign([Name('profilerclass', Store(), lineno=15, col_offset=4)], Attribute(Name('profile', Load(), lineno=15, col_offset=20), 'Profile', Load(), lineno=15, col_offset=20), lineno=15, col_offset=4), Assign([Name('methodnames', Store(), lineno=16, col_offset=4)], List([Str('print_stats', lineno=16, col_offset=19), Str('print_callers', lineno=16, col_offset=34), Str('print_callees', lineno=16, col_offset=51)], Load(), lineno=16, col_offset=18), lineno=16, col_offset=4), Assign([Name('expected_output', Store(), lineno=17, col_offset=4)], Dict([], [], lineno=17, col_offset=22), lineno=17, col_offset=4), Assign([Name('expected_list_sort_output', Store(), lineno=18, col_offset=4)], Str(':0(sort)', lineno=18, col_offset=32), lineno=18, col_offset=4), FunctionDef('do_profiling', arguments([Name('cls', Param(), lineno=21, col_offset=21)], None, None, []), [Assign([Name('results', Store(), lineno=22, col_offset=8)], List([], Load(), lineno=22, col_offset=18), lineno=22, col_offset=8), Assign([Name('prof', Store(), lineno=23, col_offset=8)], Call(Attribute(Name('cls', Load(), lineno=23, col_offset=15), 'profilerclass', Load(), lineno=23, col_offset=15), [Name('timer', Load(), lineno=23, col_offset=33), Num(0.001, lineno=23, col_offset=40)], [], None, None, lineno=23, col_offset=15), lineno=23, col_offset=8), Assign([Name('start_timer', Store(), lineno=24, col_offset=8)], Call(Name('timer', Load(), lineno=24, col_offset=22), [], [], None, None, lineno=24, col_offset=22), lineno=24, col_offset=8), Expr(Call(Attribute(Name('prof', Load(), lineno=25, col_offset=8), 'runctx', Load(), lineno=25, col_offset=8), [Str('testfunc()', lineno=25, col_offset=20), Call(Name('globals', Load(), lineno=25, col_offset=34), [], [], None, None, lineno=25, col_offset=34), Call(Name('locals', Load(), lineno=25, col_offset=45), [], [], None, None, lineno=25, col_offset=45)], [], None, None, lineno=25, col_offset=8), lineno=25, col_offset=8), Expr(Call(Attribute(Name('results', Load(), lineno=26, col_offset=8), 'append', Load(), lineno=26, col_offset=8), [BinOp(Call(Name('timer', Load(), lineno=26, col_offset=23), [], [], None, None, lineno=26, col_offset=23), Sub(), Name('start_timer', Load(), lineno=26, col_offset=33), lineno=26, col_offset=23)], [], None, None, lineno=26, col_offset=8), lineno=26, col_offset=8), For(Name('methodname', Store(), lineno=27, col_offset=12), Attribute(Name('cls', Load(), lineno=27, col_offset=26), 'methodnames', Load(), lineno=27, col_offset=26), [Assign([Name('s', Store(), lineno=28, col_offset=12)], Call(Name('StringIO', Load(), lineno=28, col_offset=16), [], [], None, None, lineno=28, col_offset=16), lineno=28, col_offset=12), Assign([Name('stats', Store(), lineno=29, col_offset=12)], Call(Attribute(Name('pstats', Load(), lineno=29, col_offset=20), 'Stats', Load(), lineno=29, col_offset=20), [Name('prof', Load(), lineno=29, col_offset=33)], [keyword('stream', Name('s', Load(), lineno=29, col_offset=46))], None, None, lineno=29, col_offset=20), lineno=29, col_offset=12), Expr(Call(Attribute(Call(Attribute(Name('stats', Load(), lineno=30, col_offset=12), 'strip_dirs', Load(), lineno=30, col_offset=12), [], [], None, None, lineno=30, col_offset=12), 'sort_stats', Load(), lineno=30, col_offset=12), [Str('stdname', lineno=30, col_offset=42)], [], None, None, lineno=30, col_offset=12), lineno=30, col_offset=12), Expr(Call(Call(Name('getattr', Load(), lineno=31, col_offset=12), [Name('stats', Load(), lineno=31, col_offset=20), Name('methodname', Load(), lineno=31, col_offset=27)], [], None, None, lineno=31, col_offset=12), [], [], None, None, lineno=31, col_offset=12), lineno=31, col_offset=12), Expr(Call(Attribute(Name('results', Load(), lineno=32, col_offset=12), 'append', Load(), lineno=32, col_offset=12), [Call(Attribute(Name('s', Load(), lineno=32, col_offset=27), 'getvalue', Load(), lineno=32, col_offset=27), [], [], None, None, lineno=32, col_offset=27)], [], None, None, lineno=32, col_offset=12), lineno=32, col_offset=12)], [], lineno=27, col_offset=8), Return(Name('results', Load(), lineno=33, col_offset=15), lineno=33, col_offset=8)], [Name('classmethod', Load(), lineno=20, col_offset=5)], lineno=20, col_offset=4), FunctionDef('test_cprofile', arguments([Name('self', Param(), lineno=35, col_offset=22)], None, None, []), [Assign([Name('results', Store(), lineno=36, col_offset=8)], Call(Attribute(Name('self', Load(), lineno=36, col_offset=18), 'do_profiling', Load(), lineno=36, col_offset=18), [], [], None, None, lineno=36, col_offset=18), lineno=36, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=37, col_offset=8), 'assertEqual', Load(), lineno=37, col_offset=8), [Subscript(Name('results', Load(), lineno=37, col_offset=25), Index(Num(0, lineno=37, col_offset=33)), Load(), lineno=37, col_offset=25), Num(1000, lineno=37, col_offset=37)], [], None, None, lineno=37, col_offset=8), lineno=37, col_offset=8), For(Tuple([Name('i', Store(), lineno=38, col_offset=12), Name('method', Store(), lineno=38, col_offset=15)], Store(), lineno=38, col_offset=12), Call(Name('enumerate', Load(), lineno=38, col_offset=25), [Attribute(Name('self', Load(), lineno=38, col_offset=35), 'methodnames', Load(), lineno=38, col_offset=35)], [], None, None, lineno=38, col_offset=25), [Expr(Call(Attribute(Name('self', Load(), lineno=39, col_offset=12), 'assertEqual', Load(), lineno=39, col_offset=12), [Subscript(Name('results', Load(), lineno=39, col_offset=29), Index(BinOp(Name('i', Load(), lineno=39, col_offset=37), Add(), Num(1, lineno=39, col_offset=39), lineno=39, col_offset=37)), Load(), lineno=39, col_offset=29), Subscript(Attribute(Name('self', Load(), lineno=39, col_offset=43), 'expected_output', Load(), lineno=39, col_offset=43), Index(Name('method', Load(), lineno=39, col_offset=64)), Load(), lineno=39, col_offset=43), BinOp(Str("Stats.%s output for %s doesn't fit expectation!", lineno=40, col_offset=29), Mod(), Tuple([Name('method', Load(), lineno=41, col_offset=30), Attribute(Attribute(Name('self', Load(), lineno=41, col_offset=38), 'profilerclass', Load(), lineno=41, col_offset=38), '__name__', Load(), lineno=41, col_offset=38)], Load(), lineno=41, col_offset=30), lineno=40, col_offset=29)], [], None, None, lineno=39, col_offset=12), lineno=39, col_offset=12)], [], lineno=38, col_offset=8)], [], lineno=35, col_offset=4), FunctionDef('test_calling_conventions', arguments([Name('self', Param(), lineno=43, col_offset=33)], None, None, []), [Assign([Name('stmts', Store(), lineno=46, col_offset=8)], List([Str('[].sort()', lineno=47, col_offset=12), Str('[].sort(reverse=True)', lineno=48, col_offset=12), Str('[].sort(*(None, None, True))', lineno=49, col_offset=12), Str('[].sort(**dict(reverse=True))', lineno=50, col_offset=12)], Load(), lineno=46, col_offset=16), lineno=46, col_offset=8), For(Name('stmt', Store(), lineno=52, col_offset=12), Name('stmts', Load(), lineno=52, col_offset=20), [Assign([Name('s', Store(), lineno=53, col_offset=12)], Call(Name('StringIO', Load(), lineno=53, col_offset=16), [], [], None, None, lineno=53, col_offset=16), lineno=53, col_offset=12), Assign([Name('prof', Store(), lineno=54, col_offset=12)], Call(Attribute(Name('self', Load(), lineno=54, col_offset=19), 'profilerclass', Load(), lineno=54, col_offset=19), [Name('timer', Load(), lineno=54, col_offset=38), Num(0.001, lineno=54, col_offset=45)], [], None, None, lineno=54, col_offset=19), lineno=54, col_offset=12), Expr(Call(Attribute(Name('prof', Load(), lineno=55, col_offset=12), 'runctx', Load(), lineno=55, col_offset=12), [Name('stmt', Load(), lineno=55, col_offset=24), Call(Name('globals', Load(), lineno=55, col_offset=30), [], [], None, None, lineno=55, col_offset=30), Call(Name('locals', Load(), lineno=55, col_offset=41), [], [], None, None, lineno=55, col_offset=41)], [], None, None, lineno=55, col_offset=12), lineno=55, col_offset=12), Assign([Name('stats', Store(), lineno=56, col_offset=12)], Call(Attribute(Name('pstats', Load(), lineno=56, col_offset=20), 'Stats', Load(), lineno=56, col_offset=20), [Name('prof', Load(), lineno=56, col_offset=33)], [keyword('stream', Name('s', Load(), lineno=56, col_offset=46))], None, None, lineno=56, col_offset=20), lineno=56, col_offset=12), Expr(Call(Attribute(Name('stats', Load(), lineno=57, col_offset=12), 'print_stats', Load(), lineno=57, col_offset=12), [], [], None, None, lineno=57, col_offset=12), lineno=57, col_offset=12), Assign([Name('res', Store(), lineno=58, col_offset=12)], Call(Attribute(Name('s', Load(), lineno=58, col_offset=18), 'getvalue', Load(), lineno=58, col_offset=18), [], [], None, None, lineno=58, col_offset=18), lineno=58, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=59, col_offset=12), 'assertIn', Load(), lineno=59, col_offset=12), [Attribute(Name('self', Load(), lineno=59, col_offset=26), 'expected_list_sort_output', Load(), lineno=59, col_offset=26), Name('res', Load(), lineno=59, col_offset=58), Call(Attribute(Str("Profiling {0!r} didn't report list.sort:\n{1}", lineno=60, col_offset=16), 'format', Load(), lineno=60, col_offset=16), [Name('stmt', Load(), lineno=60, col_offset=71), Name('res', Load(), lineno=60, col_offset=77)], [], None, None, lineno=60, col_offset=16)], [], None, None, lineno=59, col_offset=12), lineno=59, col_offset=12)], [], lineno=52, col_offset=8)], [], lineno=43, col_offset=4)], [], lineno=13, col_offset=0), FunctionDef('regenerate_expected_output', arguments([Name('filename', Param(), lineno=63, col_offset=31), Name('cls', Param(), lineno=63, col_offset=41)], None, None, []), [Assign([Name('filename', Store(), lineno=64, col_offset=4)], Call(Attribute(Name('filename', Load(), lineno=64, col_offset=15), 'rstrip', Load(), lineno=64, col_offset=15), [Str('co', lineno=64, col_offset=31)], [], None, None, lineno=64, col_offset=15), lineno=64, col_offset=4), Print(None, [BinOp(Str('Regenerating %s...', lineno=65, col_offset=10), Mod(), Name('filename', Load(), lineno=65, col_offset=33), lineno=65, col_offset=10)], True, lineno=65, col_offset=4), Assign([Name('results', Store(), lineno=66, col_offset=4)], Call(Attribute(Name('cls', Load(), lineno=66, col_offset=14), 'do_profiling', Load(), lineno=66, col_offset=14), [], [], None, None, lineno=66, col_offset=14), lineno=66, col_offset=4), Assign([Name('newfile', Store(), lineno=68, col_offset=4)], List([], Load(), lineno=68, col_offset=14), lineno=68, col_offset=4), With(Call(Name('open', Load(), lineno=69, col_offset=9), [Name('filename', Load(), lineno=69, col_offset=14), Str('r', lineno=69, col_offset=24)], [], None, None, lineno=69, col_offset=9), Name('f', Store(), lineno=69, col_offset=32), [For(Name('line', Store(), lineno=70, col_offset=12), Name('f', Load(), lineno=70, col_offset=20), [Expr(Call(Attribute(Name('newfile', Load(), lineno=71, col_offset=12), 'append', Load(), lineno=71, col_offset=12), [Name('line', Load(), lineno=71, col_offset=27)], [], None, None, lineno=71, col_offset=12), lineno=71, col_offset=12), If(Compare(Subscript(Name('line', Load(), lineno=72, col_offset=15), Slice(None, Num(6, lineno=72, col_offset=21), None), Load(), lineno=72, col_offset=15), [Eq()], [Str('#--cut', lineno=72, col_offset=27)], lineno=72, col_offset=15), [Break( lineno=73, col_offset=16)], [], lineno=72, col_offset=12)], [], lineno=70, col_offset=8)], lineno=69, col_offset=9), With(Call(Name('open', Load(), lineno=75, col_offset=9), [Name('filename', Load(), lineno=75, col_offset=14), Str('w', lineno=75, col_offset=24)], [], None, None, lineno=75, col_offset=9), Name('f', Store(), lineno=75, col_offset=32), [Expr(Call(Attribute(Name('f', Load(), lineno=76, col_offset=8), 'writelines', Load(), lineno=76, col_offset=8), [Name('newfile', Load(), lineno=76, col_offset=21)], [], None, None, lineno=76, col_offset=8), lineno=76, col_offset=8), For(Tuple([Name('i', Store(), lineno=77, col_offset=12), Name('method', Store(), lineno=77, col_offset=15)], Store(), lineno=77, col_offset=12), Call(Name('enumerate', Load(), lineno=77, col_offset=25), [Attribute(Name('cls', Load(), lineno=77, col_offset=35), 'methodnames', Load(), lineno=77, col_offset=35)], [], None, None, lineno=77, col_offset=25), [Expr(Call(Attribute(Name('f', Load(), lineno=78, col_offset=12), 'write', Load(), lineno=78, col_offset=12), [BinOp(Str('%s.expected_output[%r] = """\\\n%s"""\n', lineno=78, col_offset=20), Mod(), Tuple([Attribute(Name('cls', Load(), lineno=79, col_offset=16), '__name__', Load(), lineno=79, col_offset=16), Name('method', Load(), lineno=79, col_offset=30), Subscript(Name('results', Load(), lineno=79, col_offset=38), Index(BinOp(Name('i', Load(), lineno=79, col_offset=46), Add(), Num(1, lineno=79, col_offset=48), lineno=79, col_offset=46)), Load(), lineno=79, col_offset=38)], Load(), lineno=79, col_offset=16), lineno=78, col_offset=20)], [], None, None, lineno=78, col_offset=12), lineno=78, col_offset=12)], [], lineno=77, col_offset=8), Expr(Call(Attribute(Name('f', Load(), lineno=80, col_offset=8), 'write', Load(), lineno=80, col_offset=8), [Str('\nif __name__ == "__main__":\n    main()\n', lineno=80, col_offset=16)], [], None, None, lineno=80, col_offset=8), lineno=80, col_offset=8)], lineno=75, col_offset=9)], [], lineno=63, col_offset=0), FunctionDef('test_main', arguments([], None, None, []), [Expr(Call(Name('run_unittest', Load(), lineno=84, col_offset=4), [Name('ProfileTest', Load(), lineno=84, col_offset=17)], [], None, None, lineno=84, col_offset=4), lineno=84, col_offset=4)], [], lineno=83, col_offset=0), FunctionDef('main', arguments([], None, None, []), [If(Compare(Str('-r', lineno=87, col_offset=7), [NotIn()], [Attribute(Name('sys', Load(), lineno=87, col_offset=19), 'argv', Load(), lineno=87, col_offset=19)], lineno=87, col_offset=7), [Expr(Call(Name('test_main', Load(), lineno=88, col_offset=8), [], [], None, None, lineno=88, col_offset=8), lineno=88, col_offset=8)], [Expr(Call(Name('regenerate_expected_output', Load(), lineno=90, col_offset=8), [Name('__file__', Load(), lineno=90, col_offset=35), Name('ProfileTest', Load(), lineno=90, col_offset=45)], [], None, None, lineno=90, col_offset=8), lineno=90, col_offset=8)], lineno=87, col_offset=4)], [], lineno=86, col_offset=0), Assign([Subscript(Attribute(Name('ProfileTest', Load(), lineno=95, col_offset=0), 'expected_output', Load(), lineno=95, col_offset=0), Index(Str('print_stats', lineno=95, col_offset=28)), Store(), lineno=95, col_offset=0)], Str('         127 function calls (107 primitive calls) in 999.749 seconds\n\n   Ordered by: standard name\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        4   -0.004   -0.001   -0.004   -0.001 :0(append)\n        4   -0.004   -0.001   -0.004   -0.001 :0(exc_info)\n       12   -0.024   -0.002   11.964    0.997 :0(hasattr)\n        8   -0.008   -0.001   -0.008   -0.001 :0(range)\n        1    0.000    0.000    0.000    0.000 :0(setprofile)\n        1   -0.002   -0.002  999.751  999.751 <string>:1(<module>)\n        0    0.000             0.000          profile:0(profiler)\n        1   -0.002   -0.002  999.749  999.749 profile:0(testfunc())\n       28   27.972    0.999   27.972    0.999 profilee.py:110(__getattr__)\n        1  269.996  269.996  999.753  999.753 profilee.py:25(testfunc)\n     23/3  149.937    6.519  169.917   56.639 profilee.py:35(factorial)\n       20   19.980    0.999   19.980    0.999 profilee.py:48(mul)\n        2   39.986   19.993  599.814  299.907 profilee.py:55(helper)\n        4  115.984   28.996  119.964   29.991 profilee.py:73(helper1)\n        2   -0.006   -0.003  139.942   69.971 profilee.py:84(helper2_indirect)\n        8  311.976   38.997  399.896   49.987 profilee.py:88(helper2)\n        8   63.968    7.996   79.944    9.993 profilee.py:98(subhelper)\n\n\n', lineno=120, col_offset=-1), lineno=95, col_offset=0), Assign([Subscript(Attribute(Name('ProfileTest', Load(), lineno=121, col_offset=0), 'expected_output', Load(), lineno=121, col_offset=0), Index(Str('print_callers', lineno=121, col_offset=28)), Store(), lineno=121, col_offset=0)], Str('   Ordered by: standard name\n\nFunction                          was called by...\n:0(append)                        <- profilee.py:73(helper1)(4)  119.964\n:0(exc_info)                      <- profilee.py:73(helper1)(4)  119.964\n:0(hasattr)                       <- profilee.py:73(helper1)(4)  119.964\n                                     profilee.py:88(helper2)(8)  399.896\n:0(range)                         <- profilee.py:98(subhelper)(8)   79.944\n:0(setprofile)                    <- profile:0(testfunc())(1)  999.749\n<string>:1(<module>)              <- profile:0(testfunc())(1)  999.749\nprofile:0(profiler)               <-\nprofile:0(testfunc())             <- profile:0(profiler)(1)    0.000\nprofilee.py:110(__getattr__)      <- :0(hasattr)(12)   11.964\n                                     profilee.py:98(subhelper)(16)   79.944\nprofilee.py:25(testfunc)          <- <string>:1(<module>)(1)  999.751\nprofilee.py:35(factorial)         <- profilee.py:25(testfunc)(1)  999.753\n                                     profilee.py:35(factorial)(20)  169.917\n                                     profilee.py:84(helper2_indirect)(2)  139.942\nprofilee.py:48(mul)               <- profilee.py:35(factorial)(20)  169.917\nprofilee.py:55(helper)            <- profilee.py:25(testfunc)(2)  999.753\nprofilee.py:73(helper1)           <- profilee.py:55(helper)(4)  599.814\nprofilee.py:84(helper2_indirect)  <- profilee.py:55(helper)(2)  599.814\nprofilee.py:88(helper2)           <- profilee.py:55(helper)(6)  599.814\n                                     profilee.py:84(helper2_indirect)(2)  139.942\nprofilee.py:98(subhelper)         <- profilee.py:88(helper2)(8)  399.896\n\n\n', lineno=149, col_offset=-1), lineno=121, col_offset=0), Assign([Subscript(Attribute(Name('ProfileTest', Load(), lineno=150, col_offset=0), 'expected_output', Load(), lineno=150, col_offset=0), Index(Str('print_callees', lineno=150, col_offset=28)), Store(), lineno=150, col_offset=0)], Str('   Ordered by: standard name\n\nFunction                          called...\n:0(append)                        ->\n:0(exc_info)                      ->\n:0(hasattr)                       -> profilee.py:110(__getattr__)(12)   27.972\n:0(range)                         ->\n:0(setprofile)                    ->\n<string>:1(<module>)              -> profilee.py:25(testfunc)(1)  999.753\nprofile:0(profiler)               -> profile:0(testfunc())(1)  999.749\nprofile:0(testfunc())             -> :0(setprofile)(1)    0.000\n                                     <string>:1(<module>)(1)  999.751\nprofilee.py:110(__getattr__)      ->\nprofilee.py:25(testfunc)          -> profilee.py:35(factorial)(1)  169.917\n                                     profilee.py:55(helper)(2)  599.814\nprofilee.py:35(factorial)         -> profilee.py:35(factorial)(20)  169.917\n                                     profilee.py:48(mul)(20)   19.980\nprofilee.py:48(mul)               ->\nprofilee.py:55(helper)            -> profilee.py:73(helper1)(4)  119.964\n                                     profilee.py:84(helper2_indirect)(2)  139.942\n                                     profilee.py:88(helper2)(6)  399.896\nprofilee.py:73(helper1)           -> :0(append)(4)   -0.004\n                                     :0(exc_info)(4)   -0.004\n                                     :0(hasattr)(4)   11.964\nprofilee.py:84(helper2_indirect)  -> profilee.py:35(factorial)(2)  169.917\n                                     profilee.py:88(helper2)(2)  399.896\nprofilee.py:88(helper2)           -> :0(hasattr)(8)   11.964\n                                     profilee.py:98(subhelper)(8)   79.944\nprofilee.py:98(subhelper)         -> :0(range)(8)   -0.008\n                                     profilee.py:110(__getattr__)(16)   27.972\n\n\n', lineno=183, col_offset=-1), lineno=150, col_offset=0), If(Compare(Name('__name__', Load(), lineno=185, col_offset=3), [Eq()], [Str('__main__', lineno=185, col_offset=15)], lineno=185, col_offset=3), [Expr(Call(Name('main', Load(), lineno=186, col_offset=4), [], [], None, None, lineno=186, col_offset=4), lineno=186, col_offset=4)], [], lineno=185, col_offset=0)])
