Module([Expr(Str('\nTestCases for testing the locking sub-system.\n', lineno=3, col_offset=-1), lineno=3, col_offset=-1), Import([alias('time', None)], lineno=5, col_offset=0), Import([alias('unittest', None)], lineno=7, col_offset=0), ImportFrom('test_all', [alias('db', None), alias('test_support', None), alias('verbose', None), alias('have_threads', None), alias('get_new_environment_path', None), alias('get_new_database_path', None)], 0, lineno=8, col_offset=0), If(Name('have_threads', Load(), lineno=11, col_offset=3), [ImportFrom('threading', [alias('Thread', None)], 0, lineno=12, col_offset=4), Import([alias('sys', None)], lineno=13, col_offset=4), If(Compare(Subscript(Attribute(Name('sys', Load(), lineno=14, col_offset=7), 'version_info', Load(), lineno=14, col_offset=7), Index(Num(0, lineno=14, col_offset=24)), Load(), lineno=14, col_offset=7), [Lt()], [Num(3, lineno=14, col_offset=29)], lineno=14, col_offset=7), [ImportFrom('threading', [alias('currentThread', None)], 0, lineno=15, col_offset=8)], [ImportFrom('threading', [alias('current_thread', 'currentThread')], 0, lineno=17, col_offset=8)], lineno=14, col_offset=4)], [], lineno=11, col_offset=0), ClassDef('LockingTestCase', [Attribute(Name('unittest', Load(), lineno=21, col_offset=22), 'TestCase', Load(), lineno=21, col_offset=22)], [Import([alias('sys', None)], lineno=22, col_offset=4), If(Compare(Attribute(Name('sys', Load(), lineno=23, col_offset=7), 'version_info', Load(), lineno=23, col_offset=7), [Lt()], [Tuple([Num(2, lineno=23, col_offset=27), Num(4, lineno=23, col_offset=30)], Load(), lineno=23, col_offset=27)], lineno=23, col_offset=7), [FunctionDef('assertTrue', arguments([Name('self', Param(), lineno=24, col_offset=23), Name('expr', Param(), lineno=24, col_offset=29), Name('msg', Param(), lineno=24, col_offset=35)], None, None, [Name('None', Load(), lineno=24, col_offset=39)]), [Expr(Call(Attribute(Name('self', Load(), lineno=25, col_offset=12), 'failUnless', Load(), lineno=25, col_offset=12), [Name('expr', Load(), lineno=25, col_offset=28)], [keyword('msg', Name('msg', Load(), lineno=25, col_offset=37))], None, None, lineno=25, col_offset=12), lineno=25, col_offset=12)], [], lineno=24, col_offset=8)], [], lineno=23, col_offset=4), FunctionDef('setUp', arguments([Name('self', Param(), lineno=28, col_offset=14)], None, None, []), [Assign([Attribute(Name('self', Load(), lineno=29, col_offset=8), 'homeDir', Store(), lineno=29, col_offset=8)], Call(Name('get_new_environment_path', Load(), lineno=29, col_offset=23), [], [], None, None, lineno=29, col_offset=23), lineno=29, col_offset=8), Assign([Attribute(Name('self', Load(), lineno=30, col_offset=8), 'env', Store(), lineno=30, col_offset=8)], Call(Attribute(Name('db', Load(), lineno=30, col_offset=19), 'DBEnv', Load(), lineno=30, col_offset=19), [], [], None, None, lineno=30, col_offset=19), lineno=30, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=31, col_offset=8), 'env', Load(), lineno=31, col_offset=8), 'open', Load(), lineno=31, col_offset=8), [Attribute(Name('self', Load(), lineno=31, col_offset=22), 'homeDir', Load(), lineno=31, col_offset=22), BinOp(BinOp(BinOp(Attribute(Name('db', Load(), lineno=31, col_offset=36), 'DB_THREAD', Load(), lineno=31, col_offset=36), BitOr(), Attribute(Name('db', Load(), lineno=31, col_offset=51), 'DB_INIT_MPOOL', Load(), lineno=31, col_offset=51), lineno=31, col_offset=36), BitOr(), Attribute(Name('db', Load(), lineno=32, col_offset=36), 'DB_INIT_LOCK', Load(), lineno=32, col_offset=36), lineno=31, col_offset=68), BitOr(), Attribute(Name('db', Load(), lineno=32, col_offset=54), 'DB_CREATE', Load(), lineno=32, col_offset=54), lineno=32, col_offset=52)], [], None, None, lineno=31, col_offset=8), lineno=31, col_offset=8)], [], lineno=28, col_offset=4), FunctionDef('tearDown', arguments([Name('self', Param(), lineno=35, col_offset=17)], None, None, []), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=36, col_offset=8), 'env', Load(), lineno=36, col_offset=8), 'close', Load(), lineno=36, col_offset=8), [], [], None, None, lineno=36, col_offset=8), lineno=36, col_offset=8), Expr(Call(Attribute(Name('test_support', Load(), lineno=37, col_offset=8), 'rmtree', Load(), lineno=37, col_offset=8), [Attribute(Name('self', Load(), lineno=37, col_offset=28), 'homeDir', Load(), lineno=37, col_offset=28)], [], None, None, lineno=37, col_offset=8), lineno=37, col_offset=8)], [], lineno=35, col_offset=4), FunctionDef('test01_simple', arguments([Name('self', Param(), lineno=40, col_offset=22)], None, None, []), [If(Name('verbose', Load(), lineno=41, col_offset=11), [Print(None, [Str('\n', lineno=42, col_offset=18), BinOp(Str('-=', lineno=42, col_offset=24), Mult(), Num(30, lineno=42, col_offset=31), lineno=42, col_offset=24)], True, lineno=42, col_offset=12), Print(None, [BinOp(Str('Running %s.test01_simple...', lineno=43, col_offset=18), Mod(), Attribute(Attribute(Name('self', Load(), lineno=43, col_offset=50), '__class__', Load(), lineno=43, col_offset=50), '__name__', Load(), lineno=43, col_offset=50), lineno=43, col_offset=18)], True, lineno=43, col_offset=12)], [], lineno=41, col_offset=8), Assign([Name('anID', Store(), lineno=45, col_offset=8)], Call(Attribute(Attribute(Name('self', Load(), lineno=45, col_offset=15), 'env', Load(), lineno=45, col_offset=15), 'lock_id', Load(), lineno=45, col_offset=15), [], [], None, None, lineno=45, col_offset=15), lineno=45, col_offset=8), If(Name('verbose', Load(), lineno=46, col_offset=11), [Print(None, [BinOp(Str('locker ID: %s', lineno=47, col_offset=18), Mod(), Name('anID', Load(), lineno=47, col_offset=36), lineno=47, col_offset=18)], True, lineno=47, col_offset=12)], [], lineno=46, col_offset=8), Assign([Name('lock', Store(), lineno=48, col_offset=8)], Call(Attribute(Attribute(Name('self', Load(), lineno=48, col_offset=15), 'env', Load(), lineno=48, col_offset=15), 'lock_get', Load(), lineno=48, col_offset=15), [Name('anID', Load(), lineno=48, col_offset=33), Str('some locked thing', lineno=48, col_offset=39), Attribute(Name('db', Load(), lineno=48, col_offset=60), 'DB_LOCK_WRITE', Load(), lineno=48, col_offset=60)], [], None, None, lineno=48, col_offset=15), lineno=48, col_offset=8), If(Name('verbose', Load(), lineno=49, col_offset=11), [Print(None, [BinOp(Str('Aquired lock: %s', lineno=50, col_offset=18), Mod(), Name('lock', Load(), lineno=50, col_offset=39), lineno=50, col_offset=18)], True, lineno=50, col_offset=12)], [], lineno=49, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=51, col_offset=8), 'env', Load(), lineno=51, col_offset=8), 'lock_put', Load(), lineno=51, col_offset=8), [Name('lock', Load(), lineno=51, col_offset=26)], [], None, None, lineno=51, col_offset=8), lineno=51, col_offset=8), If(Name('verbose', Load(), lineno=52, col_offset=11), [Print(None, [BinOp(Str('Released lock: %s', lineno=53, col_offset=18), Mod(), Name('lock', Load(), lineno=53, col_offset=40), lineno=53, col_offset=18)], True, lineno=53, col_offset=12)], [], lineno=52, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=54, col_offset=8), 'env', Load(), lineno=54, col_offset=8), 'lock_id_free', Load(), lineno=54, col_offset=8), [Name('anID', Load(), lineno=54, col_offset=30)], [], None, None, lineno=54, col_offset=8), lineno=54, col_offset=8)], [], lineno=40, col_offset=4), FunctionDef('test02_threaded', arguments([Name('self', Param(), lineno=57, col_offset=24)], None, None, []), [If(Name('verbose', Load(), lineno=58, col_offset=11), [Print(None, [Str('\n', lineno=59, col_offset=18), BinOp(Str('-=', lineno=59, col_offset=24), Mult(), Num(30, lineno=59, col_offset=31), lineno=59, col_offset=24)], True, lineno=59, col_offset=12), Print(None, [BinOp(Str('Running %s.test02_threaded...', lineno=60, col_offset=18), Mod(), Attribute(Attribute(Name('self', Load(), lineno=60, col_offset=52), '__class__', Load(), lineno=60, col_offset=52), '__name__', Load(), lineno=60, col_offset=52), lineno=60, col_offset=18)], True, lineno=60, col_offset=12)], [], lineno=58, col_offset=8), Assign([Name('threads', Store(), lineno=62, col_offset=8)], List([], Load(), lineno=62, col_offset=18), lineno=62, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=63, col_offset=8), 'append', Load(), lineno=63, col_offset=8), [Call(Name('Thread', Load(), lineno=63, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=63, col_offset=39), 'theThread', Load(), lineno=63, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=64, col_offset=36), 'DB_LOCK_WRITE', Load(), lineno=64, col_offset=36)], Load(), lineno=64, col_offset=36))], None, None, lineno=63, col_offset=23)], [], None, None, lineno=63, col_offset=8), lineno=63, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=65, col_offset=8), 'append', Load(), lineno=65, col_offset=8), [Call(Name('Thread', Load(), lineno=65, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=65, col_offset=39), 'theThread', Load(), lineno=65, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=66, col_offset=36), 'DB_LOCK_READ', Load(), lineno=66, col_offset=36)], Load(), lineno=66, col_offset=36))], None, None, lineno=65, col_offset=23)], [], None, None, lineno=65, col_offset=8), lineno=65, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=67, col_offset=8), 'append', Load(), lineno=67, col_offset=8), [Call(Name('Thread', Load(), lineno=67, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=67, col_offset=39), 'theThread', Load(), lineno=67, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=68, col_offset=36), 'DB_LOCK_READ', Load(), lineno=68, col_offset=36)], Load(), lineno=68, col_offset=36))], None, None, lineno=67, col_offset=23)], [], None, None, lineno=67, col_offset=8), lineno=67, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=69, col_offset=8), 'append', Load(), lineno=69, col_offset=8), [Call(Name('Thread', Load(), lineno=69, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=69, col_offset=39), 'theThread', Load(), lineno=69, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=70, col_offset=36), 'DB_LOCK_WRITE', Load(), lineno=70, col_offset=36)], Load(), lineno=70, col_offset=36))], None, None, lineno=69, col_offset=23)], [], None, None, lineno=69, col_offset=8), lineno=69, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=71, col_offset=8), 'append', Load(), lineno=71, col_offset=8), [Call(Name('Thread', Load(), lineno=71, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=71, col_offset=39), 'theThread', Load(), lineno=71, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=72, col_offset=36), 'DB_LOCK_READ', Load(), lineno=72, col_offset=36)], Load(), lineno=72, col_offset=36))], None, None, lineno=71, col_offset=23)], [], None, None, lineno=71, col_offset=8), lineno=71, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=73, col_offset=8), 'append', Load(), lineno=73, col_offset=8), [Call(Name('Thread', Load(), lineno=73, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=73, col_offset=39), 'theThread', Load(), lineno=73, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=74, col_offset=36), 'DB_LOCK_READ', Load(), lineno=74, col_offset=36)], Load(), lineno=74, col_offset=36))], None, None, lineno=73, col_offset=23)], [], None, None, lineno=73, col_offset=8), lineno=73, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=75, col_offset=8), 'append', Load(), lineno=75, col_offset=8), [Call(Name('Thread', Load(), lineno=75, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=75, col_offset=39), 'theThread', Load(), lineno=75, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=76, col_offset=36), 'DB_LOCK_WRITE', Load(), lineno=76, col_offset=36)], Load(), lineno=76, col_offset=36))], None, None, lineno=75, col_offset=23)], [], None, None, lineno=75, col_offset=8), lineno=75, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=77, col_offset=8), 'append', Load(), lineno=77, col_offset=8), [Call(Name('Thread', Load(), lineno=77, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=77, col_offset=39), 'theThread', Load(), lineno=77, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=78, col_offset=36), 'DB_LOCK_WRITE', Load(), lineno=78, col_offset=36)], Load(), lineno=78, col_offset=36))], None, None, lineno=77, col_offset=23)], [], None, None, lineno=77, col_offset=8), lineno=77, col_offset=8), Expr(Call(Attribute(Name('threads', Load(), lineno=79, col_offset=8), 'append', Load(), lineno=79, col_offset=8), [Call(Name('Thread', Load(), lineno=79, col_offset=23), [], [keyword('target', Attribute(Name('self', Load(), lineno=79, col_offset=39), 'theThread', Load(), lineno=79, col_offset=39)), keyword('args', Tuple([Attribute(Name('db', Load(), lineno=80, col_offset=36), 'DB_LOCK_WRITE', Load(), lineno=80, col_offset=36)], Load(), lineno=80, col_offset=36))], None, None, lineno=79, col_offset=23)], [], None, None, lineno=79, col_offset=8), lineno=79, col_offset=8), For(Name('t', Store(), lineno=82, col_offset=12), Name('threads', Load(), lineno=82, col_offset=17), [Import([alias('sys', None)], lineno=83, col_offset=12), If(Compare(Subscript(Attribute(Name('sys', Load(), lineno=84, col_offset=15), 'version_info', Load(), lineno=84, col_offset=15), Index(Num(0, lineno=84, col_offset=32)), Load(), lineno=84, col_offset=15), [Lt()], [Num(3, lineno=84, col_offset=37)], lineno=84, col_offset=15), [Expr(Call(Attribute(Name('t', Load(), lineno=85, col_offset=16), 'setDaemon', Load(), lineno=85, col_offset=16), [Name('True', Load(), lineno=85, col_offset=28)], [], None, None, lineno=85, col_offset=16), lineno=85, col_offset=16)], [Assign([Attribute(Name('t', Load(), lineno=87, col_offset=16), 'daemon', Store(), lineno=87, col_offset=16)], Name('True', Load(), lineno=87, col_offset=27), lineno=87, col_offset=16)], lineno=84, col_offset=12), Expr(Call(Attribute(Name('t', Load(), lineno=88, col_offset=12), 'start', Load(), lineno=88, col_offset=12), [], [], None, None, lineno=88, col_offset=12), lineno=88, col_offset=12)], [], lineno=82, col_offset=8), For(Name('t', Store(), lineno=89, col_offset=12), Name('threads', Load(), lineno=89, col_offset=17), [Expr(Call(Attribute(Name('t', Load(), lineno=90, col_offset=12), 'join', Load(), lineno=90, col_offset=12), [], [], None, None, lineno=90, col_offset=12), lineno=90, col_offset=12)], [], lineno=89, col_offset=8)], [], lineno=57, col_offset=4), If(Compare(Call(Attribute(Name('db', Load(), lineno=92, col_offset=7), 'version', Load(), lineno=92, col_offset=7), [], [], None, None, lineno=92, col_offset=7), [GtE()], [Tuple([Num(4, lineno=92, col_offset=24), Num(2, lineno=92, col_offset=27)], Load(), lineno=92, col_offset=24)], lineno=92, col_offset=7), [FunctionDef('test03_lock_timeout', arguments([Name('self', Param(), lineno=93, col_offset=32)], None, None, []), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=94, col_offset=12), 'env', Load(), lineno=94, col_offset=12), 'set_timeout', Load(), lineno=94, col_offset=12), [Num(0, lineno=94, col_offset=33), Attribute(Name('db', Load(), lineno=94, col_offset=36), 'DB_SET_LOCK_TIMEOUT', Load(), lineno=94, col_offset=36)], [], None, None, lineno=94, col_offset=12), lineno=94, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=95, col_offset=12), 'assertEqual', Load(), lineno=95, col_offset=12), [Call(Attribute(Attribute(Name('self', Load(), lineno=95, col_offset=29), 'env', Load(), lineno=95, col_offset=29), 'get_timeout', Load(), lineno=95, col_offset=29), [Attribute(Name('db', Load(), lineno=95, col_offset=50), 'DB_SET_LOCK_TIMEOUT', Load(), lineno=95, col_offset=50)], [], None, None, lineno=95, col_offset=29), Num(0, lineno=95, col_offset=75)], [], None, None, lineno=95, col_offset=12), lineno=95, col_offset=12), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=96, col_offset=12), 'env', Load(), lineno=96, col_offset=12), 'set_timeout', Load(), lineno=96, col_offset=12), [Num(0, lineno=96, col_offset=33), Attribute(Name('db', Load(), lineno=96, col_offset=36), 'DB_SET_TXN_TIMEOUT', Load(), lineno=96, col_offset=36)], [], None, None, lineno=96, col_offset=12), lineno=96, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=97, col_offset=12), 'assertEqual', Load(), lineno=97, col_offset=12), [Call(Attribute(Attribute(Name('self', Load(), lineno=97, col_offset=29), 'env', Load(), lineno=97, col_offset=29), 'get_timeout', Load(), lineno=97, col_offset=29), [Attribute(Name('db', Load(), lineno=97, col_offset=50), 'DB_SET_TXN_TIMEOUT', Load(), lineno=97, col_offset=50)], [], None, None, lineno=97, col_offset=29), Num(0, lineno=97, col_offset=74)], [], None, None, lineno=97, col_offset=12), lineno=97, col_offset=12), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=98, col_offset=12), 'env', Load(), lineno=98, col_offset=12), 'set_timeout', Load(), lineno=98, col_offset=12), [Num(123456, lineno=98, col_offset=33), Attribute(Name('db', Load(), lineno=98, col_offset=41), 'DB_SET_LOCK_TIMEOUT', Load(), lineno=98, col_offset=41)], [], None, None, lineno=98, col_offset=12), lineno=98, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=99, col_offset=12), 'assertEqual', Load(), lineno=99, col_offset=12), [Call(Attribute(Attribute(Name('self', Load(), lineno=99, col_offset=29), 'env', Load(), lineno=99, col_offset=29), 'get_timeout', Load(), lineno=99, col_offset=29), [Attribute(Name('db', Load(), lineno=99, col_offset=50), 'DB_SET_LOCK_TIMEOUT', Load(), lineno=99, col_offset=50)], [], None, None, lineno=99, col_offset=29), Num(123456, lineno=99, col_offset=75)], [], None, None, lineno=99, col_offset=12), lineno=99, col_offset=12), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=100, col_offset=12), 'env', Load(), lineno=100, col_offset=12), 'set_timeout', Load(), lineno=100, col_offset=12), [Num(7890123, lineno=100, col_offset=33), Attribute(Name('db', Load(), lineno=100, col_offset=42), 'DB_SET_TXN_TIMEOUT', Load(), lineno=100, col_offset=42)], [], None, None, lineno=100, col_offset=12), lineno=100, col_offset=12), Expr(Call(Attribute(Name('self', Load(), lineno=101, col_offset=12), 'assertEqual', Load(), lineno=101, col_offset=12), [Call(Attribute(Attribute(Name('self', Load(), lineno=101, col_offset=29), 'env', Load(), lineno=101, col_offset=29), 'get_timeout', Load(), lineno=101, col_offset=29), [Attribute(Name('db', Load(), lineno=101, col_offset=50), 'DB_SET_TXN_TIMEOUT', Load(), lineno=101, col_offset=50)], [], None, None, lineno=101, col_offset=29), Num(7890123, lineno=101, col_offset=74)], [], None, None, lineno=101, col_offset=12), lineno=101, col_offset=12)], [], lineno=93, col_offset=8)], [], lineno=92, col_offset=4), FunctionDef('test04_lock_timeout2', arguments([Name('self', Param(), lineno=103, col_offset=29)], None, None, []), [Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=104, col_offset=8), 'env', Load(), lineno=104, col_offset=8), 'set_timeout', Load(), lineno=104, col_offset=8), [Num(0, lineno=104, col_offset=29), Attribute(Name('db', Load(), lineno=104, col_offset=32), 'DB_SET_LOCK_TIMEOUT', Load(), lineno=104, col_offset=32)], [], None, None, lineno=104, col_offset=8), lineno=104, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=105, col_offset=8), 'env', Load(), lineno=105, col_offset=8), 'set_timeout', Load(), lineno=105, col_offset=8), [Num(0, lineno=105, col_offset=29), Attribute(Name('db', Load(), lineno=105, col_offset=32), 'DB_SET_TXN_TIMEOUT', Load(), lineno=105, col_offset=32)], [], None, None, lineno=105, col_offset=8), lineno=105, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=106, col_offset=8), 'env', Load(), lineno=106, col_offset=8), 'set_timeout', Load(), lineno=106, col_offset=8), [Num(123456, lineno=106, col_offset=29), Attribute(Name('db', Load(), lineno=106, col_offset=37), 'DB_SET_LOCK_TIMEOUT', Load(), lineno=106, col_offset=37)], [], None, None, lineno=106, col_offset=8), lineno=106, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=107, col_offset=8), 'env', Load(), lineno=107, col_offset=8), 'set_timeout', Load(), lineno=107, col_offset=8), [Num(7890123, lineno=107, col_offset=29), Attribute(Name('db', Load(), lineno=107, col_offset=38), 'DB_SET_TXN_TIMEOUT', Load(), lineno=107, col_offset=38)], [], None, None, lineno=107, col_offset=8), lineno=107, col_offset=8), FunctionDef('deadlock_detection', arguments([], None, None, []), [While(UnaryOp(Not(), Attribute(Name('deadlock_detection', Load(), lineno=110, col_offset=22), 'end', Load(), lineno=110, col_offset=22), lineno=110, col_offset=18), [Assign([Attribute(Name('deadlock_detection', Load(), lineno=111, col_offset=16), 'count', Store(), lineno=111, col_offset=16)], Call(Attribute(Attribute(Name('self', Load(), lineno=112, col_offset=20), 'env', Load(), lineno=112, col_offset=20), 'lock_detect', Load(), lineno=112, col_offset=20), [Attribute(Name('db', Load(), lineno=112, col_offset=41), 'DB_LOCK_EXPIRE', Load(), lineno=112, col_offset=41)], [], None, None, lineno=112, col_offset=20), lineno=111, col_offset=16), If(Attribute(Name('deadlock_detection', Load(), lineno=113, col_offset=19), 'count', Load(), lineno=113, col_offset=19), [While(UnaryOp(Not(), Attribute(Name('deadlock_detection', Load(), lineno=114, col_offset=30), 'end', Load(), lineno=114, col_offset=30), lineno=114, col_offset=26), [Pass( lineno=115, col_offset=24)], [], lineno=114, col_offset=20), Break( lineno=116, col_offset=20)], [], lineno=113, col_offset=16), Expr(Call(Attribute(Name('time', Load(), lineno=117, col_offset=16), 'sleep', Load(), lineno=117, col_offset=16), [Num(0.01, lineno=117, col_offset=27)], [], None, None, lineno=117, col_offset=16), lineno=117, col_offset=16)], [], lineno=110, col_offset=12)], [], lineno=109, col_offset=8), Assign([Attribute(Name('deadlock_detection', Load(), lineno=119, col_offset=8), 'end', Store(), lineno=119, col_offset=8)], Name('False', Load(), lineno=119, col_offset=31), lineno=119, col_offset=8), Assign([Attribute(Name('deadlock_detection', Load(), lineno=120, col_offset=8), 'count', Store(), lineno=120, col_offset=8)], Num(0, lineno=120, col_offset=33), lineno=120, col_offset=8), Assign([Name('t', Store(), lineno=121, col_offset=8)], Call(Name('Thread', Load(), lineno=121, col_offset=10), [], [keyword('target', Name('deadlock_detection', Load(), lineno=121, col_offset=24))], None, None, lineno=121, col_offset=10), lineno=121, col_offset=8), Import([alias('sys', None)], lineno=122, col_offset=8), If(Compare(Subscript(Attribute(Name('sys', Load(), lineno=123, col_offset=11), 'version_info', Load(), lineno=123, col_offset=11), Index(Num(0, lineno=123, col_offset=28)), Load(), lineno=123, col_offset=11), [Lt()], [Num(3, lineno=123, col_offset=33)], lineno=123, col_offset=11), [Expr(Call(Attribute(Name('t', Load(), lineno=124, col_offset=12), 'setDaemon', Load(), lineno=124, col_offset=12), [Name('True', Load(), lineno=124, col_offset=24)], [], None, None, lineno=124, col_offset=12), lineno=124, col_offset=12)], [Assign([Attribute(Name('t', Load(), lineno=126, col_offset=12), 'daemon', Store(), lineno=126, col_offset=12)], Name('True', Load(), lineno=126, col_offset=23), lineno=126, col_offset=12)], lineno=123, col_offset=8), Expr(Call(Attribute(Name('t', Load(), lineno=127, col_offset=8), 'start', Load(), lineno=127, col_offset=8), [], [], None, None, lineno=127, col_offset=8), lineno=127, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=128, col_offset=8), 'env', Load(), lineno=128, col_offset=8), 'set_timeout', Load(), lineno=128, col_offset=8), [Num(100000, lineno=128, col_offset=29), Attribute(Name('db', Load(), lineno=128, col_offset=37), 'DB_SET_LOCK_TIMEOUT', Load(), lineno=128, col_offset=37)], [], None, None, lineno=128, col_offset=8), lineno=128, col_offset=8), Assign([Name('anID', Store(), lineno=129, col_offset=8)], Call(Attribute(Attribute(Name('self', Load(), lineno=129, col_offset=15), 'env', Load(), lineno=129, col_offset=15), 'lock_id', Load(), lineno=129, col_offset=15), [], [], None, None, lineno=129, col_offset=15), lineno=129, col_offset=8), Assign([Name('anID2', Store(), lineno=130, col_offset=8)], Call(Attribute(Attribute(Name('self', Load(), lineno=130, col_offset=16), 'env', Load(), lineno=130, col_offset=16), 'lock_id', Load(), lineno=130, col_offset=16), [], [], None, None, lineno=130, col_offset=16), lineno=130, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=131, col_offset=8), 'assertNotEqual', Load(), lineno=131, col_offset=8), [Name('anID', Load(), lineno=131, col_offset=28), Name('anID2', Load(), lineno=131, col_offset=34)], [], None, None, lineno=131, col_offset=8), lineno=131, col_offset=8), Assign([Name('lock', Store(), lineno=132, col_offset=8)], Call(Attribute(Attribute(Name('self', Load(), lineno=132, col_offset=15), 'env', Load(), lineno=132, col_offset=15), 'lock_get', Load(), lineno=132, col_offset=15), [Name('anID', Load(), lineno=132, col_offset=33), Str('shared lock', lineno=132, col_offset=39), Attribute(Name('db', Load(), lineno=132, col_offset=54), 'DB_LOCK_WRITE', Load(), lineno=132, col_offset=54)], [], None, None, lineno=132, col_offset=15), lineno=132, col_offset=8), Assign([Name('start_time', Store(), lineno=133, col_offset=8)], Call(Attribute(Name('time', Load(), lineno=133, col_offset=19), 'time', Load(), lineno=133, col_offset=19), [], [], None, None, lineno=133, col_offset=19), lineno=133, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=134, col_offset=8), 'assertRaises', Load(), lineno=134, col_offset=8), [Attribute(Name('db', Load(), lineno=134, col_offset=26), 'DBLockNotGrantedError', Load(), lineno=134, col_offset=26), Attribute(Attribute(Name('self', Load(), lineno=135, col_offset=16), 'env', Load(), lineno=135, col_offset=16), 'lock_get', Load(), lineno=135, col_offset=16), Name('anID2', Load(), lineno=135, col_offset=34), Str('shared lock', lineno=135, col_offset=41), Attribute(Name('db', Load(), lineno=135, col_offset=56), 'DB_LOCK_READ', Load(), lineno=135, col_offset=56)], [], None, None, lineno=134, col_offset=8), lineno=134, col_offset=8), Assign([Name('end_time', Store(), lineno=136, col_offset=8)], Call(Attribute(Name('time', Load(), lineno=136, col_offset=17), 'time', Load(), lineno=136, col_offset=17), [], [], None, None, lineno=136, col_offset=17), lineno=136, col_offset=8), Assign([Attribute(Name('deadlock_detection', Load(), lineno=137, col_offset=8), 'end', Store(), lineno=137, col_offset=8)], Name('True', Load(), lineno=137, col_offset=31), lineno=137, col_offset=8), Expr(Call(Attribute(Name('self', Load(), lineno=139, col_offset=8), 'assertTrue', Load(), lineno=139, col_offset=8), [Compare(BinOp(Name('end_time', Load(), lineno=139, col_offset=25), Sub(), Name('start_time', Load(), lineno=139, col_offset=34), lineno=139, col_offset=25), [GtE()], [Num(0.0999, lineno=139, col_offset=49)], lineno=139, col_offset=24)], [], None, None, lineno=139, col_offset=8), lineno=139, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=140, col_offset=8), 'env', Load(), lineno=140, col_offset=8), 'lock_put', Load(), lineno=140, col_offset=8), [Name('lock', Load(), lineno=140, col_offset=26)], [], None, None, lineno=140, col_offset=8), lineno=140, col_offset=8), Expr(Call(Attribute(Name('t', Load(), lineno=141, col_offset=8), 'join', Load(), lineno=141, col_offset=8), [], [], None, None, lineno=141, col_offset=8), lineno=141, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=143, col_offset=8), 'env', Load(), lineno=143, col_offset=8), 'lock_id_free', Load(), lineno=143, col_offset=8), [Name('anID', Load(), lineno=143, col_offset=30)], [], None, None, lineno=143, col_offset=8), lineno=143, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=144, col_offset=8), 'env', Load(), lineno=144, col_offset=8), 'lock_id_free', Load(), lineno=144, col_offset=8), [Name('anID2', Load(), lineno=144, col_offset=30)], [], None, None, lineno=144, col_offset=8), lineno=144, col_offset=8), If(Compare(Call(Attribute(Name('db', Load(), lineno=146, col_offset=11), 'version', Load(), lineno=146, col_offset=11), [], [], None, None, lineno=146, col_offset=11), [GtE()], [Tuple([Num(4, lineno=146, col_offset=28), Num(6, lineno=146, col_offset=30)], Load(), lineno=146, col_offset=28)], lineno=146, col_offset=11), [Expr(Call(Attribute(Name('self', Load(), lineno=147, col_offset=12), 'assertTrue', Load(), lineno=147, col_offset=12), [Compare(Attribute(Name('deadlock_detection', Load(), lineno=147, col_offset=28), 'count', Load(), lineno=147, col_offset=28), [Gt()], [Num(0, lineno=147, col_offset=53)], lineno=147, col_offset=28)], [], None, None, lineno=147, col_offset=12), lineno=147, col_offset=12)], [], lineno=146, col_offset=8)], [], lineno=103, col_offset=4), FunctionDef('theThread', arguments([Name('self', Param(), lineno=149, col_offset=18), Name('lockType', Param(), lineno=149, col_offset=24)], None, None, []), [Import([alias('sys', None)], lineno=150, col_offset=8), If(Compare(Subscript(Attribute(Name('sys', Load(), lineno=151, col_offset=11), 'version_info', Load(), lineno=151, col_offset=11), Index(Num(0, lineno=151, col_offset=28)), Load(), lineno=151, col_offset=11), [Lt()], [Num(3, lineno=151, col_offset=33)], lineno=151, col_offset=11), [Assign([Name('name', Store(), lineno=152, col_offset=12)], Call(Attribute(Call(Name('currentThread', Load(), lineno=152, col_offset=19), [], [], None, None, lineno=152, col_offset=19), 'getName', Load(), lineno=152, col_offset=19), [], [], None, None, lineno=152, col_offset=19), lineno=152, col_offset=12)], [Assign([Name('name', Store(), lineno=154, col_offset=12)], Attribute(Call(Name('currentThread', Load(), lineno=154, col_offset=19), [], [], None, None, lineno=154, col_offset=19), 'name', Load(), lineno=154, col_offset=19), lineno=154, col_offset=12)], lineno=151, col_offset=8), If(Compare(Name('lockType', Load(), lineno=156, col_offset=11), [Eq()], [Attribute(Name('db', Load(), lineno=156, col_offset=24), 'DB_LOCK_WRITE', Load(), lineno=156, col_offset=24)], lineno=156, col_offset=11), [Assign([Name('lt', Store(), lineno=157, col_offset=12)], Str('write', lineno=157, col_offset=17), lineno=157, col_offset=12)], [Assign([Name('lt', Store(), lineno=159, col_offset=12)], Str('read', lineno=159, col_offset=17), lineno=159, col_offset=12)], lineno=156, col_offset=8), Assign([Name('anID', Store(), lineno=161, col_offset=8)], Call(Attribute(Attribute(Name('self', Load(), lineno=161, col_offset=15), 'env', Load(), lineno=161, col_offset=15), 'lock_id', Load(), lineno=161, col_offset=15), [], [], None, None, lineno=161, col_offset=15), lineno=161, col_offset=8), If(Name('verbose', Load(), lineno=162, col_offset=11), [Print(None, [BinOp(Str('%s: locker ID: %s', lineno=163, col_offset=18), Mod(), Tuple([Name('name', Load(), lineno=163, col_offset=41), Name('anID', Load(), lineno=163, col_offset=47)], Load(), lineno=163, col_offset=41), lineno=163, col_offset=18)], True, lineno=163, col_offset=12)], [], lineno=162, col_offset=8), For(Name('i', Store(), lineno=165, col_offset=12), Call(Name('xrange', Load(), lineno=165, col_offset=17), [Num(1000, lineno=165, col_offset=24)], [], None, None, lineno=165, col_offset=17), [Assign([Name('lock', Store(), lineno=166, col_offset=12)], Call(Attribute(Attribute(Name('self', Load(), lineno=166, col_offset=19), 'env', Load(), lineno=166, col_offset=19), 'lock_get', Load(), lineno=166, col_offset=19), [Name('anID', Load(), lineno=166, col_offset=37), Str('some locked thing', lineno=166, col_offset=43), Name('lockType', Load(), lineno=166, col_offset=64)], [], None, None, lineno=166, col_offset=19), lineno=166, col_offset=12), If(Name('verbose', Load(), lineno=167, col_offset=15), [Print(None, [BinOp(Str('%s: Aquired %s lock: %s', lineno=168, col_offset=22), Mod(), Tuple([Name('name', Load(), lineno=168, col_offset=51), Name('lt', Load(), lineno=168, col_offset=57), Name('lock', Load(), lineno=168, col_offset=61)], Load(), lineno=168, col_offset=51), lineno=168, col_offset=22)], True, lineno=168, col_offset=16)], [], lineno=167, col_offset=12), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=170, col_offset=12), 'env', Load(), lineno=170, col_offset=12), 'lock_put', Load(), lineno=170, col_offset=12), [Name('lock', Load(), lineno=170, col_offset=30)], [], None, None, lineno=170, col_offset=12), lineno=170, col_offset=12), If(Name('verbose', Load(), lineno=171, col_offset=15), [Print(None, [BinOp(Str('%s: Released %s lock: %s', lineno=172, col_offset=22), Mod(), Tuple([Name('name', Load(), lineno=172, col_offset=52), Name('lt', Load(), lineno=172, col_offset=58), Name('lock', Load(), lineno=172, col_offset=62)], Load(), lineno=172, col_offset=52), lineno=172, col_offset=22)], True, lineno=172, col_offset=16)], [], lineno=171, col_offset=12)], [], lineno=165, col_offset=8), Expr(Call(Attribute(Attribute(Name('self', Load(), lineno=174, col_offset=8), 'env', Load(), lineno=174, col_offset=8), 'lock_id_free', Load(), lineno=174, col_offset=8), [Name('anID', Load(), lineno=174, col_offset=30)], [], None, None, lineno=174, col_offset=8), lineno=174, col_offset=8)], [], lineno=149, col_offset=4)], [], lineno=21, col_offset=0), FunctionDef('test_suite', arguments([], None, None, []), [Assign([Name('suite', Store(), lineno=180, col_offset=4)], Call(Attribute(Name('unittest', Load(), lineno=180, col_offset=12), 'TestSuite', Load(), lineno=180, col_offset=12), [], [], None, None, lineno=180, col_offset=12), lineno=180, col_offset=4), If(Name('have_threads', Load(), lineno=182, col_offset=7), [Expr(Call(Attribute(Name('suite', Load(), lineno=183, col_offset=8), 'addTest', Load(), lineno=183, col_offset=8), [Call(Attribute(Name('unittest', Load(), lineno=183, col_offset=22), 'makeSuite', Load(), lineno=183, col_offset=22), [Name('LockingTestCase', Load(), lineno=183, col_offset=41)], [], None, None, lineno=183, col_offset=22)], [], None, None, lineno=183, col_offset=8), lineno=183, col_offset=8)], [Expr(Call(Attribute(Name('suite', Load(), lineno=185, col_offset=8), 'addTest', Load(), lineno=185, col_offset=8), [Call(Attribute(Name('unittest', Load(), lineno=185, col_offset=22), 'makeSuite', Load(), lineno=185, col_offset=22), [Name('LockingTestCase', Load(), lineno=185, col_offset=41), Str('test01', lineno=185, col_offset=58)], [], None, None, lineno=185, col_offset=22)], [], None, None, lineno=185, col_offset=8), lineno=185, col_offset=8)], lineno=182, col_offset=4), Return(Name('suite', Load(), lineno=187, col_offset=11), lineno=187, col_offset=4)], [], lineno=179, col_offset=0), If(Compare(Name('__name__', Load(), lineno=190, col_offset=3), [Eq()], [Str('__main__', lineno=190, col_offset=15)], lineno=190, col_offset=3), [Expr(Call(Attribute(Name('unittest', Load(), lineno=191, col_offset=4), 'main', Load(), lineno=191, col_offset=4), [], [keyword('defaultTest', Str('test_suite', lineno=191, col_offset=30))], None, None, lineno=191, col_offset=4), lineno=191, col_offset=4)], [], lineno=190, col_offset=0)])
